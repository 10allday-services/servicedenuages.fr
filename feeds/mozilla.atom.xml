<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Service de nuages</title><link href="http://www.servicedenuages.fr/" rel="alternate"></link><link href="http://www.servicedenuages.fr/feeds/mozilla.atom.xml" rel="self"></link><id>http://www.servicedenuages.fr/</id><updated>2016-09-01T00:00:00+02:00</updated><entry><title>Survoler les bugs avec Kinto</title><link href="http://www.servicedenuages.fr/jedit-bugs-getting-off-the-ground" rel="alternate"></link><published>2016-09-01T00:00:00+02:00</published><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2016-09-01:jedit-bugs-getting-off-the-ground</id><summary type="html">&lt;h1&gt;Survoler les bugs avec Kinto&lt;/h1&gt;
&lt;p&gt;Voici un article rédigé par &lt;a href="https://github.com/elelay"&gt;Eric Le Lay&lt;/a&gt; sur son utilisation de Kinto.&lt;/p&gt;
&lt;h2&gt;Introduction&lt;/h2&gt;
&lt;p&gt;Connaissez-vous &lt;a href="http://jedit.org"&gt;jEdit&lt;/a&gt; — &lt;em&gt;l'éditeur de texte des développeurs&lt;/em&gt; ?&lt;br/&gt;
C'est un éditeur de texte multi-plateforme, écrit en java, disposant de nombreux plugins.
Je participe à son développement depuis une dizaine d'années.
Nous l'hébergeons sur Sourceforge ; le code principal est sous &lt;em&gt;Subversion&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;Nous sommes bénévoles et le maintenons sur notre temps libre.
Pour ma part, je n'ai pas toujours accès à internet pendant les vacances. Ou via un câble Ethernet dans une pièce sombre
et surchauffée. Tout ça pour dire que j'aime avoir un maximum de choses sous la main hors-ligne :&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;sources et doc de la plateforme java : pas de problème avec les packages &lt;code&gt;openjdk7-doc&lt;/code&gt; et &lt;code&gt;openjdk7-src&lt;/code&gt; ;&lt;/li&gt;
&lt;li&gt;sources de jEdit et des plugins : avec git-svn j'ai le code et son historique ;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;bugs et feature requests : oups!&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Nous avons 1100 tickets ouverts et 7600 clos. Tout ça n'est pas disponible hors-ligne. Ça doit changer !&lt;/p&gt;
&lt;h3&gt;Comment obtenir une archive des tickets ?&lt;/h3&gt;
&lt;p&gt;Sourceforge permet aux admins de télécharger une archive du projet, dont les tickets.
Actuellement un script les convertit en un paquet de fichiers HTML avec un peu de javascript pour la navigation.
Le résultat (fichiers HTML pour un usage en-ligne et archive &lt;a href="http://jedit.org/trackers/Export.tgz"&gt;téléchargeable&lt;/a&gt;)
est déployé via rsync sur &lt;a href="http://jedit.org/trackers/"&gt;jedit.org/trackers&lt;/a&gt;.
Pour limiter le volume, seuls les tickets ouverts sont disponibles.&lt;/p&gt;
&lt;p&gt;La génération de l'archive du projet par Sourceforge prend plusieurs minutes, c'est pourquoi je la lance au plus une fois
par semaine.
Pour les utilisateurs, ce n'est pas très pratique, car il faut qu'ils téléchargent une nouvelle archive pour avoir une
vue à jour des tickets. Elle peut avoir une semaine de retard : peut mieux faire.&lt;/p&gt;
&lt;h3&gt;Objectifs&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;je voudrais permettre la mise à jour incrémentale des tickets ;&lt;/li&gt;
&lt;li&gt;je voudrais enrichir la visualisation des tickets : possibilité de recherche améliorée ;
   peut-être permettre la modification hors-ligne ;&lt;/li&gt;
&lt;li&gt;je voudrais essayer Kinto :-).&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Mes premiers pas avec Kinto&lt;/h2&gt;
&lt;p&gt;J'ai entendu parler de Kinto par Rémy et Alexis. Comme avec couchdb/pouchdb, il est possible de synchroniser
la base de données entre le serveur (Kinto) et le navigateur web (kinto.js). Kinto.js stocke les données dans IndexedDB
donc il est possible de manipuler une base relativement volumineuse.&lt;/p&gt;
&lt;p&gt;Chaque utilisateur peut créer ses propres collections (l'équivalent des tables SQL) Kinto. Il est même possible de gérer les
permissions document par document (l'équivalent des lignes SQL).&lt;/p&gt;
&lt;h3&gt;Le tutoriel : ToDo list&lt;/h3&gt;
&lt;p&gt;J'ai commencé par le
&lt;a href="http://kintojs.readthedocs.io/en/latest/tutorial/"&gt;tutoriel&lt;/a&gt;. Il présente bien les opérations: créer des documents, les
afficher, les modifier, synchroniser avec le serveur. Il s'appuie sur le serveur Kinto de test de mozilla : donc un
obstacle de moins pour démarrer.&lt;/p&gt;
&lt;h3&gt;Des tickets au lieu des tâches&lt;/h3&gt;
&lt;p&gt;Je suis passé à un serveur kinto local pour mes tests : il est déployable très facilement via docker.
Si vous envisagez d'importer des documents, utilisez tout de suite le backend PostgreSQL
(aussi facile à mettre en place, avec docker-compose ;
tout est &lt;a href="http://kinto.readthedocs.io/en/stable/tutorials/install.html#using-docker-compose"&gt;expliqué&lt;/a&gt;).
Le backend en RAM pose des &lt;a href="https://github.com/Kinto/kinto/issues/759"&gt;problèmes&lt;/a&gt; lors d'import batch en parallèle (ce
qui se produit si vous importez depuis un &lt;a href="https://github.com/elelay/jedit-trackers-kinto/blob/master/transform.js"&gt;script&lt;/a&gt;
node.js utilisant &lt;a href="https://www.npmjs.com/package/request"&gt;request&lt;/a&gt;).&lt;/p&gt;
&lt;p&gt;Une fois les tickets importés, l'application web n'a plus qu'à les récupérer via la synchronisation kinto.js et les
afficher.&lt;/p&gt;
&lt;h3&gt;Recherche locale avec kinto.js&lt;/h3&gt;
&lt;p&gt;La recherche locale avec kinto.js n'est pas aussi développée que la recherche
&lt;a href="http://kinto.readthedocs.io/en/stable/api/1.x/filtering.html"&gt;sur le serveur&lt;/a&gt; :
seule la conjonction de &lt;code&gt;clé: [valeur1, valeur2, ...]&lt;/code&gt; est supportée. La recherche sur les champs &lt;code&gt;id&lt;/code&gt;, &lt;code&gt;_status&lt;/code&gt; et &lt;code&gt;last_modified&lt;/code&gt;
est accélérée par un index (code &lt;a href="https://github.com/Kinto/kinto.js/blob/f48ea470ddb2c6398acc386439043e6cae8bffe4/src/adapters/IDB.js#L325"&gt;ici&lt;/a&gt;).
Ensuite, tous les documents sont chargés et retournés sous forme de tableau puis filtrés selon les critères restants.
Le filtrage selon des critères plus complexes se fait par l'application sur le résultat de &lt;code&gt;list()&lt;/code&gt;.
Dans les cas de petites collections c'est simple et de bon goût mais avec 8000 documents la recherche
devient un peu lente.&lt;/p&gt;
&lt;p&gt;Exemple de recherche &lt;em&gt;complexe&lt;/em&gt; par mot clé (champ de texte) :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt; &lt;span class="nx"&gt;filterByKeyword&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;keyword&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
  &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;doc&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;doc&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;summary&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;indexOf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;keyword&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="p"&gt;};&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="kd"&gt;function&lt;/span&gt; &lt;span class="nx"&gt;search&lt;/span&gt;&lt;span class="p"&gt;(){&lt;/span&gt;
  &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;keyword&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;document&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;getElementById&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"query"&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;tickets&lt;/span&gt;
    &lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;list&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;res&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
      &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;res&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;data&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;filterByKeyword&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;keyword&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;
    &lt;span class="p"&gt;});&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="c1"&gt;// on submit&lt;/span&gt;
&lt;span class="nx"&gt;search&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;render&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Architecture&lt;/h2&gt;
&lt;p&gt;J'héberge mon serveur kinto sur un serveur C1 chez scaleway. Il contient deux collections :&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;tickets, pour les tickets ouverts ou récemment fermés ;&lt;/li&gt;
&lt;li&gt;oldTickets, pour les tickets fermés avant 2016.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;J'utilise l'id des tickets chez Sourceforge &lt;a href="http://kintojs.readthedocs.io/en/latest/api/#custom-id-generation-using-an-id-schema"&gt;plutôt qu'une id auto-générée&lt;/a&gt;.
Je peux ainsi mettre à jour la base facilement à partir des infos de Sourceforge (pas besoin de rechercher le document
chez kinto avant de le mettre à jour puisque je connais l'id).&lt;/p&gt;
&lt;p&gt;Les clients sont des applications web.&lt;/p&gt;
&lt;p&gt;Un script de mise à jour reporte les modifications de Sourceforge dans la base.&lt;/p&gt;
&lt;p&gt;La machine étant un serveur ARM sous debian Jessie, quelques aménagements ont été nécessaires (détails sur le
&lt;a href="https://github.com/Kinto/kinto/wiki"&gt;wiki kinto&lt;/a&gt;).&lt;/p&gt;
&lt;h2&gt;Client kinto.js&lt;/h2&gt;
&lt;p&gt;Mon objectif était d'abord d'en apprendre le maximum sur kinto.js. J'ai bien aimé le coté vanilla du tutoriel (pas de
dépendance à n frameworks) et suis resté sur cette simplicité :&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;le CSS de bootstrap, les icônes de fontawesome&lt;/li&gt;
&lt;li&gt;quelques utilitaires : moment, lodash,&lt;/li&gt;
&lt;li&gt;datatables (après avoir fait ma propre gestion de table, mais voulant déplier certaines lignes de la table et ayant trouvé
   un &lt;a href="https://datatables.net/examples/server_side/row_details.html"&gt;exemple tout prêt&lt;/a&gt;).&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img alt="Capture d'écran de l'application" src="http://www.servicedenuages.fr/images/jedit-trackers-with-kinto-app.png" style="width: 990px; height: auto; max-width: 100%;"/&gt;&lt;/p&gt;
&lt;h2&gt;État initial&lt;/h2&gt;
&lt;p&gt;Lorsque vous accédez pour la première fois à l'&lt;a href="https://trackers.elelay.fr/trackers.html"&gt;application&lt;/a&gt;, un panneau vous
est présenté proposant de récupérer les tickets, dont éventuellement les vieux tickets.&lt;/p&gt;
&lt;p&gt;Petite astuce pour déterminer si c'est la première fois :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nx"&gt;tickets&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;db&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;getLastModified&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;res&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;res&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="nx"&gt;hasDB&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="nx"&gt;noDB&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;});&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Pour afficher le nombre de tickets sur le serveur avant de les récupérer, il faut descendre dans le package
&lt;a href="https://github.com/Kinto/kinto-http.js"&gt;kinto-http&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Le code correspondant (bientôt simplifié) :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt; &lt;span class="nx"&gt;fetchTotalRecords&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;api&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;bucket&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;etag&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;headers&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{};&lt;/span&gt;
    &lt;span class="nx"&gt;headers&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;"Authorization"&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;"Basic "&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="nx"&gt;btoa&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"token:tr0ub4d@ur"&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;api&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;client&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;execute&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt;
        &lt;span class="nx"&gt;path&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"/buckets/"&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="nx"&gt;bucket&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s2"&gt;"/collections/"&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="nx"&gt;name&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s2"&gt;"/records"&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;etag&lt;/span&gt; &lt;span class="o"&gt;?&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"?_since="&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="nx"&gt;etag&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;""&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
        &lt;span class="nx"&gt;method&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"HEAD"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="nx"&gt;headers&lt;/span&gt;
    &lt;span class="p"&gt;},&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="nx"&gt;raw&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="kc"&gt;true&lt;/span&gt;
    &lt;span class="p"&gt;}).&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;res&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="nx"&gt;console&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;log&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"RES"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;res&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nb"&gt;parseInt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;res&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;headers&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"total-records"&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;
    &lt;span class="p"&gt;});&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="nx"&gt;tickets&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;db&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;getLastModified&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;lastMod&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;api&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;tickets&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;api&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;bucket&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;tickets&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;bucket&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nx"&gt;collection&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;tickets&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;name&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;fetchTotalRecords&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;api&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;tickets&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;bucket&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;tickets&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;lastMod&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="p"&gt;}).&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;renderTicketCount&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Cette méthode fonctionne aussi pour déterminer s'il y a eu du nouveau sur le serveur (&lt;a href="http://kinto.readthedocs.io/en/latest/api/1.x/filtering.html#polling-for-changes"&gt;via l'ETag&lt;/a&gt;). Le serveur kinto ne
répond pas instantanément. Il faudrait peut-être passer l'etag en &lt;code&gt;If-None-Match&lt;/code&gt; en plus de &lt;code&gt;since&lt;/code&gt; pour accélérer les choses.&lt;/p&gt;
&lt;h2&gt;Recherche&lt;/h2&gt;
&lt;p&gt;Pour la recherche en texte libre coté client, j'ai utilisé &lt;a href="http://lunrjs.com/"&gt;lunr&lt;/a&gt;. Il construit un index
à la Lucene, et permet ensuite de rechercher dans cet index. L'index est sérialisé et enregistré comme un document
d'une collection kinto.js cliente pour être réutilisé à la prochaine visite.&lt;/p&gt;
&lt;p&gt;La recherche dans l'index retourne un tableau d'id de documents depuis lequel j'extrais les documents, avant de filtrer
ce petit tableau avec les autres critères. Cela a accéléré les choses par rapport à la première version de l'application,
dans laquelle je commençais toujours la recherche par un &lt;code&gt;tickets.list()&lt;/code&gt;, qui retournait tous les documents.&lt;/p&gt;
&lt;p&gt;Pour rechercher &lt;em&gt;hello&lt;/em&gt; dans l'index en mémoire :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="nx"&gt;index&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;search&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"hello"&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
   &lt;span class="p"&gt;[{&lt;/span&gt;&lt;span class="s2"&gt;"ref"&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;"52a4d8cb27184667e3400f42"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;"score"&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mf"&gt;0.019459983366287688&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;
    &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;"ref"&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;"5690ff3f24b0d96f08df7d6a"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;"score"&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mf"&gt;0.013994677485991343&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;
    &lt;span class="p"&gt;...&lt;/span&gt;
   &lt;span class="p"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Pour obtenir une promesse d'un objet &lt;code&gt;{ data: ['tableau', 'de', 'tickets', 'contenant', 'texteLibre'] }&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nb"&gt;Promise&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;all&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;index&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;search&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;texteLibre&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nx"&gt;map&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;hit&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;tickets&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;hit&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;ref&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="p"&gt;})).&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;allRes&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="nx"&gt;data&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="nx"&gt;allRes&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;map&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;res&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
            &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;res&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;data&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="p"&gt;})&lt;/span&gt;
    &lt;span class="p"&gt;};&lt;/span&gt;
&lt;span class="p"&gt;});&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Dans ce code, tous les documents sont récupérés d'IndexedDB en parallèle via leur Id (&lt;code&gt;collection.get()&lt;/code&gt;).
C'est rapide car IndexedDB est optimisé pour l'accès par clé, mais il serait peut⁻être plus efficace d'utiliser
&lt;code&gt;tickets.list({filters: {id: ['tableau', 'des', 'ids']}})&lt;/code&gt; pour limiter le nombre de requêtes.&lt;/p&gt;
&lt;h2&gt;Affichage d'un ticket&lt;/h2&gt;
&lt;p&gt;L'application est conçue pour être multi-onglet, permettre la navigation dans l'historique et la création de marques pages.
Pour cela, l'état est stocké dans l'url et les recherches entraînent des appels à &lt;code&gt;pushState()&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;state&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

&lt;span class="kd"&gt;function&lt;/span&gt; &lt;span class="nx"&gt;encodeState&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;state&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="s2"&gt;"#"&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="nb"&gt;encodeURIComponent&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;JSON&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;stringify&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;state&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="kd"&gt;function&lt;/span&gt; &lt;span class="nx"&gt;applyState&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;state&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nb"&gt;document&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;getElementById&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"search"&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nx"&gt;value&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;state&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="nx"&gt;search&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="kd"&gt;function&lt;/span&gt; &lt;span class="nx"&gt;saveState&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;state&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;history&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;pushState&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;state&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;"jEdit Trackers"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;encodeState&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;state&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="kd"&gt;function&lt;/span&gt; &lt;span class="nx"&gt;hashIsTicket&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;location&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;hash&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;match&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sr"&gt;/^#[a-z0-9-]+$/&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;addEventListener&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"popstate"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;e&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="c1"&gt;// called on browser history navigation&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;e&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;state&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="nx"&gt;state&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;e&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;state&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="nx"&gt;applyState&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;state&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;hashIsTicket&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
            &lt;span class="c1"&gt;// show this ticket&lt;/span&gt;
        &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
            &lt;span class="c1"&gt;// show search interface&lt;/span&gt;
        &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;});&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;On peut afficher un ticket dans un autre onglet en cliquant sur &lt;em&gt;Ouvrir&lt;/em&gt; dans un résultat de recherche.
Rien de bien compliqué : l'id est mise dans le hash de l'url et l'application interprète ce hash au chargement.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt; &lt;span class="nx"&gt;restoreInitialState&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;location&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;hash&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;match&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sr"&gt;/^#[a-z0-9-]+$/&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="nx"&gt;showTicket&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;location&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;hash&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;substring&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;location&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;hash&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;startsWith&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"#%7B"&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="k"&gt;try&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
            &lt;span class="nx"&gt;state&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;JSON&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;parse&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;decodeURIComponent&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;location&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;hash&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;substring&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)));&lt;/span&gt;
        &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="k"&gt;catch&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;e&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
            &lt;span class="nx"&gt;console&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;log&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"invalid state in hash"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;location&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;hash&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
            &lt;span class="nx"&gt;state&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;defaultState&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
        &lt;span class="p"&gt;}&lt;/span&gt;
        &lt;span class="nx"&gt;applyState&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;state&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="nx"&gt;state&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;defaultState&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
        &lt;span class="nx"&gt;applyState&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;state&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="nx"&gt;restoreInitialState&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt; &lt;span class="c1"&gt;// to restore state from bookmark or link at page load&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;h1&gt;Mises à jour&lt;/h1&gt;
&lt;p&gt;Lorsqu'un ticket est modifié coté Sourceforge il faut mettre à jour le document correspondant dans Kinto.
Je le fais via un programme coté serveur. &lt;/p&gt;
&lt;h2&gt;updater.py&lt;/h2&gt;
&lt;p&gt;Il n'est pas possible d'obtenir les modifications de tickets Sourceforge en temps réel via les technologies web.&lt;/p&gt;
&lt;p&gt;Quelques idées pour les obtenir :&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;interroger périodiquement le flux RSS de chaque tracker (limité à 10 tickets donc on peut rater des mises à
 jour si le script ne s'exécute pas pendant un moment) ;&lt;/li&gt;
&lt;li&gt;interroger périodiquement l'API REST de chaque tracker, en demandant les tickets modifiés depuis la dernière
 fois (délai &amp;lt; période de polling) ;&lt;/li&gt;
&lt;li&gt;s'abonner à la mailing list jedit-devel et les récupérer avec un client pop3 (délai &amp;lt; 1 minute).&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;J'ai choisi la solution 2. Le script
&lt;a href="https://github.com/elelay/jedit-trackers-kinto/blob/master/updater.py"&gt;updater.py&lt;/a&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;récupère la liste des trackers chez Sourceforge,&lt;/li&gt;
&lt;li&gt;récupère de kinto la date de dernière mise à jour (document dans une collection &lt;code&gt;updater&lt;/code&gt;),&lt;/li&gt;
&lt;li&gt;interroge Sourceforge sur les tickets modifiés depuis cette date,&lt;/li&gt;
&lt;li&gt;pousse les mises à jour dans les collections &lt;code&gt;tickets&lt;/code&gt; et &lt;code&gt;oldTickets&lt;/code&gt;.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Les tickets sont déjà en JSON, avec un minimum de mapping à faire (récupérer les commentaires via une seconde requête
à Sourceforge).&lt;/p&gt;
&lt;h2&gt;Notifications client&lt;/h2&gt;
&lt;p&gt;Kinto semble disposer d'un mécanisme de notification via
&lt;a href="http://kinto.readthedocs.io/en/latest/tutorials/notifications-websockets.html"&gt;websockets&lt;/a&gt; mais je ne l'ai pas exploré.&lt;/p&gt;
&lt;p&gt;Les clients interrogent le serveur kinto pour les nouveaux tickets toutes les minutes. Lorsqu'il y en a, une
notification proposant de synchroniser la base s'affiche en haut à droite de l'application.&lt;/p&gt;
&lt;p&gt;Suite à la synchronisation, je mets à jour l'index lunr avec les documents modifiés/ajoutés/supprimés (&lt;code&gt;index.add(document)&lt;/code&gt;, &lt;code&gt;index.remove(document)&lt;/code&gt;).&lt;/p&gt;
&lt;p&gt;Les compteurs de tickets affichés sur les boutons (ratés, bugs ouverts) sont aussi recalculés à cette occasion
et stockés dans une collection client. S'il n'y a pas de suppressions, je peux les mettre à jour incrémentalement,
sinon, il faut re-parcourir la collection pour les calculer.&lt;/p&gt;
&lt;h1&gt;Conclusion&lt;/h1&gt;
&lt;h2&gt;Ai-je bien fait d'essayer Kinto ?&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;Oui, certainement&lt;/strong&gt;. C'est une bonne plateforme pour mon application. Ce n'est cependant pas une solution clé en main
comme &lt;a href="https://www.meteor.com/"&gt;meteor&lt;/a&gt;. Il faut donc l'associer à d'autres librairies pour avoir une application complète.
D'un autre coté, le déploiement est simple et le déroulement du programme est facile à suivre.&lt;/p&gt;
&lt;p&gt;Les performances sont correctes (l'import batch des 8000 tickets fait tourner mon petit serveur pendant 5 minutes)
et le système est ouvert.&lt;/p&gt;
&lt;p&gt;Je me suis un peu compliqué la vie en séparant les tickets en deux collections, mais ne charger que les tickets récents
allège vraiment l'application.&lt;/p&gt;
&lt;h2&gt;Amélioration prévues&lt;/h2&gt;
&lt;p&gt;J'ai passé 3 semaines à explorer Kinto et il reste encore des choses à tester. Je suis également loin d'une application terminée.&lt;/p&gt;
&lt;p&gt;Quelques pistes :&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Modifications des tickets&lt;/strong&gt;&lt;br/&gt;
Je voudrais qu'on puisse modifier les tickets depuis l'application, plutôt que de renvoyer vers Sourceforge.
Les modifications pourraient être temporairement stockées dans kinto.js en attente de réseau.&lt;/p&gt;
&lt;p&gt;La voie est libre depuis la correction d'un &lt;a href="https://sourceforge.net/p/forge/site-support/13403/"&gt;petit bug&lt;/a&gt;
qui empêchait d'interroger l'API Sourceforge en CORS depuis la France, mais ça représente pas mal de code pour
l'interface utilisateur. J'explorerai &lt;a href="https://github.com/Kinto/formbuilder"&gt;FormBuilder&lt;/a&gt; avant de coder ma
propre solution. Sans aller jusque là, il pourrait être intéressant de permettre aux utilisateurs de tagger, mettre en
favoris, suivre, certains tickets (stockage dans kinto).&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Interface Utilisateur&lt;/strong&gt;
L'interface est largement améliorable. J'envisage également de restructurer le code en m'appuyant sur react, vu qu'il existe
du &lt;a href="https://github.com/Kinto/kinto-react-boilerplate"&gt;boilerplate&lt;/a&gt; et &lt;a href="https://github.com/Kinto/kinto-admin"&gt;kinto-admin&lt;/a&gt;
comme source d'inspiration.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Pièces jointes&lt;/strong&gt;
Tous les tickets sont accessibles hors-ligne, mais pas les pièces-jointes (comme le log contenant la
trace d'exécution permettant de comprendre le bug). Nous ne sommes donc pas encore à du 100% hors-ligne. J'aimerai
distribuer ces pièces-jointes, peut-être avec le mécanisme
d'&lt;a href="http://www.servicedenuages.fr/kinto-file-attachment"&gt;Attachments&lt;/a&gt; de kinto. Les pièces-jointes des tickets récents font 10Mo,
celles des anciens tickets 18Mo : ça semble donc faisable.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Recherche texte libre&lt;/strong&gt;
Je n'utilise lunr.js que de manière très basique : indexation du titre et de la description. Mais l'index est
déjà très gros et lent à (dé)sérialiser depuis IndexedDB. J'hésite entre l'enrichir, permettant une recherche sur &lt;a href="https://github.com/olivernn/lunr.js/issues/125"&gt;tous
les champs&lt;/a&gt; ou définir mon langage de requête et jouer sur des index que
je maintiendrai moi-même.&lt;/p&gt;
&lt;p&gt;L'indexation pourrait se faire dans un WebWorker, pour ne pas bloquer l'application.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Performances&lt;/strong&gt;
Les tickets pourraient être indexés par numéro (ils ne sont pas uniques au sein d'un projet, mais au sein d'un tracker) pour accélérer
ce type de recherche. De même, indexer par les autres critères de recherche prédéfinis accélèrerait les choses.&lt;/p&gt;
&lt;p&gt;Je peux gérer des index manuels (un document par index, contenant un objet associant chaque valeur possible de la clé
à un tableau d'id). Alors, rechercher tous les bugs ouverts reviendrait à &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nx"&gt;indexes&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"bug"&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;resInd&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
    &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;ind&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;resInd&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;data&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="c1"&gt;// ind = { open : ["id1", "id2", ...], ...}&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nb"&gt;Promise&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;all&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="nx"&gt;ind&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;open&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nx"&gt;map&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;tickets&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;get&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;bind&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;tickets&lt;/span&gt;&lt;span class="p"&gt;)))&lt;/span&gt;
                  &lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;multiRes&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
                      &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;multiRes&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;map&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;res&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;res&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;data&lt;/span&gt;&lt;span class="p"&gt;;})&lt;/span&gt;
                  &lt;span class="p"&gt;});&lt;/span&gt;
&lt;span class="p"&gt;});&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Merci !&lt;/h2&gt;
&lt;p&gt;Je tiens à remercier l'équipe travaillant autour de Kinto pour leur gentillesse
et leur ouverture : accessibles sur IRC (#kinto) et Slack, ils encouragent la création de tickets, de PR.
De nombreuses sont même acceptées ;-)&lt;/p&gt;
&lt;p&gt;Le code est disponible sur github: &lt;a href="https://github.com/elelay/jedit-trackers-kinto"&gt;elelay/jedit-trackers-kinto&lt;/a&gt;.&lt;br/&gt;
Il tourne sur &lt;a href="http://trackers.elelay.fr/trackers.html"&gt;trackers.elelay.fr&lt;/a&gt;.&lt;br/&gt;
Vos retours sont les bienvenus via IRC (elelay) — Issues et PR, sait-on jamais...&lt;/p&gt;
&lt;!-- :wrap=hard:noTabs=true:tabSize=4:indentSize=4: --&gt;</summary><category term="mozilla"></category></entry><entry><title>Configurer un certificat SSL avec Let's Encrypt</title><link href="http://www.servicedenuages.fr/configurer-un-certificat-ssl-lets-encrypt" rel="alternate"></link><published>2015-12-16T00:00:00+01:00</published><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2015-12-16:configurer-un-certificat-ssl-lets-encrypt</id><summary type="html">&lt;p&gt;Fini les certificats non sécurisés et très coûteux !&lt;/p&gt;
&lt;p&gt;&lt;img alt="Let's encrypt — a new Certificate Authority:  free, automated, and open." src="http://www.servicedenuages.fr/images/letsencrypt-logo-horizontal.png" style="width: 1025px; height: auto; max-width: 100%;"/&gt;&lt;/p&gt;
&lt;p&gt;Avec Let's Encrypt vous n'avez plus d'excuse car il vous est
maintenant possible d'obtenir un certificat SSL valide, sur tous les
navigateurs, gratuitement et sans avoir besoin d'être un expert en
cryptographie.&lt;/p&gt;
&lt;h1&gt;Téléchargez le client sur votre ordinateur&lt;/h1&gt;
&lt;p&gt;Pour commencer il vous faut installer le client letsencrypt qui va
gérer pour vous la génération de la CSR, la vérification auprès de
letsencrypt et l'installation du certificat.&lt;/p&gt;
&lt;p&gt;&lt;a href="https://letsencrypt.org/howitworks/#installing-lets-encrypt"&gt;Comme expliqué sur le site de letsencrypt :&lt;/a&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ git clone https://github.com/letsencrypt/letsencrypt
$ &lt;span class="nb"&gt;cd&lt;/span&gt; letsencrypt
&lt;/pre&gt;&lt;/div&gt;
&lt;h1&gt;Serveur dédié&lt;/h1&gt;
&lt;p&gt;Si vous avez la chance d'avoir un serveur dédié, c'est complètement
automatique et il vous suffit de lancer le script avec les bonnes options:&lt;/p&gt;
&lt;p&gt;Avec Apache c'est automatique :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ ./letsencrypt-auto --apache -d example.com -d www.example.com
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Pour les autres, la génération du certificat peut se faire comme cela :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ ./letsencrypt-auto certonly --webroot -w /var/www/example -d example.com -d www.example.com
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Où &lt;code&gt;/var/www/example&lt;/code&gt; est le répertoire servant les fichiers sur le domaine &lt;code&gt;example.com&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Il faudra ensuite consulter la documentation de votre serveur HTTP
pour configurer votre certificat SSL.&lt;/p&gt;
&lt;h1&gt;Serveur mutualisé&lt;/h1&gt;
&lt;p&gt;Comme &lt;code&gt;letsencrypt-auto&lt;/code&gt; nécessite d'avoir les droits root, sur un
serveur mutualisé c'est un peu moins automatique.&lt;/p&gt;
&lt;p&gt;La solution proposée ici est de générer le certifiat localement en
mode manuel puis de configurer le serveur mutualisé dans un deuxième
temps.&lt;/p&gt;
&lt;p&gt;Pour valider de manière automatique un certificat, letsencrypt
télécharge une preuve via le nom de domaine pour lequel on demande un
certificat.&lt;/p&gt;
&lt;p&gt;On va donc :&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Lancer le script localement ;&lt;/li&gt;
&lt;li&gt;Héberger la preuve du nom de domaine sur le serveur ;&lt;/li&gt;
&lt;li&gt;Puis générer et configurer notre certificat SSL.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Lancer le script localement&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ ./letsencrypt-auto certonly --manual -d mondomaine.fr -d www.mondomaine.fr
&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Mettre en ligne la preuve de possession du nom de domaine&lt;/h2&gt;
&lt;p&gt;En utilisant votre client FTP vous pouvez:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Créez le répertoire : &lt;code&gt;www/.well-known/acme-challenge/&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Créez le fichier dont le nom et le contenu vous est donné.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Par exemple:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ mkdir .well-known/acme-challenge/
$ cat &amp;gt; .well-known/acme-challenge/1ni92R95ooeCPOcRhVXYSF1HXVfdS61uWMlMjQXOQns
1ni92R95ooeCPOcRhVXYSF1HXVfdS61uWMlMjQXOQns.MJvFiRCK_M0WiBPW19A7VQekVtY5sSojwa44TFcaUAw
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Vérifiez que vous pouvez bien accéder au lien qui vous est donné :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;https://www.mondomaine.com/.well-known/acme-challenge/1ni92R95ooeCPOcRhVXYSF1HXVfdS61uWMlMjQXOQns
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Ensuite appuyez sur &lt;em&gt;Entrée&lt;/em&gt;&lt;/p&gt;
&lt;h2&gt;Mettrez en ligne votre certificat&lt;/h2&gt;
&lt;p&gt;Vous devez ensuite vous rendre dans l'interface de votre hébergeur et
renseigner le contenu des fichiers, &lt;code&gt;privkey.pem&lt;/code&gt;, &lt;code&gt;cert.pem&lt;/code&gt; et
&lt;code&gt;fullchain.pem&lt;/code&gt; dans le champ de formulaire respectifs &lt;code&gt;Clé privé&lt;/code&gt;,
&lt;code&gt;Certificat&lt;/code&gt;, &lt;code&gt;Certificats intermédiaires&lt;/code&gt;, qui ont été créé pour vous
dans le répertoire : &lt;code&gt;/etc/letsencrypt/live/mondomaine.com&lt;/code&gt;&lt;/p&gt;
&lt;h2&gt;Que faire ensuite ?&lt;/h2&gt;
&lt;p&gt;Votre certificat est valable pour 3 mois n'oubliez pas de vous mettre
un rappel quelques jours avant sa date d'expiration pour relancer
votre script et mettre à jour le certificat.&lt;/p&gt;
&lt;p&gt;Les fichiers &lt;code&gt;fullchain.pem&lt;/code&gt; et &lt;code&gt;privkey.pem&lt;/code&gt; resteront inchangés mais
le fichier &lt;code&gt;cert.pem&lt;/code&gt; doit être mis à jour.&lt;/p&gt;
&lt;p&gt;Pour se faire relancer la commande sur le même ordinateur:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ ./letsencrypt-auto certonly --manual -d mondomaine.fr -d www.mondomaine.fr
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Un écran s'affiche vous proposant de renouveler le certificat.&lt;/p&gt;
&lt;p&gt;Suivez la procédure et mettez à jour le certificat dans l'interface de
votre hébergeur.&lt;/p&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;Let's Encrypt facilite vraiment la vie, plus besoin de générer un CSR,
plus besoin de payer, plus besoin de se creuser la tête pour chaque
certificat, vous pouvez mettre autant de sous domaines que vous le
souhaitez et régénerer votre certificat jusqu'à 5 fois par semaines si
nécessaire.&lt;/p&gt;
&lt;p&gt;La seule chose à faire c'est de mettre à jour son certificat SSL tous
les 3 mois en relançant la commande.&lt;/p&gt;
&lt;p&gt;La procédure de mise en place étant disponible et le client étant Open
Source il y a fort à parier que les hébergeurs vont simplifier la
procédure et la rendre spécifique à leur interface d'administration.&lt;/p&gt;
&lt;p&gt;Des serveurs HTTP tels que &lt;code&gt;caddy&lt;/code&gt; ont déjà
&lt;a href="https://www.youtube.com/watch?v=nk4EWHvvZtI"&gt;intégré la génération du certificat&lt;/a&gt;
dans la procédure d'installation de leur serveur.&lt;/p&gt;</summary><category term="mozilla"></category></entry><entry><title>Support des fichiers dans Kinto</title><link href="http://www.servicedenuages.fr/kinto-file-attachment" rel="alternate"></link><published>2015-11-19T00:00:00+01:00</published><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2015-11-19:kinto-file-attachment</id><summary type="html">&lt;div class="section" id="le-besoin-initial"&gt;
&lt;h2&gt;Le besoin initial&lt;/h2&gt;
&lt;p&gt;Le besoin d'ajouter des fichiers dans &lt;em&gt;Kinto&lt;/em&gt; avait été identifié depuis
le début du projet. Mais comme nous sommes une toute petite équipe, nous sommes
un peu forcés d'attendre que des besoins se présentent en interne (chez Mozilla)
pour se lancer dans l'implémentation.&lt;/p&gt;
&lt;p&gt;Après &lt;a class="reference external" href="http://www.servicedenuages.fr/la-gestion-des-permissions"&gt;les permissions&lt;/a&gt;,
&lt;a class="reference external" href="http://www.servicedenuages.fr/kinto-chiffrer-ses-donnees"&gt;le chiffrement&lt;/a&gt;,
&lt;a class="reference external" href="http://www.servicedenuages.fr/donnees-et-signatures"&gt;les signatures&lt;/a&gt; et
&lt;a class="reference external" href="http://www.servicedenuages.fr/en/notifications-kinto-preamble"&gt;les notifications&lt;/a&gt;,
nous avons enfin eu une demande pour les fichiers !&lt;/p&gt;
&lt;img alt="Fennec logo" class="align-center" src="http://www.servicedenuages.fr/images/logo-fennec.png" style="width: 458px; height: auto; max-width: 100%;"/&gt;
&lt;p&gt;En effet, dans &lt;a class="reference external" href="https://www.mozilla.org/fr/firefox/partners/#android"&gt;Fennec&lt;/a&gt;
— la version mobile de Firefox — nous souhaitons livrer et mettre à jour des fichiers statiques
(polices de caractères, icônes, dictionnaires de césures...) sans avoir à repackager
et redéployer une nouvelle version de l'application.&lt;/p&gt;
&lt;p&gt;Pour cela, un &lt;em&gt;Kinto&lt;/em&gt; accessible publiquement en lecture-seule sera consulté par
les mobiles pour synchroniser localement des collections d'enregistrements, qui
eux fourniront les URLs vers les fichiers (sur un CDN). Les collections &lt;tt class="docutils literal"&gt;fonts&lt;/tt&gt;,
&lt;tt class="docutils literal"&gt;assets&lt;/tt&gt; ou &lt;tt class="docutils literal"&gt;hyphenation&lt;/tt&gt; seront mises à jour dès qu'un fichier sera ajouté ou remplacé
sur un de leurs enregistrements.&lt;/p&gt;
&lt;p&gt;Nous reviendrons avec plus de détails dans un autre article, mais cela ressemble beaucoup à ce que
nous sommes en train de faire pour les révocations de certificats ou les listes
noires d'addons dans Firefox.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="la-solution"&gt;
&lt;h2&gt;La solution&lt;/h2&gt;
&lt;p&gt;Comme nous avons besoin de cette fonctionnalité assez rapidement et que ce cas
d'utilisation n'est probablement pas très universel, nous avons décidé d'implémenter
une solution sous forme de plugin &lt;em&gt;Kinto&lt;/em&gt; &lt;a class="footnote-reference" href="#id2" id="id1"&gt;[1]&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Le support des fichiers sera donc optionnel dans un premier temps.&lt;/p&gt;
&lt;div class="section" id="fonctionnalites-principales"&gt;
&lt;h3&gt;Fonctionnalités principales&lt;/h3&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;stockage des fichiers en local sur le serveur ou sur Amazon S3 ;&lt;/li&gt;
&lt;li&gt;le serveur calcule les métadonnées à la reception (hash, taille, ...) ;&lt;/li&gt;
&lt;li&gt;l'enregistrement lié est créé si besoin lors de l'envoi du fichier ;&lt;/li&gt;
&lt;li&gt;les permissions de l'enregistrement sont vérifiées au moment de l'envoi ;&lt;/li&gt;
&lt;li&gt;des attributs et permissions de l'enregistrement lié peuvent être spécifiés lors de l'envoi ;&lt;/li&gt;
&lt;li&gt;les fichiers sont de simples blobs opaques, qui peuvent être le résultat de
compression ou chiffrement ;&lt;/li&gt;
&lt;li&gt;les fichiers sont supprimés lorsque les enregistrements sont supprimés.&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="section" id="limitations"&gt;
&lt;h3&gt;Limitations&lt;/h3&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;un seul fichier par enregistrement ;&lt;/li&gt;
&lt;li&gt;les metadonnées du fichier joint sont stockées dans un attribut &lt;tt class="docutils literal"&gt;attachment&lt;/tt&gt;
parmis les autres attributs métier (&lt;a class="reference external" href="https://github.com/Kinto/kinto/issues/256"&gt;plus de détails&lt;/a&gt;);&lt;/li&gt;
&lt;li&gt;dans un premier temps la récupération du fichier ne passera pas par &lt;em&gt;Kinto&lt;/em&gt;.
Pour les fichiers «privés», il faut donc que les URLs générées soient «secrètes».&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Pour plus tard (ou bientôt selon les besoins)&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Support de l'&lt;a class="reference external" href="https://fr.wikipedia.org/wiki/Chunked_transfer_encoding"&gt;envoi par chunk&lt;/a&gt; pour les gros fichiers&lt;/li&gt;
&lt;li&gt;Ajout d'un endpoint (optionnel) pour servir des fichiers complètement privés&lt;/li&gt;
&lt;/ul&gt;
&lt;table class="docutils footnote" frame="void" id="id2" rules="none"&gt;
&lt;colgroup&gt;&lt;col class="label"&gt;&lt;/col&gt;&lt;col&gt;&lt;/col&gt;&lt;/colgroup&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td class="label"&gt;&lt;a class="fn-backref" href="#id1"&gt;[1]&lt;/a&gt;&lt;/td&gt;&lt;td&gt;ça nous permet aussi de &lt;a class="reference external" href="https://github.com/mozilla-services/cliquet/pull/584"&gt;remonter&lt;/a&gt;
&lt;a class="reference external" href="https://github.com/Kinto/kinto/issues/277"&gt;des&lt;/a&gt;
&lt;a class="reference external" href="https://github.com/Kinto/kinto/issues/309"&gt;soucis&lt;/a&gt; dans notre système de plugins :)&lt;/td&gt;&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="http-api"&gt;
&lt;h2&gt;HTTP API&lt;/h2&gt;
&lt;p&gt;Quand le plugin est activé, &lt;em&gt;Kinto&lt;/em&gt; dispose d'un nouveau &lt;em&gt;endpoint&lt;/em&gt; : un suffixe
&lt;tt class="docutils literal"&gt;/attachment&lt;/tt&gt; à l'URL de l'enregistrement.&lt;/p&gt;
&lt;p&gt;Le fichier est posté avec le &lt;em&gt;Content-Type&lt;/em&gt; &lt;tt class="docutils literal"&gt;multipart&lt;/tt&gt;. Avec &lt;a class="reference external" href="http://httpie.org"&gt;HTTPie&lt;/a&gt;,
ça donne :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="err"&gt;$ http --auth alice:passwd --verbose --form POST \&lt;/span&gt;
&lt;span class="err"&gt;     http://localhost:8888/v1/buckets/website/collections/assets/records/c2ce1975-0e52-4b2f-a5db-80166aeca689/attachment \&lt;/span&gt;
&lt;span class="err"&gt;     data='{"type": "wallpaper", "theme": "orange"}' \&lt;/span&gt;
&lt;span class="err"&gt;     attachment=@~/Pictures/background.jpg&lt;/span&gt;

&lt;span class="kr"&gt;HTTP&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="m"&gt;1.1&lt;/span&gt; &lt;span class="m"&gt;201&lt;/span&gt; &lt;span class="ne"&gt;Created&lt;/span&gt;
&lt;span class="na"&gt;Access-Control-Expose-Headers&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="l"&gt;Retry-After, Content-Length, Alert, Backoff&lt;/span&gt;
&lt;span class="na"&gt;Content-Length&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="l"&gt;209&lt;/span&gt;
&lt;span class="na"&gt;Content-Type&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="l"&gt;application/json; charset=UTF-8&lt;/span&gt;
&lt;span class="na"&gt;Date&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="l"&gt;Wed, 18 Nov 2015 08:22:18 GMT&lt;/span&gt;
&lt;span class="na"&gt;Etag&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="l"&gt;"1447834938251"&lt;/span&gt;
&lt;span class="na"&gt;Last-Modified&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="l"&gt;Wed, 18 Nov 2015 08:22:18 GMT&lt;/span&gt;
&lt;span class="na"&gt;Location&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="l"&gt;http://localhost:8888/v1/buckets/website/collections/assets/c2ce1975-0e52-4b2f-a5db-80166aeca689&lt;/span&gt;
&lt;span class="na"&gt;Server&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="l"&gt;waitress&lt;/span&gt;

&lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nt"&gt;"filename"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"background.jpg"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="nt"&gt;"hash"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"db511d372e98725a61278e90259c7d4c5484fc7a781d7dcc0c93d53b8929e2ba"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="nt"&gt;"location"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"/files/MDcxJDAiBgNVBAMTG1JDUyBDZXJ0aWZpY2.jpg"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="nt"&gt;"mimetype"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"image/jpeg"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="nt"&gt;"size"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;1481798&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;L'enregistrement lié a été créé, et contient un attribut &lt;tt class="docutils literal"&gt;attachment&lt;/tt&gt; avec les
metadonnées du fichier, ainsi que les attributs supplémentaires spécifiés lors de l'envoi :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="err"&gt;$ http --auth alice: GET \&lt;/span&gt;
&lt;span class="err"&gt;      http://localhost:8888/v1/buckets/website/collections/assets/records/c2ce1975-0e52-4b2f-a5db-80166aeca689&lt;/span&gt;

&lt;span class="kr"&gt;HTTP&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="m"&gt;1.1&lt;/span&gt; &lt;span class="m"&gt;200&lt;/span&gt; &lt;span class="ne"&gt;OK&lt;/span&gt;
&lt;span class="na"&gt;Access-Control-Expose-Headers&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="l"&gt;Content-Length, Expires, Alert, Retry-After, Last-Modified, ETag, Pragma, Cache-Control, Backoff&lt;/span&gt;
&lt;span class="na"&gt;Cache-Control&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="l"&gt;no-cache&lt;/span&gt;
&lt;span class="na"&gt;Content-Length&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="l"&gt;360&lt;/span&gt;
&lt;span class="na"&gt;Content-Type&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="l"&gt;application/json; charset=UTF-8&lt;/span&gt;
&lt;span class="na"&gt;Date&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="l"&gt;Wed, 18 Nov 2015 08:24:15 GMT&lt;/span&gt;
&lt;span class="na"&gt;Etag&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="l"&gt;"1447834938251"&lt;/span&gt;
&lt;span class="na"&gt;Last-Modified&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="l"&gt;Wed, 18 Nov 2015 08:22:18 GMT&lt;/span&gt;
&lt;span class="na"&gt;Server&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="l"&gt;waitress&lt;/span&gt;

&lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nt"&gt;"data"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="nt"&gt;"id"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"c2ce1975-0e52-4b2f-a5db-80166aeca688"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="nt"&gt;"last_modified"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;1447834938251&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="nt"&gt;"theme"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"orange"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="nt"&gt;"type"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"wallpaper"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="nt"&gt;"attachment"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
            &lt;span class="nt"&gt;"filename"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"background.jpg"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
            &lt;span class="nt"&gt;"hash"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"db511d372e98725a61278e90259c7d4c5484fc7a781d7dcc0c93d53b8929e2ba"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
            &lt;span class="nt"&gt;"location"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"/files/MDcxJDAiBgNVBAMTG1JDUyBDZXJ0aWZpY2.jpg"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
            &lt;span class="nt"&gt;"mimetype"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"image/jpeg"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
            &lt;span class="nt"&gt;"size"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;1481798&lt;/span&gt;
        &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="p"&gt;},&lt;/span&gt;
    &lt;span class="nt"&gt;"permissions"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="nt"&gt;"write"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;"basicauth:6de355038fd943a2dc91405063b91018bb5dd97a08d1beb95713d23c2909748f"&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Il est également possible de supprimer un attachment en effectuant une requête
&lt;tt class="docutils literal"&gt;DELETE&lt;/tt&gt; sur le &lt;tt class="docutils literal"&gt;/attachment&lt;/tt&gt; de l'enregistrement.&lt;/p&gt;
&lt;p&gt;Si l'attribut &lt;tt class="docutils literal"&gt;attachment&lt;/tt&gt; est supprimé de l'enregistrement, le lien avec le
fichier est tout de même conservé en interne, notamment pour s'assurer de sa suppression
lors de la suppression de l'enregistrement.&lt;/p&gt;
&lt;div class="section" id="fichiers-multiples"&gt;
&lt;h3&gt;Fichiers multiples&lt;/h3&gt;
&lt;p&gt;Il est possible de simuler l'ajout de plusieurs fichiers par enregistrements en
utilisant une collection séparée, avec un attribut &lt;tt class="docutils literal"&gt;record_id&lt;/tt&gt; par exemple :
&lt;tt class="docutils literal"&gt;GET &lt;span class="pre"&gt;/buckets/kept/collections/attachments/records?record_id=&amp;lt;id&amp;gt;&lt;/span&gt;&lt;/tt&gt;.&lt;/p&gt;
&lt;p&gt;En revanche l'intégrité lors de la suppression de l'enregistrement lié devra être
assurée manuellement (&lt;tt class="docutils literal"&gt;DELETE &lt;span class="pre"&gt;/.../attachments/records?record_id=&amp;lt;id&amp;gt;&lt;/span&gt;&lt;/tt&gt;).&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="demo"&gt;
&lt;h2&gt;Démo&lt;/h2&gt;
&lt;p&gt;Si vous avez du feedback sur ces premiers pas, n'hésitez pas à nous en faire
part !&lt;/p&gt;
&lt;p&gt;&lt;a class="reference external" href="https://github.com/Kinto/kinto-attachment/"&gt;Une première implémentation a été commencée&lt;/a&gt;,
en utilisant &lt;a class="reference external" href="https://github.com/danjac/pyramid_storage"&gt;Pyramid Storage&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Nous avons déjà eu l'occasion de tester l'API en soirée et ce fût un véritable succès!&lt;/p&gt;
&lt;img alt="Kinto-attachment et le bot Telegram en soirée - CC0" class="align-center" src="http://www.servicedenuages.fr/images/kinto-telegram-betahaus.jpg" style="width: 1280px; height: auto; max-width: 100%;"/&gt;
&lt;p&gt;Dans &lt;a class="reference external" href="https://github.com/leplatrem/kinto-telegram-wall"&gt;ce petit projet&lt;/a&gt;, un
bot Telegram reçoit des messages et des contenus multimedia, et les transmet à
un serveur &lt;em&gt;Kinto&lt;/em&gt; sous forme de fichiers joints.&lt;/p&gt;
&lt;p&gt;Une page Web synchronize et affiche les images, videos et sons en direct sur l'écran géant!
Pendant la soirée, tout le monde a adoré envoyer un petit quelquechose, et il a suffi de faire une archive
du répertoire de &lt;em&gt;kinto-attachment&lt;/em&gt; pour distribuer un paquet de chouettes souvenirs!&lt;/p&gt;
&lt;/div&gt;
</summary><category term="mozilla"></category></entry><entry><title>La difficile promesse de l'auto-hébergement</title><link href="http://www.servicedenuages.fr/difficile-promesse-autohebergement" rel="alternate"></link><published>2015-10-05T00:00:00+02:00</published><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2015-10-05:difficile-promesse-autohebergement</id><summary type="html">&lt;p&gt;Au détour de quelques conversations, nous avons pu nous rendre compte que notre
vision de &lt;a class="reference external" href="https://kinto.readthedocs.io"&gt;Kinto&lt;/a&gt; est celle d'un hébergement
communautaire décentralisé plutôt que celle d'un ensemble de petits serveurs
personnels. Explications.&lt;/p&gt;
&lt;p&gt;Kinto veut répondre à deux besoins principaux de la plupart des utilisateurs du
Web : stocker et partager des données, sans que ceux-ci perdent le contrôle
sur leurs données.&lt;/p&gt;
&lt;p&gt;Si Kinto doit être une "base de données pour le Web", alors il est nécessaire
que l'ensemble des personnes puissent facilement avoir accès à un serveur
Kinto.&lt;/p&gt;
&lt;div class="section" id="auto-hebergement"&gt;
&lt;h2&gt;Auto-hébergement&lt;/h2&gt;
&lt;img alt="Maison de campagne -- House, Automn - CC-BY-ND Gunnar Magnusson https://www.flickr.com/photos/matupplevelser/4644386646" class="align-center" src="http://www.servicedenuages.fr/images/autohebergement.jpg" style="width: 640px; height: auto; max-width: 100%;"/&gt;
&lt;p&gt;Déployer des serveurs n'est pas actuellement chose aisée. Nombre
d'initiatives visent à rendre ce déploiement plus simple, mais les défis
techniques sont encore nombreux avant d'aboutir à une solution "plug and play"
qui soit aisément maintenable dans le temps.&lt;/p&gt;
&lt;p&gt;Les serveurs doivent être maintenus à jour pour éviter les failles de sécurité
et qu'ils restent disponibles pour ceux qui en ont besoin.&lt;/p&gt;
&lt;p&gt;On le voit bien sur nos systèmes déployés : il nous est nécessaire d'avoir
recours à des "administrateurs" pour ces tâches. Et croyez nous,
si ces interventions étaient facilement automatisables, elles le seraient
déjà ! (personne ne souhaite se lever au milieu de la nuit pour résoudre les
soucis des autres)&lt;/p&gt;
&lt;p&gt;Nous ne sommes malheureusement pas arrivés à un état de l'art qui permette à
tout un chacun de s'auto-héberger de manière simple et pérenne.&lt;/p&gt;
&lt;p&gt;Un réel travail est donc nécessaire afin d'avoir un service de qualité.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="acentre"&gt;
&lt;h2&gt;Acentré&lt;/h2&gt;
&lt;p&gt;Une solution praticable semble la mise en place d'un système avec plusieurs
centres, &lt;em&gt;acentré&lt;/em&gt;, donc décentralisé.&lt;/p&gt;
&lt;p&gt;Plutôt que d'avoir un seul endroit où les données sont stockées, on pourrait
imaginer avoir un ou plusieurs serveurs par communauté (Tetaneutral,
Framasoft, EFF, LUG de votre ville …), factorisant alors les coûts (humains et
monétaires) de mise en production. Cela permet donc d'administrer un seul
serveur pour plusieurs personnes / applications.&lt;/p&gt;
&lt;p&gt;Je vous vois, à deux doigts de bougonner : "Il est mignon avec ses serveurs
communautaires mais mes données personnelles je préfère quand même ne pas les
donner à n'importe qui !". Et vous auriez raison !&lt;/p&gt;
&lt;p&gt;Kinto permet de stocker n'importe quel type de données. Qu'il s'agisse de données
qui ont vocation à être partagées ou de données qui sont les vôtres et qui
doivent rester privées.&lt;/p&gt;
&lt;p&gt;Un de nos objectifs est de rendre le chiffrement des données extrêmement simple afin
que personne (sinon vous) ne soit capable de les lire.&lt;/p&gt;
&lt;p&gt;Kinto.js le permet d'ailleurs d'ores et déjà, comme Michiel le démontre &lt;a class="reference external" href="http://www.servicedenuages.fr/kinto-chiffrer-ses-donnees"&gt;dans
un article paru précedemment ici&lt;/a&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="eviter-la-creation-d-un-nouveau-silo"&gt;
&lt;h2&gt;Éviter la création d'un nouveau silo&lt;/h2&gt;
&lt;img alt="Le futur des silos - CC-BY-NC-ND Sunflower Silo in Boulder County Colorado by Bo Insogna — https://www.flickr.com/photos/thelightningman/5494666930" class="align-center" src="http://www.servicedenuages.fr/images/silo.jpg" style="width: 640px; height: auto; max-width: 100%;"/&gt;
&lt;p&gt;Afin d'éviter de participer à la création d'un nouveau silo, il est important
de lever quelques points de vigilance :&lt;/p&gt;
&lt;div class="section" id="identite"&gt;
&lt;h3&gt;Identité&lt;/h3&gt;
&lt;p&gt;Un des points qui permet aux silos actuels (Facebook, Twitter) de perdurer,
c'est en partie leur système d'identification. Vous souhaitez partager des
données avec votre cousine, mais vous n'avez que son "compte Facebook" pour la
joindre.&lt;/p&gt;
&lt;p&gt;C'est très certainement un fait malheureux, mais tentons de résoudre un
problème à la fois (malheureusement, la tentative d'identité décentralisé —
Mozilla Persona — bât sérieusement de l'aile).&lt;/p&gt;
&lt;p&gt;Laissons donc les personnes s'authentifier avec la solution de leur choix,
libre ou non (OpenID, Firefox Accounts, Github, Twitter, Facebook etc.) &lt;em&gt;mais&lt;/em&gt;
redonnons leur le choix de l'endroit ou leurs données sont, elles, stockées.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="interoperabilite"&gt;
&lt;h3&gt;Interopérabilité&lt;/h3&gt;
&lt;p&gt;Peu importe la solution de stockage de données que vous choisissez, il est
indispensable qu'il existe des interfaces, des formats, pour passer de l'une
à l'autre.&lt;/p&gt;
&lt;p&gt;Kinto expose (avant tout) une API HTTP (certains diraient RESTful) qui parle
JSON, ce qui rend son intégration avec d'autres solutions aisée.&lt;/p&gt;
&lt;p&gt;Dans un premier temps, cela peut être simplement des fonctionnalités
d'import / export d'une solution vers une autre, mais il est préférable de se
mettre d'accord sur un format pour cet échange, sans quoi un standard
&lt;em&gt;de facto&lt;/em&gt; émergera, pour le meilleur et pour le pire !&lt;/p&gt;
&lt;p&gt;Il est donc primordial d'entamer un travail de collaboration
avec les autres systèmes de "clouds privés" tels que OwnCloud ou CozyCloud.&lt;/p&gt;
&lt;p&gt;Ces derniers ont d'ailleurs mis en place &lt;a class="reference external" href="https://github.com/Decentralized-Sharing-Working-Group/internet-draft"&gt;un groupe de
travail&lt;/a&gt;
sur le sujet, qui vise à utiliser MicroPub et WebMention comme briques de départ.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="decentralisation"&gt;
&lt;h3&gt;Décentralisation&lt;/h3&gt;
&lt;p&gt;La mise en place de serveurs communautaires n'empêche bien sûr pas l'utilisation
de serveurs personnels pour les utilisateurs les plus aguerris.&lt;/p&gt;
&lt;p&gt;Dans un tel cas, les serveurs communautaires peuvent alors servir de sauvegarde,
en cas de défaillance des serveurs personnels (ou vice-versa, les serveurs
personnels pouvant redonder les serveurs communautaires).&lt;/p&gt;
&lt;p&gt;Il est tout à fait imaginable d'avoir des petits serveurs Kinto pour
chaque utilisateur, mais il va falloir procéder par étapes et défricher le
terrain avant d'avoir un &lt;em&gt;one click&lt;/em&gt; pour &lt;em&gt;Tatie Jeannine&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;La clé ici est sans doute l'essaimage : commencez à utiliser le serveur Kinto
de Framasoft (ou autre) puis migrez vers votre propre serveur, une fois
l'ensemble des problèmes techniques (évoqués précédemment) résolus.&lt;/p&gt;
&lt;p&gt;En attendant, une approche reposant sur plusieurs communautés semble être une
solution pragmatique sur le court/moyen terme, rendant certaines libertés
aux utilisateurs et ouvrant la voie pour le futur.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
</summary><category term="mozilla"></category></entry><entry><title>Comment chiffrer ses données avec Kinto.js</title><link href="http://www.servicedenuages.fr/kinto-chiffrer-ses-donnees" rel="alternate"></link><published>2015-09-16T00:00:00+02:00</published><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2015-09-16:kinto-chiffrer-ses-donnees</id><summary type="html">&lt;div class="note"&gt;
&lt;p class="first admonition-title"&gt;Note&lt;/p&gt;
&lt;p class="last"&gt;Traduit de l'anglais par &lt;a class="reference external" href="https://twitter.com/Natim"&gt;Rémy Hubscher&lt;/a&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;Voici un article rédigé par &lt;a class="reference external" href="https://michielbdejong.com/"&gt;Michiel de Jong&lt;/a&gt; de l'équipe Firefox OS.&lt;/p&gt;
&lt;p&gt;Lorsqu'on souhaite sauvegarder les données d'une application
"Offline-first" (qui fonctionne normalement hors connexion) de manière
chiffrée dans le cloud, il est raisonnable de les garder déchiffrées
localement et de les chiffrer uniquement avant de les téléverser vers
un serveur distant.&lt;/p&gt;
&lt;p&gt;Ainsi, il est facile et efficace d'y accéder pour les afficher ou
mettre à jour la copie locale, sans avoir le coût répété de les
chiffrer/déchiffrer à chaque opération.&lt;/p&gt;
&lt;p&gt;De la même manière, on peut déchiffrer les données venant du serveur
une seule fois, tout de suite après les avoir téléchargées et
l'application peut ensuite afficher les données aussi souvent que
nécessaire sans coût de calculs supplémentaires.&lt;/p&gt;
&lt;p&gt;Synchroniser les données d'une telle application vers et depuis "le
cloud" est une science en elle-même et &lt;a class="reference external" href="https://github.com/Kinto/kinto.js"&gt;Kinto.js&lt;/a&gt; est un outil brillant pour le
faire, développé par la toute aussi brillante équipe du Service de
nuages de Mozilla. La release 1.0 ne devrait plus tarder et vous en
saurez sûrement plus sur ce blog très prochainement.&lt;/p&gt;
&lt;p&gt;Il se trouve que Kinto.js supporte maintenant les &lt;a class="reference external" href="http://kintojs.readthedocs.io/en/latest/api/#transformers"&gt;RemoteTransformers&lt;/a&gt;, qui
permettent de manière très simple d'appliquer n'importe quel type de
transformations que vous souhaitez faire sur les enregistrements d'une
collection avant qu'ils ne soient stockés dans la base de données
locale (&lt;tt class="docutils literal"&gt;RemoteTransformer#decode&lt;/tt&gt;) mais aussi avant qu'ils ne
soient sauvegardés sur le serveur distant
(&lt;tt class="docutils literal"&gt;RemoteTransformer#encode&lt;/tt&gt;).&lt;/p&gt;
&lt;p&gt;Cet article de blog montre comment utiliser un &lt;tt class="docutils literal"&gt;RemoteTransformer&lt;/tt&gt;
pour chiffrer vos données juste avant de les envoyer dans les
nuages. De plus nous utilisons l'API
&lt;a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto"&gt;WebCrypto&lt;/a&gt;
pour la partie cryptographie.&lt;/p&gt;
&lt;p&gt;Notez que je ne suis pas un expert en sécurité et que ce code est
simplement un exemple écrit en une après-midi. Si vous copiez/collez
ce code, ne l'utilisez pas pour quoi que ce soit de sensible sans
avoir fait votre propre revue de sécurité au préalable ! :) Par
exemple il n'y a aucune dérivation de la clé de chiffrement, etc.,
c'est uniquement un chiffrement/déchiffrement très basique pour la
démonstration.&lt;/p&gt;
&lt;p&gt;L'idée derrière un &lt;tt class="docutils literal"&gt;RemoteTransformer&lt;/tt&gt; c'est d'exposer deux
fonctions, &lt;tt class="docutils literal"&gt;encode&lt;/tt&gt; et &lt;tt class="docutils literal"&gt;decode&lt;/tt&gt;, et Kinto.js s'assure d'appeler la
fonction &lt;tt class="docutils literal"&gt;encode&lt;/tt&gt; sur chaque enregistrement qui est téléversé dans
le cloud et d'appeler &lt;tt class="docutils literal"&gt;decode&lt;/tt&gt; sur chaque enregistrement
téléchargé. Vous pouvez en lire plus à ce sujet
&lt;a class="reference external" href="http://kintojs.readthedocs.io/en/latest/api/#transformers"&gt;dans la documentation de Kinto.js&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;La manière dont nous indiquons à Kinto.js d'utiliser nos fonctions
&lt;tt class="docutils literal"&gt;encode&lt;/tt&gt; et &lt;tt class="docutils literal"&gt;decode&lt;/tt&gt; est assez simple. Lorsqu'on créé une
collection Kinto, on passe en paramètre un &lt;tt class="docutils literal"&gt;RemoteTransformer&lt;/tt&gt;. Le
code d'exemple complet se trouve &lt;a class="reference external" href="http://www.servicedenuages.fr/scripts/kinto-encryption-example.js"&gt;ici&lt;/a&gt;
(notez qu'il ne fonctionne pour l'instant qu'avec
&lt;a class="reference external" href="http://www.servicedenuages.fr/scripts/kinto-61ad959.min.js"&gt;la dernière version de Kinto.js master&lt;/a&gt;),
mais regardons le code étape par étape.&lt;/p&gt;
&lt;p&gt;Si vous n'êtes pas familier avec ES6, vous pouvez être un peu surpris par sa syntaxe ; utilisons cette opportunité pour nous y habituer ! Voici une petite table de correspondance :&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;a class="reference external" href="http://babeljs.io/docs/learn-es2015/#arrows-and-lexical-this"&gt;() =&amp;gt; {}&lt;/a&gt; correspond à &lt;tt class="docutils literal"&gt;(function() &lt;span class="pre"&gt;{}).bind(this)&lt;/span&gt;&lt;/tt&gt;.&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="http://babeljs.io/docs/learn-es2015/#let-const"&gt;const foo = 'bar'; let foo = 'bar';&lt;/a&gt; correspondent à &lt;tt class="docutils literal"&gt;var foo = 'bar'&lt;/tt&gt;.&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="http://babeljs.io/docs/learn-es2015/#enhanced-object-literals"&gt;{ a, b }&lt;/a&gt; correspond à &lt;tt class="docutils literal"&gt;{ a: a, b: b }&lt;/tt&gt;.&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="http://babeljs.io/docs/learn-es2015/#template-strings"&gt;`Hello ${foo}`&lt;/a&gt; (notez les backticks) correspond à &lt;tt class="docutils literal"&gt;'Hello ' + foo&lt;/tt&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Pour commencer, nous avons besoin de quelques fonctions utilitaires
que nous utiliserons plus tard pour convertir des &lt;a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Typed_arrays"&gt;byte arrays&lt;/a&gt;
en chaînes de caractères ASCII et inversemment.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;// Helper functions:&lt;/span&gt;
&lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;rawStringToByteArray&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;str&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;strLen&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;str&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;length&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;byteArray&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nx"&gt;Uint8Array&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;strLen&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;i&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="nx"&gt;i&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="nx"&gt;strLen&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nx"&gt;byteArray&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;str&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;charCodeAt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="p"&gt;}&lt;/span&gt;
  &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;byteArray&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;};&lt;/span&gt;
&lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;base64StringToByteArray&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;base64&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;rawStringToByteArray&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;atob&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;base64&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;
&lt;span class="p"&gt;};&lt;/span&gt;
&lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;byteArrayToBase64String&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;buffer&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;bytes&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nx"&gt;Uint8Array&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;buffer&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;binary&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;''&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nx"&gt;bytes&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;byteLength&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="nx"&gt;binary&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="nb"&gt;String&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;fromCharCode&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;bytes&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="p"&gt;]);&lt;/span&gt;
  &lt;span class="p"&gt;}&lt;/span&gt;
  &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;btoa&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;binary&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="p"&gt;};&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Ensuite, nous devons créer un &lt;tt class="docutils literal"&gt;RemoteTransformer&lt;/tt&gt; qui peut chiffrer et déchiffrer nos enregistrements. Et pour cela, nous avons besoin de générer une clé de chiffrement symétrique
&lt;a class="reference external" href="https://en.wikipedia.org/wiki/Advanced_Encryption_Standard"&gt;AES&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto"&gt;WebCrypto&lt;/a&gt; est
une API vraiment géniale et assez récente de
&lt;a class="reference external" href="https://platform.html5.org/"&gt;la plateforme web&lt;/a&gt;  !
Nous allons utiliser cette clé de chiffrement pour
chiffrer et déchiffrer les données qui vont passer dans notre
&lt;tt class="docutils literal"&gt;RemoteTransformer&lt;/tt&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;// RemoteTransformer:&lt;/span&gt;
&lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;generateAesKey&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="c1"&gt;// See http://www.w3.org/TR/WebCryptoAPI/#examples-symmetric-encryption&lt;/span&gt;
  &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;crypto&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;subtle&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;generateKey&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt; &lt;span class="nx"&gt;name&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;'AES-GCM'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;length&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;128&lt;/span&gt; &lt;span class="p"&gt;},&lt;/span&gt;
       &lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;'encrypt'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;'decrypt'&lt;/span&gt;&lt;span class="p"&gt;]);&lt;/span&gt;
&lt;span class="p"&gt;};&lt;/span&gt;

&lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;createTransformer&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;aesKey&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;encode&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;record&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;cleartext&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;rawStringToByteArray&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;JSON&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;stringify&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;record&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;
    &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;IV&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;crypto&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;getRandomValues&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nx"&gt;Uint8Array&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;16&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;

    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;crypto&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;subtle&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;encrypt&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt; &lt;span class="nx"&gt;name&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;'AES-GCM'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;iv&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="nx"&gt;IV&lt;/span&gt; &lt;span class="p"&gt;},&lt;/span&gt; &lt;span class="nx"&gt;aesKey&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="nx"&gt;cleartext&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;ciphertext&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="nx"&gt;id&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="nx"&gt;record&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="nx"&gt;ciphertext&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="nx"&gt;byteArrayToBase64String&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nx"&gt;Uint8Array&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;ciphertext&lt;/span&gt;&lt;span class="p"&gt;)),&lt;/span&gt;
        &lt;span class="nx"&gt;IV&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="nx"&gt;byteArrayToBase64String&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;IV&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="p"&gt;};&lt;/span&gt;
    &lt;span class="p"&gt;});&lt;/span&gt;
  &lt;span class="p"&gt;};&lt;/span&gt;

  &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;decode&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;record&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;ciphertext&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;base64StringToByteArray&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;record&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;ciphertext&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;IV&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;base64StringToByteArray&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;record&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;IV&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;crypto&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;subtle&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;decrypt&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt; &lt;span class="nx"&gt;name&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;'AES-GCM'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;iv&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="nx"&gt;IV&lt;/span&gt; &lt;span class="p"&gt;},&lt;/span&gt; &lt;span class="nx"&gt;aesKey&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="nx"&gt;ciphertext&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;recordArrayBuffer&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;

      &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;JSON&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;parse&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;String&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;fromCharCode&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;apply&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
          &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nx"&gt;Uint8Array&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;recordArrayBuffer&lt;/span&gt;&lt;span class="p"&gt;)));&lt;/span&gt;
    &lt;span class="p"&gt;},&lt;/span&gt; &lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="nx"&gt;record&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;undecryptable&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
      &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;record&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;});&lt;/span&gt;
  &lt;span class="p"&gt;};&lt;/span&gt;

  &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nx"&gt;encode&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="nx"&gt;decode&lt;/span&gt;
  &lt;span class="p"&gt;};&lt;/span&gt;
&lt;span class="p"&gt;};&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Nous créons deux instances Kinto, afin de pouvoir faire des tests de
synchronisation d'une instance à l'autre à l'aide du serveur de démo
de Kinto. Créer plusieurs instances Kinto depuis la même origine est
possible à l'aide de la toute récente option &lt;tt class="docutils literal"&gt;dbPrefix&lt;/tt&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;// Kinto collection:&lt;/span&gt;
&lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;createCollection&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;transformer&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;testRun&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;instanceNo&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;kinto&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nx"&gt;Kinto&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt;
    &lt;span class="nx"&gt;dbPrefix&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="sb"&gt;`&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nx"&gt;testRun&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="sb"&gt;-&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nx"&gt;instanceNo&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="sb"&gt;`&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="nx"&gt;remote&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;'https://kinto.dev.mozaws.net/v1/'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="nx"&gt;headers&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="nx"&gt;Authorization&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;'Basic '&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="nx"&gt;btoa&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'public-demo:s3cr3t'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
  &lt;span class="p"&gt;});&lt;/span&gt;

  &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;kinto&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;collection&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sb"&gt;`kinto-encryption-example-&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nx"&gt;testRun&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="sb"&gt;`&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nx"&gt;remoteTransformers&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt; &lt;span class="nx"&gt;transformer&lt;/span&gt; &lt;span class="p"&gt;]&lt;/span&gt;
  &lt;span class="p"&gt;});&lt;/span&gt;
&lt;span class="p"&gt;};&lt;/span&gt;

&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;coll1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;coll2&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;prepare&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;generateAesKey&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;aesKey&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;createTransformer&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;aesKey&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="p"&gt;}).&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;transformer&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="c1"&gt;// Create two fresh empty Kinto instances for testing:&lt;/span&gt;
    &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;testRun&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nb"&gt;Date&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="nx"&gt;getTime&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="nx"&gt;toString&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
    &lt;span class="nx"&gt;coll1&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;createCollection&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;transformer&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;testRun&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="nx"&gt;coll2&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;createCollection&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;transformer&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;testRun&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="p"&gt;});&lt;/span&gt;
&lt;span class="p"&gt;};&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Maintenant, testons que nous puissions créer un nouvel enregistrement
dans la collection 1, synchronisons-le (les données envoyées au
serveur doivent être chiffrées, ce qu'on peut vérifier avec l'onglet
Réseau de la console du navigateur):&lt;/p&gt;
&lt;img alt="Onglet Réseau de la console Firefox" src="http://www.servicedenuages.fr/images/kinto-encryption-example-network-tab.png" style="width: 2560px; height: auto; max-width: 100%;"/&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;syncUp&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="c1"&gt;// Use first Kinto instance to demonstrate encryption:&lt;/span&gt;
  &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;coll1&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;create&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt;
    &lt;span class="nx"&gt;URL&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;'http://www.w3.org/TR/WebCryptoAPI/'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="nx"&gt;name&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;'Web Cryptography API'&lt;/span&gt;
  &lt;span class="p"&gt;}).&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(()&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;coll1&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;sync&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
  &lt;span class="p"&gt;}).&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;syncResults&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nx"&gt;console&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;log&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'Sync up'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;syncResults&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="p"&gt;});&lt;/span&gt;
&lt;span class="p"&gt;};&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Puis synchronisons la collection 2 depuis le serveur Kinto. Là encore,
les données téléchargées doivent être chiffrées mais les données
déchiffrées doivent être stockées dans la base IndexDB et affichées
dans le résultat de la synchronisation. Finalement, la fonction
&lt;tt class="docutils literal"&gt;go()&lt;/tt&gt; permet de lancer tout le processus de test.&lt;/p&gt;
&lt;p&gt;Le code source complet est inclus dans la page que vous êtes
actuellement en train de lire, alors n'hésitez-pas, ouvrez la console
du navigateur et essayez en lançant la fonction &lt;tt class="docutils literal"&gt;go()&lt;/tt&gt;!&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;syncDown&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="c1"&gt;// Use second Kinto instance to demonstrate decryption:&lt;/span&gt;
  &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;coll2&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;sync&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;syncResults&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nx"&gt;console&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;log&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'Sync down'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;syncResults&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="p"&gt;});&lt;/span&gt;
&lt;span class="p"&gt;};&lt;/span&gt;

&lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;go&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="nx"&gt;console&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;log&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'Watch the Network tab!'&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;prepare&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
      &lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;syncUp&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;syncDown&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;a&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="nx"&gt;console&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;log&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'Success'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;a&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="nx"&gt;b&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="nx"&gt;console&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;error&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'Failure'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;b&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;
&lt;span class="p"&gt;};&lt;/span&gt;
&lt;span class="nx"&gt;console&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;log&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'Type go(); to start!'&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;J'espère que vous êtes autant enthousiastes au sujet de Kinto.js que je le
suis, les commentaires sur cet article ainsi que
&lt;a class="reference external" href="https://github.com/michielbdejong/kinto-encryption-example/"&gt;les tickets Github sur le dépôt de l'exemple&lt;/a&gt;
sont les bienvenus ! :)&lt;/p&gt;
</summary><category term="mozilla"></category></entry><entry><title>Garantir l'intégrité des données via des signatures</title><link href="http://www.servicedenuages.fr/donnees-et-signatures" rel="alternate"></link><published>2015-08-26T00:00:00+02:00</published><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2015-08-26:donnees-et-signatures</id><summary type="html">&lt;p&gt;Dans le cadre du projet &lt;a class="reference external" href="https://wiki.mozilla.org/Firefox/Go_Faster"&gt;Go Faster&lt;/a&gt;, nous souhaitons distribuer des
mises à jour de parties de &lt;em&gt;Firefox&lt;/em&gt; de manière séparée des mises à jour majeures
(qui ont lieu toutes les 6 semaines).&lt;/p&gt;
&lt;p&gt;Les données que nous souhaitons mettre à jour sur les clients sont multiples.
Entre autres, nous souhaitons gérer &lt;a class="reference external" href="https://blog.mozilla.org/security/2015/03/03/revoking-intermediate-certificates-introducing-onecrl/"&gt;la mise à jour des listes de révocation
(CRL) de certificats SSL&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Il est évidemment nécessaire de s'assurer que les données qui sont téléchargées
sur les client sont légitimes : que personne ne tente d'invalider des
certificats alors qu'ils sont valides, et que l'ensemble des mises à jour sont
bel et bien récupérées sur le client.&lt;/p&gt;
&lt;p&gt;La signature garantit qu'une mise à jour contient tous les enregistrements, mais il
est toujours possible de bloquer l'accès au service (par exemple avec le &lt;em&gt;china
great firewall&lt;/em&gt;).&lt;/p&gt;
&lt;p&gt;Ce mécanisme fonctionne pour les listes de certificats à révoquer, mais pas
uniquement. Nous comptons réutiliser ce même fonctionnement dans le futur pour
la mise à jour d'autres parties de Firefox, et vous pouvez également en tirer
parti pour d'autres cas d'utilisation.&lt;/p&gt;
&lt;p&gt;Nous souhaitons utiliser &lt;a class="reference external" href="https://kinto.readthedocs.io"&gt;Kinto&lt;/a&gt; afin
de distribuer ces jeux de données. Un des avantages est que l'on peut
facilement &lt;em&gt;cacher&lt;/em&gt; les collections derrière un CDN.&lt;/p&gt;
&lt;p&gt;Par contre, nous ne souhaitons pas que les clients fassent
confiance aveuglément, ni au serveur Kinto, ni au CDN.&lt;/p&gt;
&lt;p&gt;Effectivement, un attaquant, contrôlant l'un ou l'autre, pourrait
alors envoyer les mises à jour qu'il souhaite à l'ensemble des clients
ou supprimer des certificats révoqués. Imaginez le carnage !&lt;/p&gt;
&lt;p&gt;Afin de résoudre ce problème, considérons les conditions suivantes:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;La personne qui a le pouvoir de mettre à jour les CRL (&lt;em&gt;l'updater&lt;/em&gt;)
a accès à une cle de signature (ou mieux, &lt;a class="reference external" href="https://fr.wikipedia.org/wiki/Hardware_Security_Module"&gt;un HSM&lt;/a&gt;) qui lui permet de
signer la collection;&lt;/li&gt;
&lt;li&gt;Le pendant public de ce certificat est stocké et distribué dans Firefox;&lt;/li&gt;
&lt;li&gt;Le &lt;em&gt;hashing&lt;/em&gt; et la &lt;em&gt;signature&lt;/em&gt; sont faits côté client pour éviter certains
vecteurs d'attaque (si un attaquant a la main sur le serveur Kinto par
exemple).&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Le chiffrement à sens unique, aussi appellé &lt;em&gt;hashing&lt;/em&gt; est un moyen de toujours
obtenir le même résultat à partir de la même entrée.&lt;/p&gt;
&lt;div class="section" id="premier-envoi-de-donnees-sur-kinto"&gt;
&lt;h2&gt;Premier envoi de données sur Kinto&lt;/h2&gt;
&lt;p&gt;L'ensemble des données est récupéré depuis une source &lt;em&gt;sécurisée&lt;/em&gt; puis mis dans
une collection JSON. Chaque élément contient un identifiant unique généré sur
le client.&lt;/p&gt;
&lt;p&gt;Par exemple, un enregistrement peut ressembler à :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;"id"&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"b7dded96-8df0-8af8-449a-8bc47f71b4c4"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
 &lt;span class="s2"&gt;"fingerprint"&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"11:D5:D2:0A:9A:F8:D9:FC:23:6E:5C:5C:30:EC:AF:68:F5:68:FB:A3"&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Le &lt;em&gt;hash&lt;/em&gt; de la collection est ensuite calculé, signé puis envoyé au serveur
(voir plus bas pour les détails).&lt;/p&gt;
&lt;p&gt;La signature est déportée sur un service qui ne s'occupe que de ça, puisque la
sécurité du certificat qui s'occupe des signatures est extrêmement importante.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="comment-verifier-l-integrite-des-donnees"&gt;
&lt;h2&gt;Comment vérifier l'intégrité des données ?&lt;/h2&gt;
&lt;p&gt;Premièrement, il faut récupérer l'ensemble des enregistrements présents sur
le serveur, ainsi que le &lt;em&gt;hash&lt;/em&gt; et la signature associée.&lt;/p&gt;
&lt;p&gt;Ensuite, vérifier la signature du &lt;em&gt;hash&lt;/em&gt;, pour s'assurer que celui-ci provient
bien d'un tiers de confiance.&lt;/p&gt;
&lt;p&gt;Finalement, recalculer le &lt;em&gt;hash&lt;/em&gt; localement et valider qu'il correspond bien à
celui qui a été signé.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="ajouter-de-nouvelles-donnees"&gt;
&lt;h2&gt;Ajouter de nouvelles données&lt;/h2&gt;
&lt;p&gt;Pour l'ajout de nouvelles données, il est nécessaire de s'assurer que les
données que l'on a localement sont valides avant de faire quoi que ce soit
d'autre.&lt;/p&gt;
&lt;p&gt;Une fois ces données validées, il suffit de procéder comme la première fois, et
d'envoyer à nouveau le &lt;em&gt;hash&lt;/em&gt; de la collection au serveur.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="comment-calculer-ce-hash"&gt;
&lt;h2&gt;Comment calculer ce hash ?&lt;/h2&gt;
&lt;p&gt;Pour calculer le &lt;em&gt;hash&lt;/em&gt; de la collection, il est nécessaire :&lt;/p&gt;
&lt;ol class="arabic simple"&gt;
&lt;li&gt;D'ordonner l'ensemble des éléments de la collection (par leur id) ;&lt;/li&gt;
&lt;li&gt;Pour chaque élément, sérialiser les champs qui nous intéressent (les
concaténer clé + valeur)&lt;/li&gt;
&lt;li&gt;Calculer le &lt;em&gt;hash&lt;/em&gt; depuis la sérialisation.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Nous sommes encore incertains de la manière dont le hash va être calculé. Les &lt;a class="reference external" href="https://tools.ietf.org/html/draft-ietf-jose-json-web-signature-41"&gt;JSON Web Signature&lt;/a&gt; semblent
une piste intéressante. En attendant, une implementation naïve en python
pourrait ressembler à ceci :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;json&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;hashlib&lt;/span&gt;

&lt;span class="n"&gt;data&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;
   &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;"id"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"b7dded96-8df0-8af8-449a-8bc47f71b4c4"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;"fingerprint"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"11:D5:D2:0A:9A:F8:D9:FC:23:6E:5C:5C:30:EC:AF:68:F5:68:FB:A3"&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;
   &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;"id"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"dded96b7-8f0d-8f8a-49a4-7f771b4c4bc4"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;"fingerprint"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"33:6E:5C:5C:30:EC:AF:68:F5:68:FB:A3:11:D5:D2:0A:9A:F8:D9:FC"&lt;/span&gt;&lt;span class="p"&gt;}]&lt;/span&gt;

&lt;span class="n"&gt;m&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;hashlib&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sha256&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;update&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;json&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;dumps&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;sort_keys&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="n"&gt;collection_hash&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;hexdigest&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Enfin, un schéma pour résumer !&lt;/p&gt;
&lt;img alt="Schema résumant le processus de signature de la collection." class="align-center" src="http://www.servicedenuages.fr/images/kinto-signing.jpg" style="width: 600px; height: auto; max-width: 100%;"/&gt;
&lt;/div&gt;
</summary><category term="mozilla"></category></entry><entry><title>A la recherche d'un assistant en qualité</title><link href="http://www.servicedenuages.fr/wanted-quality-assistant" rel="alternate"></link><published>2015-08-25T00:00:00+02:00</published><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2015-08-25:wanted-quality-assistant</id><summary type="html">&lt;p&gt;Derrière ce titre issu d'une traduction tout à fait questionnable de "Quality
Assistant", nous souhaitons vous faire part d'une annonce tout à fait
remarquable : nous souhaitons recruter une personne pour nous aider à
tester et valider nos services et autres bouts de code.&lt;/p&gt;
&lt;p&gt;Quelqu'un pour remplir la mission de &lt;em&gt;Quality Assistant&lt;/em&gt;. Il faut être capable
de suivre de front plusieurs projets différents, et de les tester dans leurs
moindres recoins. Faire de la montée en charge, de la validation de serveurs de
&lt;em&gt;stage&lt;/em&gt;, de veiller à la qualité du code et de sa bonne couverture de tests.&lt;/p&gt;
&lt;p&gt;Il s'agit d'un poste courant dans les boites américaines, mais beaucoup moins
en France. Or on souhaiterait vraiment avoir quelqu'un sur notre fuseau
horaire, puisque cela facilite énormement la communication, d'où ce billet.&lt;/p&gt;
&lt;p&gt;De notre coté, on est déjà bien branchés qualité : on utilise à fond TravisCI,
on écrit des tests de montée en charge, on cherche toujours à garder une
couverture de tests de 100%, mais quand même, au moment où les QA commencent à
déployer en préproduction et matraquer le service, on fait pas les malins :)&lt;/p&gt;
&lt;p&gt;On passe toujours à coté de détails (importants!) et on va rarement aussi loin
que les QA qui ont vraiment le sens du détail et de la qualité. Ils sont les
gardiens du temple, qui bloquent les passages en production tant que tous leurs
indicateurs ne sont pas au vert. Alors que nous on aurait tendance à plutôt
être optimistes !&lt;/p&gt;
&lt;p&gt;Sur &lt;em&gt;readinglist&lt;/em&gt;, on a travaillé ensemble pour améliorer les perfs qui
s'écroulaient lors des montées en charge de plusieurs heures, et pour peaufiner
les paramètres de conf qui n'étaient pas super intuitifs. C'est le double effet
kisscool : ce qui est remonté peut être amélioré, et pour ce qui ne l'est pas,
on peut se féliciter.&lt;/p&gt;
&lt;p&gt;Toutes les personnes de l'équipe QA ont quelque chose en commun, ce sont des
crèmes. Bien que nous fassions le maximum pour leur éviter la pression, ils sont
en premières lignes et une de leur grosse utilité est justement de faire
diminuer la pression sur tous les membres de l'équipe (devs, ops, etc).&lt;/p&gt;
&lt;p&gt;Si vous vous demandez à quoi ressemble une journée type pour un &lt;em&gt;QA&lt;/em&gt;, ça
pourrait être quelque chose comme ça :&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Faire un point avec Rémy et Alexis qui travaillent sur Firefox Hello : le
nombre de requêtes par secondes (RPS) est vraiment bas sur staging d'après les
derniers tests. Peut-être que quelque chose à évolué dans l'API ? Peut être
s'agit-il d'un problème ?&lt;/li&gt;
&lt;li&gt;Vérifier les changements sur Kinto, une nouvelle version a été tagguée par
Mathieu hier soir, essayons de l'installer pour voir si rien ne manque et si
tout fonctionne correctement ;&lt;/li&gt;
&lt;li&gt;Travailler ses connaissances de Jenkins pour aider les &lt;em&gt;Ops&lt;/em&gt; a déployer en
stage et débugger les problèmes potentiels ;&lt;/li&gt;
&lt;li&gt;Faire le pont entre les devs, les admins système et les différents clients à
propos des &lt;em&gt;deadlines&lt;/em&gt;, pour que personne ne soit surpris ;&lt;/li&gt;
&lt;li&gt;Écrire des tests &lt;em&gt;end to end&lt;/em&gt; sur Kinto pour permettre leur lancement
automatique ;&lt;/li&gt;
&lt;li&gt;Améliorer l'outil de montée en charge que nous utilisons quotidiennement.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Nous sommes à la recherche de quelqu'un qui sait coder, pour améliorer les
outils au fur et à mesure. Il faut :&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Avoir de très bonnes aptitudes relationnelles et communicationnelles ;&lt;/li&gt;
&lt;li&gt;Être capable de designer et d'implémenter des tests "end to end"
fonctionnels, afin de détecter de potentielles régressions ;&lt;/li&gt;
&lt;li&gt;Avoir des connaissances en python et javascript ;&lt;/li&gt;
&lt;li&gt;Être bien organisé pour pouvoir suivre de front la validation de plusieurs
projets ;&lt;/li&gt;
&lt;li&gt;Être capable de supporter les blagues de Tarek, Alexis et Niko (et c'est pas
une mince affaire)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Si vous vous reconnaissez dans cette description, contactez nous ! Le meilleur
moyen étant bien sur IRC, &lt;cite&gt;#storage&lt;/cite&gt; sur le réseau &lt;cite&gt;irc.mozilla.org&lt;/cite&gt;.&lt;/p&gt;
&lt;p&gt;Pour plus d'information sur le poste, vous pouvez &lt;a class="reference external" href="https://careers.mozilla.org/en-US/position/oWHv1fwT"&gt;consulter la fiche de poste&lt;/a&gt;.&lt;/p&gt;
</summary><category term="mozilla"></category></entry><entry><title>Les notifications dans Kinto (Préambule)</title><link href="http://www.servicedenuages.fr/notifications-kinto-preamble" rel="alternate"></link><published>2015-08-13T00:00:00+02:00</published><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2015-08-13:notifications-kinto-preamble</id><summary type="html">&lt;blockquote&gt;
&lt;p&gt;Traduit de l'anglais par &lt;a href="https://twitter.com/Natim"&gt;Rémy Hubscher&lt;/a&gt;.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Lors de notre dernière &lt;em&gt;workweek&lt;/em&gt; dans l'adorable ville de
&lt;a href="https://www.qwant.com/?q=Douarnenez&amp;amp;t=images"&gt;Douarnenez&lt;/a&gt; nous avons
défini les fondations de la prochaine fonctionnalité de
&lt;a href="https://kinto.readthedocs.io"&gt;Kinto&lt;/a&gt; : &lt;em&gt;les notifications !&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="Coucher de soleil sur Douarnenez (@phrawzty)" src="http://www.servicedenuages.fr/images/notifications-douarnenez.jpg" style="width: 800px; height: auto; max-width: 100%;"/&gt;&lt;/p&gt;
&lt;h1&gt;tl;dr&lt;/h1&gt;
&lt;p&gt;Pour les pressés, un petit résumé : Nous allons ajouter
un système de "notifications" à Kinto, sans perdre de vue la
simplicité et la flexibilité. Notre objectif est de
proposer un protocole qui permette à d'autres systèmes de se brancher
très simplement sur les notifications d'événements de Kinto.&lt;/p&gt;
&lt;h1&gt;Pourquoi ?&lt;/h1&gt;
&lt;p&gt;La réponse la plus simple est que nous en avons besoin. Nous
avons une plateforme appelée &lt;a href="https://wiki.mozilla.org/Balrog"&gt;Balrog&lt;/a&gt;
qui fait partie du système de mise à jour utilisé par Firefox et par
d'autres produits Mozilla.&lt;/p&gt;
&lt;p&gt;Dans l'idée d'améliorer et d'étendre le processus de mise à jour (sous
la houlette du projet "&lt;a href="https://wiki.mozilla.org/Firefox/Go_Faster"&gt;Go Faster&lt;/a&gt;"),
nous avons besoin de stocker et de transmettre de petits blocs d'information à
la fois entre des systèmes internes mais aussi avec l'ensemble de nos
utilisateurs.&lt;/p&gt;
&lt;p&gt;Kinto répond parfaitement au besoin, mis à part en ce qui concerne la
notification des utilisateurs lors d'une mise à jour.&lt;/p&gt;
&lt;p&gt;Aucun problème. Il ne reste plus qu'à ajouter la fonctionnalité.&lt;/p&gt;
&lt;h2&gt;Mais attention à ne pas oublier une petite chose !&lt;/h2&gt;
&lt;p&gt;Bien sûr, Kinto est un projet Mozilla - mais il a été conçu comme une
solution générique, ce qui veut dire que tout ce que nous ajoutons
doit rester raisonnablement générique.&lt;/p&gt;
&lt;p&gt;C'est pourquoi nous avons souhaité proposer une solution réutilisable
dans différents contextes ; nous sommes une organisation qui construit
avec et pour le web c'est pourquoi la solution que nous proposons est
avant tout orientée web.&lt;/p&gt;
&lt;p&gt;En faisant le tour des paramètrages qu'une solution raisonnablement
générique devrait proposer, nous avons défini les exigences suivantes
pour notre système de notifications :&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;S'efforcer d'être agnostique autant que possible, c'est-à-dire ne
  pas forcer les développeurs à utiliser une solution
  spécifique. (service, backend voire même langage de programmation)&lt;/li&gt;
&lt;li&gt;Puisque nous sommes orienté web, utiliser le protocole HTTP dès que possible.&lt;/li&gt;
&lt;li&gt;Le système de notification doit être capable de passer à l'échelle
  facilement ; cela s'applique à tous les éventuels systèmes de
  queuing, workers, etc.&lt;/li&gt;
&lt;li&gt;Pour finir ce doit être un système robuste, nous ne souhaitons pas perdre de messages.&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;Qu'est-ce que nous essayons de faire ?&lt;/h1&gt;
&lt;p&gt;Avant de rentrer dans les menus détails, prenons un moment pour
décrire ce que nous essayons de faire - sur le papier, au moins, c'est
assez simple :&lt;/p&gt;
&lt;p&gt;&lt;div class="graphviz" style="align: center;"&gt;&lt;img src="data:image/png;base64,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"/&gt;&lt;/div&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Un &lt;em&gt;message&lt;/em&gt; est un morceau d'information qui est envoyé d'un
  endroit à l'autre - par exemple, une requête HTTP. Les messages
  peuvent venir d'autre part, comme par exemple d'un service externe,
  ou être générés en interne.&lt;/li&gt;
&lt;li&gt;Une &lt;em&gt;action&lt;/em&gt; est un processus qui est déclenché en fonction du
  message. Ça peut être aussi simple qu'incrémenter un compteur en
  mémoire. Ça peut aussi être quelque chose de plus complexe comme par
  exemple déclencher une suite de tests. Ça peut aussi être exécuter
  une fonctionnalité de Kinto, un programme local, une fonctionnalité
  ajoutée par un plugin ou tout autre chose.&lt;/li&gt;
&lt;li&gt;Un &lt;em&gt;résultat&lt;/em&gt;, comme son nom l'indique, est ce qui résulte de
  l'&lt;em&gt;action&lt;/em&gt;. Un exemple simple pourrait être la valeur du compteur,
  dont nous avons parlé tout à l'heure, sous la forme d'un entier dans
  un paquet JSON. Mais ça peut également être le résultat de la suite
  de tests (les possibilités sont sans limites).&lt;/li&gt;
&lt;li&gt;Pris dans leur ensemble, les &lt;em&gt;évènements&lt;/em&gt; peuvent être vus comme un
  cycle : un message est reçu, une action a lieu qui génère un nouveau
  message.&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;Une notification est donc la combinaison d'un message et d'une
  action déclenchée suite à un évènement. Le résultat, bien que
  directement lié à l'action ne fait pas partie de la notification.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Cette petite distinction nécessite une explication. L'instigateur du
message n'est pas forcément concerné par ce que Kinto va faire avec.&lt;/p&gt;
&lt;p&gt;En général, il est suffisant de savoir que Kinto a reçu un message et
qu'il sera traité. Cela permet de bien découpler les différents
éléments du système.&lt;/p&gt;
&lt;p&gt;Nous allons continuer à explorer le sens des termes par la suite. Pour
le moment, continuons.&lt;/p&gt;
&lt;h1&gt;Comment ?&lt;/h1&gt;
&lt;p&gt;Il y autant de manière de faire qu'il y a de grains de sables sur la
plage (ceci dit, nous ne l'avons pas vérifié de manière
scientifique). Le meilleur moyen de déterminer l'approche gagnante
reste le duel (à la Mad Max). Malheureusement notre manager a mis son
véto sur ce moyen pour des questions de responsabilité, à la place
nous avons préféré faire des dessins sur un tableau blanc...&lt;/p&gt;
&lt;p&gt;&lt;img alt="Whiteboard (@leplatrem)" src="http://www.servicedenuages.fr/images/notifications-whiteboard.jpg" style="width: 675px; height: auto; max-width: 100%;"/&gt;&lt;/p&gt;
&lt;p&gt;Dans un esprit de transparence, voici quelques unes des solutions étudiées :&lt;/p&gt;
&lt;h2&gt;L'approche simple&lt;/h2&gt;
&lt;p&gt;La première approche et de pousser chacune des notifications dans une
file d'attente (dans Redis ou RabbitMQ par exemple) et c'est tout.&lt;/p&gt;
&lt;p&gt;&lt;div class="graphviz" style="align: center;"&gt;&lt;img src="data:image/png;base64,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"/&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;Avantages:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Ce modèle impacte peu Kinto, Kinto passe simplement le message à la
  queue et l'oublie immédiatement.&lt;/li&gt;
&lt;li&gt;La quantité de code est assez faible - il ne nécessite que le code
  nécessaire pour parler au système de queue.&lt;/li&gt;
&lt;li&gt;Si la communauté Kinto est active il serait possible d'étendre
  rapidement le support à un nombre raisonnable de service externes de
  files d'attente.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Inconvénients:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Chaque service de queue nécessirait un module spécifique à coder et
  qui devrait être maintenu par la communauté.&lt;/li&gt;
&lt;li&gt;L'utilisateur final (destinataire, destination ou autre) du message
  serait responsable de l'intégration avec le protocole du système de
  queue.  Autrement dit, si Kinto est configuré pour utiliser
  RabbitMQ, il faudra que le consommateur des messages parle RabbitMQ
  également.&lt;/li&gt;
&lt;li&gt;Kinto n'a aucun contrôle ni compréhension de ce qui arrive au
  message une fois qu'il a été passé au système de queuing.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;La simplicité du modèle, bien qu'attractive, possède des défauts
importants. Notamment, il va à l'encontre des règles que nous nous
sommes fixées du point de vue d'être agnostique techniquement
puisqu'il impose une technologie au consommateur des messages.&lt;/p&gt;
&lt;p&gt;C'est un modèle un peu dangereux car il n'y a aucune garantie que les
messages arrivent à leur destinataire (bien que tous les systèmes de
queue ne soient pas tous logés à la même enseigne à ce sujet).&lt;/p&gt;
&lt;h2&gt;L'approche intégrée&lt;/h2&gt;
&lt;p&gt;L'approche opposée est d'intégrer le système de queue directement dans
Kinto et de proposer une interface sur laquelle le consommateur puisse
s'enregistrer.&lt;/p&gt;
&lt;p&gt;&lt;div class="graphviz" style="align: center;"&gt;&lt;img src="data:image/png;base64,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d+9e/Pzzz7jrrruwePFiJCUlYfDgwVi8eDFUqv8e9h0OB8xmM/r27YvVq1f7MXIi8gUmfUREDdB1112n1PqtXr0apaWlOHjwIFwuV7nlZFmGw+HAmDFjMG3atMtuCRNRw8Gkj4ioAdPr9RgxYgS6dOkCjabqvnv/+7//i+HDh9f5o2CIyD+Y9BERNXCyLOO9996Dw+GodrlNmzahV69eyMvL81F0ROQrTPqIiBq47du349y5cx4t63Q68dNPP+HGG2/EhQsX6jgyIvIlJn1ERA3c6tWrIUkS9Ho99Ho9tFottFotJEmqcHmHw4GcnBysWbMGJpPJx9ESUV3hw5mJiBq4SZMm4frrr0dhYSEAoKioCLIsw2QyweVyoaioCDabDRaLBaWlpbBarSgtLUVhYSGKior8HD0ReQuTPiKiBq5nz57o2bNnjd+Xnp6O/fv310FEROQPvL1LREREFASY9BEREREFASZ9REREREGASR8RERFREGDSR0RERBQE2HuXiIjqhNFoxAsvvIBjx45BrVZDCIGkpCTMmDEDUVFR/g6PKOiwpo+IiLzu119/xY033gitVotPPvkEn3zyCT766COo1Wp07twZhw8f9neIREGHSR8REXmVy+XCAw88gKZNm+Kll16CWq0GAGi1Wrz00kto3749Ro4cCZfL5edIiYILkz4iIvKq5cuX49dff0V6evplr0mShMcffxy//vorli9f7ofoiIIXkz4iIvKqTz/9FABwyy23VPj6ddddBwDYsmULAOCdd96BJEnKWMAmkwmLFi0qNw8ArFYrFixYgHHjxuHGG29E3759ldvE3lgHUUPHpI+IiLzqjz/+QFhYGBo3blzh682aNYNer0dWVhYAYOLEiWjTpo3yemRkJNLT08vNA4AnnngCaWlpeO+99/D9999DpVKhb9++MJlMXlkHUUPHpI+IiLwqJycHcXFx5WrYylKpVGjSpAlOnjypzNNqtZctV3bed999h2XLlqFDhw5K7d2XX36JvLw87Nmzx2vrIGrI+MgWIiLyqpYtW+L48eNwuVxKJ46yXC4Xzp49i+joaI/XefDgQaSmpuK333674ri8sQ6i+ow1fURE5FXt27eH0+nEqVOnKnz97NmzcDgcuOGGGzxeZ0FBAY4fPw6LxXLZa572AvbGOojqMyZ9RETkVffffz8A4NChQxW+vmvXLgDA0KFDlXnuW8E2mw0AIMsyioqKAABCCKSkpCidMMo6cuQI3njjDa+tg6gh4+1dIiLyqpEjR2LRokVYvHgxhgwZUq5tnxACr776Kjp06IAHH3xQmZ+SkoLff/8dL7zwAsaOHYutW7cqyduOHTswcOBAJCYmYu7cuTh9+jT69OmDrKwsHDhwAOvXr/faOogaMtb0ERGRV6lUKnz44Yf4888/MXnyZJSUlAAALBYLHn30UZjNZmzevBl6vV55z4IFC9ClSxe88sormDJlCgYMGICrr74ao0ePhtFohEajwa5duzBo0CBs3LgR6enpyMvLwwcffIDIyEivrYOoIZOEEMLfQRARUeBJT0/H/v37kZGRcUXvLyoqwuuvv44FCxagVatWsFgs+Mc//oEJEyY0iCSrtt8PkY9l8PYuERHViaioKDz//PMQQmDWrFnQarXo2bNng0j4iOoj3t4lIqI69fzzz2PWrFmQZRkDBgzgM/GI/IRJHxER1SlJkjB79mwcOXIE48ePx7Rp0zBx4kQsWbLE36ERBRXe3iUiIp9o37495s2b5+8wiIIWa/qIiIiIggCTPiIiIqIgwKSPiIiIKAgw6SMiIiIKAkz6iIiIiIIAkz4iIiKiIMCkj4iIiCgIMOkjIiIiCgJM+oiIiIiCAJM+IiIioiDApI+IiIgoCDDpIyIiIgoCTPqIiIiIgoDG3wEQEVFgUqvVyMzMhCRJ/g4lYN16663+DoHIY5IQQvg7CCIiCjy5ubnYs2ePv8MIaFdffTVSU1P9HQaRJzKY9BERERE1fBls00dEREQUBJj0EREREQUBJn1EREREQeD/AETtUK+edhlPAAAAAElFTkSuQmCC"/&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;Avantages :&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Kinto serait livré comme une solution clé en main et bien qu'on
  utilise un système de queuing
  (&lt;a href="http://www.celeryproject.org/"&gt;Celery&lt;/a&gt;, par exemple), ce serait
  complètement transparent pour l'utilisateur.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Avec ce système complètement intégré, Kinto aurait une visibilité
  complète du processus et pourrait vérifier que les messages arrivent
  bien à destination.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;À l'exception du service de queue, il n'y aurait aucun autre service à déployer.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Inconvénient :&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Cela ferait considérablement augmenter la portée, la complexité et
  la taille de Kinto.&lt;/li&gt;
&lt;li&gt;Le fait que le système soit intégré directement dans Kinto nécessite
  de redéployer Kinto si le système de notification change.&lt;/li&gt;
&lt;li&gt;De la même manière, passer à l'échelle le système de notification
  voudrait dire passer Kinto à l'échelle.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Ce modèle a certains avantages ; cependant, la quantité de code
nécessaire est une raison suffisante pour se poser deux fois la
question (le véritable problème étant de ne pas transformer Kinto en
une &lt;a href="https://fr.wikipedia.org/wiki/D%C3%A9rive_des_objectifs"&gt;usine à gaz&lt;/a&gt;).
Comme pour la solution précédente, nous lions l'utilisateur à un
système de queues sans respecter notre règle d'agnosticisme technique.
Enfin, le passage à l'échelle n'apparait pas extrêmement flexible
(bien que ça reste de la théorie) - il semble dommage d'augmenter deux
ressources quand une pourrait suffire.&lt;/p&gt;
&lt;h2&gt;Le courtier (Broker)&lt;/h2&gt;
&lt;p&gt;L'approche finale est en fait un mélange des deux précédentes, nous
implémentons un "courtier" (broker) supporté par l'écosystème Kinto,
mais qui est facilement interchangeable et qui est externe au service
Kinto.&lt;/p&gt;
&lt;p&gt;Ce broker peut être écrit en quelques lignes de Python et intégré
comme le font les jolies &lt;em&gt;stacks&lt;/em&gt; basées sur des &lt;em&gt;micro-services&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;Cela permet de découpler le système de queues de Kinto tout en
garantissant l'interoperabilité et le contrôle des messages.&lt;/p&gt;
&lt;p&gt;&lt;div class="graphviz" style="align: center;"&gt;&lt;img src="data:image/png;base64,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"/&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;Avantages :&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Proposer une solution propre et qui expose simplement la répartition
  des responsabilités.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Libère à la fois Kinto et le consommateur de toute dépendances
  puisque le transport entre tous les composants se fait en HTTP.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;Permet de passer à l'échelle le Broker indépendamment de Kinto.&lt;/li&gt;
&lt;li&gt;Ne nécessite que très peu de code du côté de Kinto.&lt;/li&gt;
&lt;li&gt;Permet un ensemble de solutions très flexibles qui permettent de
  connecter à peu près n'importe quel consommateur.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Inconvénients:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Le courtier (broker) doit parler HTTP et implémenter un protocole de
  notre choix.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Cette solution nécessite de déployer et de maintenir deux services
  (difficulté qui varie en fonction de la complexité du broker).&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Nous aimons particulièrement ce modèle car il respecte les règles que
nous nous sommes fixées (sans concessions). Pour être tout-à-fait
honnête, le côté "robuste" est un peu approximatif dans ce cas car
nous passons la responsabilité à un autre service.  Cependant grâce au
côté interopérable de la solution nous pouvons avoir un certain degré
de confiance dans le processus.&lt;/p&gt;
&lt;p&gt;Un autre aspect intéressant de cette solution, qui découple le broker
de Kinto, est de permettre à n'importe qui d'y implémenter des règles
métiers alors que ce serait inapproprié de les implémenter dans Kinto.&lt;/p&gt;
&lt;p&gt;Un exemple notable est la gestion des erreurs. La manière dont nous
traitons les erreurs de notification Balrog n'est pas forcément
universelle et aurait peu de sens hors du cadre de notre cas
d'utilisation.&lt;/p&gt;
&lt;p&gt;Pour finir, ça vaut le coup de mentionner ici que le broker
pourrait être directement consommateur (s'il est assez rapide pour ne
pas ralentir Kinto), on a déjà des cas d'utilisations à Mozilla.&lt;/p&gt;
&lt;h1&gt;Feuille de route&lt;/h1&gt;
&lt;p&gt;Comme vous vous en doutez, nous avons opté pour la troisième solution
(Le courtier). Notre feuille de route pour passer de l'idée à la
réalisation, en commençant par un prototype, puis par un
&lt;a href="https://en.wikipedia.org/wiki/Minimum_viable_product"&gt;MVP&lt;/a&gt; et pour
finir en améliorant par itération jusqu'à arriver à une solution
utilisable par la communauté.&lt;/p&gt;
&lt;p&gt;Concrètement le prototype nécessite :&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;De définir les types d'évènements, s'il faut que l'évènement soit
  déclenché avant ou après ainsi que la structure des informations
  envoyées lors d'un évènement.&lt;/li&gt;
&lt;li&gt;D'activer des évènements Python synchrones en utilisant &lt;a href="http://docs.pylonsproject.org/projects/pyramid//en/latest/narr/events.html"&gt;le système
  d'évènements de
  Pyramid&lt;/a&gt;
  (ce que nous avions déjà fait &lt;a href="https://github.com/spiral-project/daybed/blob/master/daybed/events.py"&gt;dans
  Daybed&lt;/a&gt;).&lt;/li&gt;
&lt;li&gt;D'implémenter un backend de notifications dans Kinto permettant de
  s'enregistrer sur ces évènements.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Ensuite, pour la partie MVP, nous ajouterons :&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Réaliser un service HTTP minimaliste (basé sur une ioloop) qui
  recevra les notifications via un &lt;code&gt;POST&lt;/code&gt; HTTP, qui réalisera une
  action et enverra le résultat directement à Balrog.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Une fois le modèle validé on continuera à l'améliorer de manière
itérative, probablement sous la forme d'un "broker standard"
configurable qui sera maintenu comme partie de l'écosystème.&lt;/p&gt;
&lt;p&gt;Nous aimons bien l'idée d'avoir des consommateurs qui viendraient
s'enregistrer seuls directement sur le broker comme des webhooks, mais
ce sera l'objet d'une discussion future.&lt;/p&gt;
&lt;h1&gt;Impressions&lt;/h1&gt;
&lt;p&gt;Comme toujours, nous souhaitons avoir vos retours.&lt;/p&gt;
&lt;p&gt;Nous écrivons avant tout ces articles pour échanger avec vous, alors
n'hésitez surtout pas à poster vos questions, remarques,
interrogations via les commentaires par exemple.&lt;/p&gt;</summary><category term="mozilla"></category></entry><entry><title>Pourquoi avons-nous fait Cliquet ?</title><link href="http://www.servicedenuages.fr/pourquoi-cliquet" rel="alternate"></link><published>2015-07-14T00:00:00+02:00</published><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2015-07-14:pourquoi-cliquet</id><summary type="html">&lt;p&gt;&lt;strong&gt;tldr; Cliquet est un toolkit Python pour construire des APIs, qui implémente
les bonnes pratiques en terme de mise en production et de protocole HTTP.&lt;/strong&gt;&lt;/p&gt;
&lt;div class="section" id="les-origines"&gt;
&lt;h2&gt;Les origines&lt;/h2&gt;
&lt;p&gt;L'objectif pour le premier trimestre 2015 était de construire un service de
stockage et de &lt;a class="reference external" href="http://www.servicedenuages.fr/service-de-nuages"&gt;synchronisation de listes de lecture&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Au démarrage du projet, nous avons tenté de rassembler toutes les bonnes pratiques
et recommandations, venant de différentes équipes et surtout des derniers projets déployés.&lt;/p&gt;
&lt;p&gt;De même, nous voulions tirer parti du protocole de &lt;em&gt;Firefox Sync&lt;/em&gt;, robuste et éprouvé,
pour la synchronisation des données «offline».&lt;/p&gt;
&lt;p&gt;Plutôt qu'écrire un &lt;a class="reference external" href="http://blog.octo.com/en/design-a-rest-api/"&gt;énième&lt;/a&gt;
&lt;a class="reference external" href="http://www.vinaysahni.com/best-practices-for-a-pragmatic-restful-api"&gt;article&lt;/a&gt; de blog,
nous avons préféré les rassembler dans ce qu'on a appellé «un protocole».&lt;/p&gt;
&lt;p&gt;Comme pour l'architecture envisagée nous avions deux projets à construire, qui
devaient obéir globalement à ces mêmes règles, nous avons décidé de mettre en
commun l'implémentation de ce protocole et de ces bonnes pratiques dans un
«toolkit».&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Cliquet&lt;/em&gt; est né.&lt;/p&gt;
&lt;img alt="Cliquet logo" class="align-center" src="http://www.servicedenuages.fr/images/cliquet-logo.png" style="width: 300px; height: auto; max-width: 100%;"/&gt;
&lt;div class="section" id="les-intentions"&gt;
&lt;h3&gt;Les intentions&lt;/h3&gt;
&lt;blockquote class="epigraph"&gt;
Quelle structure JSON pour mon API ? Quelle syntaxe pour filtrer la liste
via la querystring ? Comment gérer les écritures concurrentes ?
Et synchroniser les données dans mon application cliente ?&lt;/blockquote&gt;
&lt;p&gt;Désormais, quand un projet souhaite bénéficier d'une API REST pour stocker et consommer
des données, il est possible d'utiliser le &lt;strong&gt;protocole HTTP&lt;/strong&gt; proposé
et de se concentrer sur l'essentiel. Cela vaut aussi pour les clients, où
la majorité du code d'interaction avec le serveur est réutilisable.&lt;/p&gt;
&lt;blockquote class="epigraph"&gt;
Comment pouvons-nous vérifier que le service est opérationnel ? Quels indicateurs StatsD ?
Est-ce que Sentry est bien configuré ? Comment déployer une nouvelle version
sans casser les applications clientes ?&lt;/blockquote&gt;
&lt;p&gt;Comme &lt;em&gt;Cliquet&lt;/em&gt; fournit tout ce qui est nécessaire pour être conforme avec les
exigences de la &lt;strong&gt;mise en production&lt;/strong&gt;, le passage du prototype au service opérationnel
est très rapide ! De base le service répondra aux attentes en terme supervision, configuration,
déploiement et dépréciation de version. Et si celles-ci évoluent, il suffira
de faire évoluer le toolkit.&lt;/p&gt;
&lt;blockquote class="epigraph"&gt;
Quel backend de stockage pour des documents JSON ? Comment faire si l'équipe
de production impose PostgreSQL ? Et si on voulait passer à Redis ou en
mémoire pour lancer les tests ?&lt;/blockquote&gt;
&lt;p&gt;En terme d'implémentation, nous avons choisi de &lt;strong&gt;fournir des abstractions&lt;/strong&gt;.
En effet, nous avions deux services dont le coeur consistait
à exposer un &lt;em&gt;CRUD&lt;/em&gt; en &lt;em&gt;REST&lt;/em&gt;, persistant des données JSON dans un backend.
Comme &lt;em&gt;Pyramid&lt;/em&gt; et &lt;em&gt;Cornice&lt;/em&gt; ne fournissent rien de tout prêt pour ça,
nous avons voulu introduire des classes de bases pour abstraire les notions
de resource REST et de backend de stockage.&lt;/p&gt;
&lt;p&gt;Dans le but de tout rendre optionnel et «pluggable», &lt;strong&gt;tout est configurable&lt;/strong&gt;
depuis le fichier &lt;tt class="docutils literal"&gt;.ini&lt;/tt&gt; de l'application. Ainsi tous les projets qui utilisent
le toolkit se déploieront de la même manière : seuls quelques éléments de configuration
les distingueront.&lt;/p&gt;
&lt;img alt="Une réunion à Paris..." class="align-center" src="http://www.servicedenuages.fr/images/cliquet-notes-whiteboard.jpg" style="width: 500px; height: auto; max-width: 100%;"/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="le-protocole"&gt;
&lt;h2&gt;Le protocole&lt;/h2&gt;
&lt;blockquote class="epigraph"&gt;
Est-ce suffisant de parler d'«API REST» ? Est-ce bien nécessaire de
relire la spec HTTP à chaque fois ? Pourquoi réinventer un protocole complet
à chaque fois ?&lt;/blockquote&gt;
&lt;p&gt;Quand nous développons un (micro)service Web, nous dépensons généralement beaucoup
trop d'énergie à (re)faire des choix (arbitraires).&lt;/p&gt;
&lt;p&gt;Nul besoin de lister ici tout ce qui concerne la dimension
de la spécification HTTP pure, qui nous impose le format des headers,
le support de CORS, la négocation de contenus (types mime), la différence entre
authentification et autorisation, la cohérence des code status...&lt;/p&gt;
&lt;p&gt;Les choix principaux du protocole concernent surtout :&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;strong&gt;Les resources REST&lt;/strong&gt; : Les deux URLs d'une resource (pour la collection
et les enregistrements) acceptent des verbes et des headers précis.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Les formats&lt;/strong&gt; : le format et la structure JSON des réponses est imposé, ainsi
que la &lt;a class="reference external" href="http://www.servicedenuages.fr/pagination-continuation-token"&gt;pagination des listes&lt;/a&gt;
ou la syntaxe pour filtrer/trier les resources via la &lt;a class="reference external" href="https://en.wikipedia.org/wiki/Query_string"&gt;querystring&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Les timestamps&lt;/strong&gt; : un numéro de révision qui s'incrémente à chaque opération
d'écriture sur une collection d'enregistrements.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;La synchronisation&lt;/strong&gt; : une série de leviers pour récupérer et renvoyer des
changements sur les données, sans perte ni collision, en utilisant les timestamps.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Les permissions&lt;/strong&gt; : les droits d'un utilisateur sur une collection ou un enregistrement
(&lt;em&gt;encore frais et sur le point d'être documenté&lt;/em&gt;) &lt;a class="footnote-reference" href="#id3" id="id1"&gt;[1]&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Opérations par lot&lt;/strong&gt;: une URL qui permet d'envoyer une série de requêtes
décrites en JSON et d'obtenir les réponses respectives.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Dans la dimension opérationnelle du protocole, on trouve :&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;strong&gt;La gestion de version&lt;/strong&gt; : cohabitation de plusieurs versions en production,
avec alertes dans les entêtes pour la fin de vie des anciennes versions.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Le report des requêtes&lt;/strong&gt; : entêtes interprétées par les clients, activées en cas de
maintenance ou de surchage, pour ménager le serveur.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Le canal d'erreurs&lt;/strong&gt; : toutes les erreurs renvoyées par le serveur ont le même
format JSON et ont un numéro précis.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Les utilitaires&lt;/strong&gt; : URLs diverses pour répondre aux besoins exprimés par
l'équipe d'administrateurs (monitoring, metadonnées, paramètres publiques).&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Ce protocole est une compilation des bonnes pratiques pour les APIs HTTP (&lt;em&gt;c'est notre métier !&lt;/em&gt;),
des conseils des administrateurs système dont c'est le métier de mettre à disposition des services
pour des millions d'utilisateurs et des retours d'expérience de l'équipe
de &lt;em&gt;Firefox Sync&lt;/em&gt; pour la gestion de la concurrence et de l'«offline-first».&lt;/p&gt;
&lt;p&gt;Il est &lt;a class="reference external" href="http://cliquet.readthedocs.io/en/latest/api/index.html"&gt;documenté en détail&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Dans un monde idéal, ce protocole serait versionné, et formalisé dans une RFC.
En rêve, il existerait même plusieurs implémentations avec des technologies différentes
(Python, Go, Node, etc.). &lt;a class="footnote-reference" href="#id4" id="id2"&gt;[2]&lt;/a&gt;&lt;/p&gt;
&lt;table class="docutils footnote" frame="void" id="id3" rules="none"&gt;
&lt;colgroup&gt;&lt;col class="label"&gt;&lt;/col&gt;&lt;col&gt;&lt;/col&gt;&lt;/colgroup&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td class="label"&gt;&lt;a class="fn-backref" href="#id1"&gt;[1]&lt;/a&gt;&lt;/td&gt;&lt;td&gt;Voir notre &lt;a class="reference external" href="http://www.servicedenuages.fr/la-gestion-des-permissions"&gt;article dédié sur les permissions&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;table class="docutils footnote" frame="void" id="id4" rules="none"&gt;
&lt;colgroup&gt;&lt;col class="label"&gt;&lt;/col&gt;&lt;col&gt;&lt;/col&gt;&lt;/colgroup&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td class="label"&gt;&lt;a class="fn-backref" href="#id2"&gt;[2]&lt;/a&gt;&lt;/td&gt;&lt;td&gt;Rappel: nous sommes une toute petite équipe !&lt;/td&gt;&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;div class="section" id="le-toolkit"&gt;
&lt;h2&gt;Le toolkit&lt;/h2&gt;
&lt;div class="section" id="choix-techniques"&gt;
&lt;h3&gt;Choix techniques&lt;/h3&gt;
&lt;p&gt;&lt;em&gt;Cliquet&lt;/em&gt; implémente le protocole en Python (&lt;em&gt;2.7, 3.4+, pypy&lt;/em&gt;), avec &lt;a class="reference external" href="http://trypyramid.com/"&gt;Pyramid&lt;/a&gt; &lt;a class="footnote-reference" href="#id6" id="id5"&gt;[3]&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Pyramid&lt;/strong&gt; est un framework Web qui va prendre en charge tout la partie HTTP,
et qui s'avère pertinent aussi bien pour des petits projets que des plus
ambitieux.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Cornice&lt;/strong&gt; est une extension de &lt;em&gt;Pyramid&lt;/em&gt;, écrite en partie par Alexis et Tarek,
qui permet d'éviter d'écrire tout le code &lt;em&gt;boilerplate&lt;/em&gt; quand on construit une
API REST avec Pyramid.&lt;/p&gt;
&lt;p&gt;Avec &lt;em&gt;Cornice&lt;/em&gt;, on évite de réécrire à chaque fois le code qui va
cabler les verbes HTTP aux méthodes, valider les entêtes, choisir le sérialiseur
en fonction des entêtes de négociation de contenus, renvoyer les codes HTTP
rigoureux, gérer les entêtes CORS, fournir la validation JSON à partir de schémas...&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Cliquet&lt;/strong&gt; utilise les deux précédents pour implémenter le protocole et fournir
des abstractions, mais on a toujours &lt;em&gt;Pyramid&lt;/em&gt; et &lt;em&gt;Cornice&lt;/em&gt; sous la main pour
aller au delà de ce qui est proposé !&lt;/p&gt;
&lt;table class="docutils footnote" frame="void" id="id6" rules="none"&gt;
&lt;colgroup&gt;&lt;col class="label"&gt;&lt;/col&gt;&lt;col&gt;&lt;/col&gt;&lt;/colgroup&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td class="label"&gt;&lt;a class="fn-backref" href="#id5"&gt;[3]&lt;/a&gt;&lt;/td&gt;&lt;td&gt;Au tout début nous avons commencé une implémentation avec &lt;em&gt;Python-Eve&lt;/em&gt;
(Flask), mais n'étions pas satisfaits de l'approche pour la configuration
de l'API. En particulier du côté magique.&lt;/td&gt;&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;div class="section" id="concepts"&gt;
&lt;h3&gt;Concepts&lt;/h3&gt;
&lt;p&gt;Bien évidemment, les concepts du toolkit reflètent ceux du protocole mais il y
a des éléments supplémentaires:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;strong&gt;Les backends&lt;/strong&gt; : abstractions pour le stockage, le cache et les permissions
(&lt;em&gt;ex. PostgreSQL, Redis, en-mémoire, ...&lt;/em&gt;)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;La supervision&lt;/strong&gt; : logging JSON et indicateurs temps-réel (&lt;em&gt;StatsD&lt;/em&gt;) pour suivre les
performances et la santé du service.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;La configuration&lt;/strong&gt; : chargement de la configuration depuis les variables
d'environnement et le fichier &lt;tt class="docutils literal"&gt;.ini&lt;/tt&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;La flexibilité&lt;/strong&gt; : dés/activation ou substitution de la majorité des composants
depuis la configuration.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Le profiling&lt;/strong&gt; : utilitaires de développement pour trouver les &lt;a class="reference external" href="https://fr.wiktionary.org/wiki/goulet_d%E2%80%99%C3%A9tranglement"&gt;goulets
d'étranglement&lt;/a&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;img alt="Cliquet concepts" class="align-center" src="http://www.servicedenuages.fr/images/cliquet-concepts.png" style="width: 500px; height: auto; max-width: 100%;"/&gt;
&lt;p&gt;Proportionnellement, l'implémentation du protocole pour les resources REST est
la plus volumineuse dans le code source de &lt;em&gt;Cliquet&lt;/em&gt;.
Cependant, comme nous l'avons décrit plus haut, &lt;em&gt;Cliquet&lt;/em&gt; fournit tout un
ensemble d'outillage et de bonnes pratiques, et reste
donc tout à fait pertinent pour n'importe quel type d'API, même sans
manipulation de données !&lt;/p&gt;
&lt;p&gt;L'objectif de la boîte à outils est de faire en sorte qu'un développeur puisse constuire
une application simplement, en étant sûr qu'elle réponde aux exigeances de la
mise en production, tout en ayant la possibilité de remplacer certaines parties
au fur et à mesure que ses besoins se précisent.&lt;/p&gt;
&lt;p&gt;Par exemple, la persistence fournie par défault est &lt;em&gt;schemaless&lt;/em&gt; (e.g &lt;em&gt;JSONB&lt;/em&gt;),
mais rien n'empêcherait d'implémenter le stockage dans un modèle relationnel.&lt;/p&gt;
&lt;p&gt;Comme les composants peuvent être remplacés depuis la configuration, il est
tout à fait possible d'étendre &lt;em&gt;Cliquet&lt;/em&gt; avec des notions métiers ou des
technologies exotiques ! Nous avons posé quelques idées dans &lt;a class="reference external" href="http://cliquet.readthedocs.io/en/latest/ecosystem.html"&gt;la documentation
de l'éco-système&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Dans les prochaines semaines, nous allons introduire la notion d'«évènements» (ou signaux),
qui permettraient aux extensions de s'interfacer beaucoup plus proprement.&lt;/p&gt;
&lt;p&gt;Nous attachons beaucoup d'importance à la clareté du code, la pertinence des
&lt;em&gt;patterns&lt;/em&gt;, des tests et de la documentation. Si vous avez des commentaires,
des critiques ou des interrogations, n'hésitez pas à &lt;a class="reference external" href="https://github.com/mozilla-services/cliquet/issues"&gt;nous en faire part&lt;/a&gt; !&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="cliquet-a-l-action"&gt;
&lt;h2&gt;Cliquet, à l'action.&lt;/h2&gt;
&lt;p&gt;Nous avons écrit un &lt;a class="reference external" href="http://cliquet.readthedocs.io/en/latest/quickstart.html"&gt;guide de démarrage&lt;/a&gt;,
qui n'exige pas de connaître &lt;em&gt;Pyramid&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;Pour illustrer la simplicité et les concepts, voici quelques extraits !&lt;/p&gt;
&lt;div class="section" id="etape-1"&gt;
&lt;h3&gt;Étape 1&lt;/h3&gt;
&lt;p&gt;Activer &lt;em&gt;Cliquet&lt;/em&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="hll"&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;cliquet&lt;/span&gt;
&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;pyramid.config&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Configurator&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;main&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;global_config&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;settings&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;config&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Configurator&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;settings&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;settings&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="hll"&gt;    &lt;span class="n"&gt;cliquet&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;initialize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;'1.0'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/span&gt;    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;make_wsgi_app&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;À partir de là, la plupart des outils de &lt;em&gt;Cliquet&lt;/em&gt; sont activés et accessibles.&lt;/p&gt;
&lt;p&gt;Par exemple, les URLs &lt;em&gt;hello&lt;/em&gt; (&lt;tt class="docutils literal"&gt;/v1/&lt;/tt&gt;) ou &lt;em&gt;supervision&lt;/em&gt; (&lt;tt class="docutils literal"&gt;/v1/__heartbeat__&lt;/tt&gt;).
Mais aussi les backends de stockage, de cache, etc.
qu'il est possible d'utiliser dans des vues classiques &lt;em&gt;Pyramid&lt;/em&gt; ou &lt;em&gt;Cornice&lt;/em&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="etape-2"&gt;
&lt;h3&gt;Étape 2&lt;/h3&gt;
&lt;p&gt;Ajouter des vues:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;main&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;global_config&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;settings&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;config&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Configurator&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;settings&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;settings&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="n"&gt;cliquet&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;initialize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;'1.0'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="hll"&gt;    &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;scan&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"myproject.views"&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/span&gt;    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;make_wsgi_app&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Pour définir des resources CRUD, il faut commencer par définir un schéma,
avec &lt;em&gt;Colander&lt;/em&gt;, et ensuite déclarer une resource:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;cliquet&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;resource&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;schema&lt;/span&gt;

&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;BookmarkSchema&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;schema&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ResourceSchema&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;url&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;schema&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;URL&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

&lt;span class="hll"&gt;&lt;span class="nd"&gt;@resource.register&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;span class="hll"&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Bookmark&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;resource&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;BaseResource&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
&lt;/span&gt;&lt;span class="hll"&gt;    &lt;span class="n"&gt;mapping&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;BookmarkSchema&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Désormais, la resource CRUD est disponible sur &lt;tt class="docutils literal"&gt;/v1/bookmarks&lt;/tt&gt;, avec toutes
les fonctionnalités de synchronisation, filtrage, tri, pagination, timestamp, etc.
De base les enregistrements sont privés, par utilisateur.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt; &lt;span class="err"&gt;http&lt;/span&gt; &lt;span class="err"&gt;GET&lt;/span&gt; &lt;span class="s2"&gt;"http://localhost:8000/v1/bookmarks"&lt;/span&gt;
&lt;span class="err"&gt;HTTP/&lt;/span&gt;&lt;span class="mf"&gt;1.1&lt;/span&gt; &lt;span class="mi"&gt;200&lt;/span&gt; &lt;span class="err"&gt;OK&lt;/span&gt;
&lt;span class="err"&gt;...&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nt"&gt;"data"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;
        &lt;span class="p"&gt;{&lt;/span&gt;
            &lt;span class="nt"&gt;"url"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"http://cliquet.readthedocs.io"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
            &lt;span class="nt"&gt;"id"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"cc103eb5-0c80-40ec-b6f5-dad12e7d975e"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
            &lt;span class="nt"&gt;"last_modified"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;1437034418940&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="etape-3"&gt;
&lt;h3&gt;Étape 3&lt;/h3&gt;
&lt;p&gt;Évidemment, il est possible choisir les URLS, les verbes HTTP supportés, de modifier
des champs avant l'enregistrement, etc.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="hll"&gt;&lt;span class="nd"&gt;@resource.register&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;collection_path&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'/user/bookmarks'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;span class="hll"&gt;                   &lt;span class="n"&gt;record_path&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'/user/bookmarks/{{id}}'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;span class="hll"&gt;                   &lt;span class="n"&gt;collection_methods&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'GET'&lt;/span&gt;&lt;span class="p"&gt;,))&lt;/span&gt;
&lt;/span&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Bookmark&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;resource&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;BaseResource&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;mapping&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;BookmarkSchema&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

&lt;span class="hll"&gt;    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;process_record&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;new&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;old&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;None&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
&lt;/span&gt;&lt;span class="hll"&gt;        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;old&lt;/span&gt; &lt;span class="ow"&gt;is&lt;/span&gt; &lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="bp"&gt;None&lt;/span&gt; &lt;span class="ow"&gt;and&lt;/span&gt; &lt;span class="n"&gt;new&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;'device'&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;!=&lt;/span&gt; &lt;span class="n"&gt;old&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;'device'&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt;
&lt;/span&gt;&lt;span class="hll"&gt;            &lt;span class="n"&gt;device&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;headers&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'User-Agent'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;span class="hll"&gt;            &lt;span class="n"&gt;new&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;'device'&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;device&lt;/span&gt;
&lt;/span&gt;&lt;span class="hll"&gt;        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;new&lt;/span&gt;
&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;a class="reference external" href="http://cliquet.readthedocs.io/en/latest/reference/resource.html"&gt;Plus d'infos dans la documentation dédiée&lt;/a&gt; !&lt;/p&gt;
&lt;div class="note"&gt;
&lt;p class="first admonition-title"&gt;Note&lt;/p&gt;
&lt;p class="last"&gt;Il est possible de définir des resources sans validation de schema.
&lt;a class="reference external" href="https://github.com/mozilla-services/kinto/blob/master/kinto/views/records.py"&gt;Voir le code source de Kinto&lt;/a&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="etape-4-optionelle"&gt;
&lt;h3&gt;Étape 4 (optionelle)&lt;/h3&gt;
&lt;p&gt;Utiliser les abstractions de &lt;em&gt;Cliquet&lt;/em&gt; dans une vue &lt;em&gt;Cornice&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;Par exemple, une vue qui utilise le backend de stockage:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;cliquet&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Service&lt;/span&gt;

&lt;span class="n"&gt;score&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Service&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;"score"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                &lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'/score/{game}'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                &lt;span class="n"&gt;description&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;"Store game score"&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="nd"&gt;@score.post&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;schema&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;ScoreSchema&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;post_score&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;collection_id&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;'scores-'&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;match_dict&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;'game'&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
    &lt;span class="n"&gt;user_id&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;authenticated_userid&lt;/span&gt;
    &lt;span class="n"&gt;value&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;validated&lt;/span&gt;  &lt;span class="c1"&gt;# c.f. Cornice.&lt;/span&gt;

&lt;span class="hll"&gt;    &lt;span class="n"&gt;storage&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;registry&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;storage&lt;/span&gt;
&lt;/span&gt;&lt;span class="hll"&gt;    &lt;span class="n"&gt;record&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;storage&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;create&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;collection_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;user_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/span&gt;    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;record&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="vos-retours"&gt;
&lt;h2&gt;Vos retours&lt;/h2&gt;
&lt;p&gt;N'hésitez pas à nous faire part de vos retours ! Cela vous a donné envie
d'essayer ? Vous connaissez un outil similaire ?
Y-a-t-il des points qui ne sont pas clairs ? Manque de cas d'utilisation concrets ?
Certains aspects mal pensés ? Trop contraignants ? Trop de magie ? Overkill ?&lt;/p&gt;
&lt;p&gt;Nous prenons tout.&lt;/p&gt;
&lt;div class="section" id="points-faibles"&gt;
&lt;h3&gt;Points faibles&lt;/h3&gt;
&lt;p&gt;Nous sommes très fiers de ce que nous avons construit, en relativement peu
de temps. Et comme nous l'exposions dans &lt;a class="reference external" href="{filename/2015.07.whistler-use-cases.rst}"&gt;l'article précédent&lt;/a&gt;, il y a du potentiel !&lt;/p&gt;
&lt;p&gt;Cependant, nous sommes conscients d'un certain nombre de points
qui peuvent être vus comme des faiblesses.&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;strong&gt;La documentation d'API&lt;/strong&gt; : actuellement, nous n'avons pas de solution pour qu'un
projet qui utilise &lt;em&gt;Cliquet&lt;/em&gt; puisse intégrer facilement toute
&lt;a class="reference external" href="http://cliquet.readthedocs.io/en/latest/api/index.html"&gt;la documentation de l'API&lt;/a&gt;
obtenue.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;La documentation&lt;/strong&gt; : il est très difficile d'organiser la documentation, surtout
quand le public visé est aussi bien débutant qu'expérimenté. Nous sommes probablement
victimes du «&lt;a class="reference external" href="https://en.wikipedia.org/wiki/Curse_of_knowledge"&gt;curse of knowledge&lt;/a&gt;».&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Le protocole&lt;/strong&gt; : on sent bien qu'on va devoir versionner le protocole. Au
moins pour le désolidariser des versions de &lt;em&gt;Cliquet&lt;/em&gt;, si on veut aller au
bout de la philosophie et de l'éco-système.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Le conservatisme&lt;/strong&gt; : Nous aimons la stabilité et la robustesse. Mais surtout
nous ne sommes pas tout seuls et devons nous plier aux contraintes de la mise
en production ! Cependant, nous avons très envie de faire de l'async avec Python 3 !&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Publication de versions&lt;/strong&gt; : le revers de la médaille de la factorisation. Il
arrive qu'on préfère faire évoluer le toolkit (e.g. ajouter une option) pour
un point précis d'un projet. En conséquence, on doit souvent releaser les
projets en cascade.&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="section" id="quelques-questions-courantes"&gt;
&lt;h3&gt;Quelques questions courantes&lt;/h3&gt;
&lt;blockquote&gt;
Pourquoi Python ?&lt;/blockquote&gt;
&lt;p&gt;On prend beaucoup de plaisir à écrire du Python, et le calendrier annoncé
initialement était très serré: pas question de tituber avec une technologie
mal maitrisée !&lt;/p&gt;
&lt;p&gt;Et puis, après avoir passé près d'un an sur un projet Node.js, l'équipe avait
bien envie de refaire du Python.&lt;/p&gt;
&lt;blockquote&gt;
Pourquoi pas Django ?&lt;/blockquote&gt;
&lt;p&gt;On y a pensé, surtout parce qu'il y a plusieurs fans de &lt;em&gt;Django REST Framework&lt;/em&gt;
dans l'équipe.&lt;/p&gt;
&lt;p&gt;On l'a écarté principalement au profit de la légèreté et la modularité de
&lt;em&gt;Pyramid&lt;/em&gt;.&lt;/p&gt;
&lt;blockquote&gt;
Pourquoi pas avec un framework asynchrone en Python 3+ ?&lt;/blockquote&gt;
&lt;p&gt;Pour l'instant nos administrateurs système nous imposent des déploiements en
Python 2.7, à notre grand désarroi /o\&lt;/p&gt;
&lt;p&gt;Pour &lt;em&gt;Reading List&lt;/em&gt;, nous &lt;a class="reference external" href="https://github.com/mozilla-services/readinglist/blob/1.7.0/readinglist/__init__.py#L19-L26"&gt;avions activé&lt;/a&gt;
&lt;em&gt;gevent&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;Puisque l'approche consiste à implémenter un protocole bien déterminé, nous n'excluons
pas un jour d'écrire un &lt;em&gt;Cliquet&lt;/em&gt; en &lt;em&gt;aiohttp&lt;/em&gt; ou &lt;em&gt;Go&lt;/em&gt; si cela s'avèrerait pertinent.&lt;/p&gt;
&lt;blockquote&gt;
Pourquoi pas JSON-API ?&lt;/blockquote&gt;
&lt;p&gt;Comme nous l'expliquions &lt;a class="reference external" href="http://www.servicedenuages.fr/apidays-barcelona-retours"&gt;au retour des APIdays&lt;/a&gt;,
JSON-API est une spécification qui rejoint plusieurs de nos intentions.&lt;/p&gt;
&lt;p&gt;Quand nous avons commencé le protocole, nous ne connaissions pas JSON-API.
Pour l'instant, comme notre proposition est beaucoup plus minimaliste, le
rapprochement n'a &lt;a class="reference external" href="https://github.com/mozilla-services/cliquet/issues/254"&gt;pas dépassé le stade de la discussion&lt;/a&gt;.&lt;/p&gt;
&lt;blockquote&gt;
Est-ce que Cliquet est un framework REST pour Pyramid ?&lt;/blockquote&gt;
&lt;p&gt;Non.&lt;/p&gt;
&lt;p&gt;Au delà des classes de resources CRUD de Cliquet, qui implémentent un
protocole bien précis, il faut utiliser Cornice ou Pyramid directement.&lt;/p&gt;
&lt;blockquote&gt;
Est-ce que Cliquet est suffisamment générique pour des projets hors Mozilla ?&lt;/blockquote&gt;
&lt;p&gt;Premièrement, nous faisons en sorte que tout soit contrôlable depuis la
configuration &lt;tt class="docutils literal"&gt;.ini&lt;/tt&gt; pour permettre la dés/activation ou substitution des
composants.&lt;/p&gt;
&lt;p&gt;Si le protocole HTTP/JSON des resources CRUD vous satisfait,
alors Cliquet est probablement le plus court chemin pour construire une
application qui tient la route.&lt;/p&gt;
&lt;p&gt;Mais l'utilisation des resources CRUD est facultative, donc Cliquet reste pertinent
si les bonnes pratiques en terme de mise en production ou les abstractions fournies
vous paraissent valables !&lt;/p&gt;
&lt;p&gt;Cliquet reste un moyen simple d'aller très vite pour mettre sur pied
une application Pyramid/Cornice.&lt;/p&gt;
&lt;blockquote&gt;
Est-ce que les resources JSON supporte les modèles relationnels complexes ?&lt;/blockquote&gt;
&lt;p&gt;La couche de persistence fournie est très simple, et devrait
répondre à la majorité des cas d'utilisation où les données n'ont pas de
relations.&lt;/p&gt;
&lt;p&gt;En revanche, il est tout à fait possible de bénéficier de tous les aspects
du protocole en utilisant une classe &lt;tt class="docutils literal"&gt;Collection&lt;/tt&gt; maison, qui se chargerait
elle de manipuler les relations.&lt;/p&gt;
&lt;p&gt;Le besoin de relations pourrait être un bon prétexte pour implémenter le
protocole avec Django REST Framework :)&lt;/p&gt;
&lt;blockquote&gt;
Est-il possible de faire ci ou ça avec Cliquet ?&lt;/blockquote&gt;
&lt;p&gt;Nous aimerions collecter des besoins pour écrire un ensemble de «recettes/tutoriels». Mais
pour ne pas travailler dans le vide, nous aimerions &lt;a class="reference external" href="https://github.com/mozilla-services/cliquet/issues"&gt;connaitre vos idées&lt;/a&gt; !
(&lt;em&gt;ex. brancher l'authentification Github, changer le format du logging JSON, stocker des
données cartographiques, ...&lt;/em&gt;)&lt;/p&gt;
&lt;blockquote&gt;
Est-ce que Cliquet peut manipuler des fichiers ?&lt;/blockquote&gt;
&lt;p&gt;&lt;a class="reference external" href="https://github.com/mozilla-services/cliquet/issues/236"&gt;Nous l'envisageons&lt;/a&gt;,
mais pour l'instant nous attendons que le besoin survienne en interne pour se
lancer.&lt;/p&gt;
&lt;p&gt;Si c'est le cas, le protocole utilisé sera &lt;a class="reference external" href="http://remotestorage.io/"&gt;Remote Storage&lt;/a&gt;,
afin notamment de s'intégrer dans l'éco-système grandissant.&lt;/p&gt;
&lt;blockquote&gt;
Est-ce que la fonctionnalité X va être implémentée ?&lt;/blockquote&gt;
&lt;p&gt;&lt;em&gt;Cliquet&lt;/em&gt; est déjà bien garni. Plutôt qu'implémenter la fonctionnalité X,
il y a de grandes chances que nous agissions pour s'assurer que les abstractions
et les mécanismes d'extension fournis permettent de l'implémenter sous forme
d'extension.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
</summary><category term="mozilla"></category></entry><entry><title>Perspectives pour l'été</title><link href="http://www.servicedenuages.fr/perspectives-pour-lete" rel="alternate"></link><published>2015-07-07T00:00:00+02:00</published><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2015-07-07:perspectives-pour-lete</id><summary type="html">&lt;p&gt;Mozilla a pour coutume d'organiser régulièrement des semaines de travail où tous les employés
sont réunis physiquement. Pour cette dernière édition, nous avons pu retrouver
nos collègues du monde entier à &lt;a class="reference external" href="http://www.openstreetmap.org/node/268148288#map=4/50.12/-122.95"&gt;Whistler, en Colombie Britannique au Canada&lt;/a&gt; !&lt;/p&gt;
&lt;img alt="«All Hands» talk about Lego, by @davidcrob - CC0" class="align-center" src="http://www.servicedenuages.fr/images/whistler-talks.jpg" style="width: 1024px; height: auto; max-width: 100%;"/&gt;
&lt;p&gt;Ce fût l'occasion pour notre équipe de se retrouver, et surtout de partager notre
vision et nos idées dans le domaine du stockage, afin de collecter des cas d'utilisation pour
notre solution &lt;a class="reference external" href="https://kinto.readthedocs.io"&gt;Kinto&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Dans cet article, nous passons en revue les pistes que nous avons pour
les prochains mois.&lt;/p&gt;
&lt;div class="section" id="ateliers-et-promotion"&gt;
&lt;h2&gt;Ateliers et promotion&lt;/h2&gt;
&lt;p&gt;Nicolas a présenté &lt;a class="reference external" href="https://github.com/mozilla-services/kinto.js"&gt;Kinto.js&lt;/a&gt; dans un atelier dédié, avec comme support de
présentation le &lt;a class="reference external" href="http://kintojs.readthedocs.io/en/latest/tutorial/"&gt;tutorial d'introduction&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;L'application résultante, pourtant toute simple, permet d'appréhender les
concepts de synchronisation de Kinto. Le tout sans installation prélable,
puisque Rémy a mis en place un &lt;a class="reference external" href="https://kinto.dev.mozaws.net/v1/"&gt;serveur de dev effacé tous les jours&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Nous avions mis un point d'honneur à faire du Vanilla.JS, déjà pour éviter les
combats de clochers autour des frameworks, mais aussi pour mettre en évidence qu'avec
HTML5 et ES6, on n'était plus aussi démunis qu'il y a quelques années.&lt;/p&gt;
&lt;p&gt;Ce petit atelier nous a permis de nous rendre compte qu'on avait encore de
grosses lacunes en terme de documentation, surtout en ce qui concerne
l'éco-système et la vision globale des projets (Kinto, Kinto.js, Cliquet, ...).
Nous allons donc faire de notre mieux pour combler ce manque.&lt;/p&gt;
&lt;img alt="Kinto.js workshop - CC0" class="align-center" src="http://www.servicedenuages.fr/images/whistler-workshop.jpg" style="width: 1024px; height: auto; max-width: 100%;"/&gt;
&lt;/div&gt;
&lt;div class="section" id="mozilla-payments"&gt;
&lt;h2&gt;Mozilla Payments&lt;/h2&gt;
&lt;p&gt;Comme &lt;a class="reference external" href="http://www.servicedenuages.fr/la-gestion-des-permissions"&gt;décrit précédemment&lt;/a&gt;, nous avons mis en place un système de permissions pour répondre aux besoins de suivi des paiements et abonnements.&lt;/p&gt;
&lt;p&gt;Pour ce projet, Kinto sera utilisé depuis une application Django, via un client Python.&lt;/p&gt;
&lt;p&gt;Maintenant que les développements ont été livrés, il faut transformer l'essai, réussir l'intégration, l'hébergement et la montée en puissance. La solution doit être livrée à la fin de l'année.&lt;/p&gt;
&lt;div class="section" id="a-venir"&gt;
&lt;h3&gt;À venir&lt;/h3&gt;
&lt;p&gt;Nous aimerions en profiter pour implémenter une fonctionnalité qui nous tient à coeur : la construction de la liste des enregistrements accessibles en lecture sur une collection partagée.&lt;/p&gt;
&lt;img alt="Whistler Alta Lake - CC0" class="align-center" src="http://www.servicedenuages.fr/images/whistler-lake.jpg" style="width: 1024px; height: auto; max-width: 100%;"/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="firefox-os-et-stockage"&gt;
&lt;h2&gt;Firefox OS et stockage&lt;/h2&gt;
&lt;p&gt;Nous avons eu beaucoup d'échanges avec l'équipe de Firefox OS, avec qui nous avions
déjà eu l'occasion de collaborer, pour le &lt;a class="reference external" href="https://github.com/mozilla-services/msisdn-gateway"&gt;serveur d'identification BrowserID par SMS&lt;/a&gt; et pour &lt;a class="reference external" href="https://github.com/mozilla-services/loop-server"&gt;Firefox Hello&lt;/a&gt;.&lt;/p&gt;
&lt;div class="section" id="in-app-sync"&gt;
&lt;h3&gt;In-App sync&lt;/h3&gt;
&lt;p&gt;Kinto, la solution simple promue pour la synchronisation de données dans les applications
Firefox OS ? La classe ! C'est ce qu'on avait en tête depuis longtemps, déjà à
l'époque avec &lt;a class="reference external" href="http://daybed.readthedocs.io/"&gt;Daybed&lt;/a&gt;. Voici donc une belle opportunité à saisir !&lt;/p&gt;
&lt;p&gt;Il va falloir expliciter les limitations et hypothèses simplificatrices de notre
solution, surtout en termes de gestion de la concurrence. Nous sommes persuadés
que ça colle avec la plupart des besoins, mais il ne faudrait pas décevoir :)&lt;/p&gt;
&lt;p&gt;Le fait que &lt;a class="reference external" href="https://github.com/daleharvey"&gt;Dale&lt;/a&gt;, un des auteurs de &lt;a class="reference external" href="http://pouchdb.com/"&gt;PouchDB&lt;/a&gt; et &lt;a class="reference external" href="https://github.com/michielbdejong"&gt;Michiel de Jong&lt;/a&gt;, un des auteurs de &lt;a class="reference external" href="http://remotestorage.io/"&gt;Remote Storage&lt;/a&gt;, nous aient encouragés sur nos premiers pas nous a bien motivé !&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="cut-the-rope"&gt;
&lt;h3&gt;Cut the Rope&lt;/h3&gt;
&lt;p&gt;Kinto devrait être mis à profit pour synchroniser les paramètres et les scores
du &lt;a class="reference external" href="http://mozilla.cuttherope.net/"&gt;jeu&lt;/a&gt;. Un premier exercice et une première vitrine sympas !&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="syncto"&gt;
&lt;h3&gt;« SyncTo »&lt;/h3&gt;
&lt;p&gt;&lt;a class="reference external" href="https://docs.services.mozilla.com/storage/apis-1.5.html"&gt;Firefox Sync&lt;/a&gt; est la solution qui permet de synchroniser les données de Firefox (favoris, extensions, historique, complétion des formulaires, mots de passe, ...) entre plusieurs périphériques, de manière chiffrée.&lt;/p&gt;
&lt;p&gt;L'implémentation du client en JavaScript est relativement complexe et date un peu maintenant.
Le code existant n'est pas vraiment portable dans &lt;em&gt;Firefox OS&lt;/em&gt; et les tentatives de réécriture
n'ont pas abouti.&lt;/p&gt;
&lt;p&gt;Nous souhaitons implémenter un pont entre &lt;em&gt;Kinto&lt;/em&gt; et &lt;em&gt;Firefox Sync&lt;/em&gt;, de manière
à pouvoir utiliser le client &lt;em&gt;Kinto.js&lt;/em&gt;, plus simple et plus moderne, pour récupérer
les contenus et les stocker dans IndexedDB. Le delta à implémenter côté serveur est faible car nous nous étions
inspirés du protocole déjà éprouvé de Sync. Côté client, il s'agira surtout de
câbler l'authentification BrowserId et la Crypto.&lt;/p&gt;
&lt;p&gt;Alexis a sauté sur l'occasion pour commencer l'écriture d'&lt;a class="reference external" href="https://github.com/mozilla-services/syncclient"&gt;un client python pour Firefox Sync&lt;/a&gt;, qui servira de brique de base pour l'écriture du service.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="cloud-storage"&gt;
&lt;h3&gt;Cloud Storage&lt;/h3&gt;
&lt;p&gt;Eden Chuang et Sean Lee ont présenté les avancées sur l'intégration de services de stockages
distants (&lt;em&gt;DropBox, Baidu Yun&lt;/em&gt;) dans &lt;em&gt;Firefox OS&lt;/em&gt;. Actuellement, leur preuve de
concept repose sur &lt;a class="reference external" href="https://fr.wikipedia.org/wiki/Filesystem_in_Userspace"&gt;FUSE&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Nous avons évidemment en tête d'introduire la notion de fichiers attachés dans
&lt;em&gt;Kinto&lt;/em&gt;, en implémentant la specification
&lt;a class="reference external" href="https://tools.ietf.org/html/draft-dejong-remotestorage-05"&gt;*Remote Storage*&lt;/a&gt;,
mais pour l'instant les cas d'utilisations ne se sont pas encore présentés officiellement.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="id2"&gt;
&lt;h3&gt;À venir&lt;/h3&gt;
&lt;p&gt;Nous serons probablement amenés à introduire la gestion de la concurrence dans
le client JS, en complément de ce qui a été fait sur le serveur, pour permettre
les écritures simultanées et synchronisation en tâche de fond.&lt;/p&gt;
&lt;p&gt;Nous sommes par ailleurs perpétuellement preneurs de vos retours — et bien
entendu de vos contributions — tant sur le code &lt;a class="reference external" href="https://github.com/mozilla-services/kinto/"&gt;serveur&lt;/a&gt;
que &lt;a class="reference external" href="https://github.com/mozilla-services/kinto.js/"&gt;client&lt;/a&gt;  !&lt;/p&gt;
&lt;img alt="Firefox OS Cloud Storage Presentation - CC0" class="align-center" src="http://www.servicedenuages.fr/images/whistler-cloud-storage.jpg" style="width: 1024px; height: auto; max-width: 100%;"/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="contenus-applicatifs-de-firefox"&gt;
&lt;h2&gt;Contenus applicatifs de Firefox&lt;/h2&gt;
&lt;p&gt;Aujourd'hui Firefox a un cycle de release de six semaines. Un des objectifs
consiste à désolidariser certains contenus applicatifs de ces cycles
relativement longs (ex. &lt;em&gt;règles de securité, dictionnaires, traductions, ...&lt;/em&gt;) &lt;a class="footnote-reference" href="#id4" id="id3"&gt;[1]&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Il s'agit de données JSON et binaire qui doivent être versionnées et synchronisées par
les navigateurs (&lt;em&gt;lecture seule&lt;/em&gt;).&lt;/p&gt;
&lt;p&gt;Il y a plusieurs outils officiels qui existent pour gérer ça (&lt;em&gt;Balrog&lt;/em&gt;, &lt;em&gt;Shavar&lt;/em&gt;, ...),
et pour l'instant, aucun choix n'a été fait. Mais lors des conversations avec
l'équipe en charge du projet, ce fût vraiment motivant de voir que même pour
ce genre de besoins internes, &lt;em&gt;Kinto&lt;/em&gt; est tout aussi pertinent !&lt;/p&gt;
&lt;table class="docutils footnote" frame="void" id="id4" rules="none"&gt;
&lt;colgroup&gt;&lt;col class="label"&gt;&lt;/col&gt;&lt;col&gt;&lt;/col&gt;&lt;/colgroup&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td class="label"&gt;&lt;a class="fn-backref" href="#id3"&gt;[1]&lt;/a&gt;&lt;/td&gt;&lt;td&gt;La bonne nouvelle c'est que toutes les fonctionnalités &lt;em&gt;third-party&lt;/em&gt; qui ont
été intégrées récemment vont redevenir des &lt;em&gt;add-ons&lt;/em&gt; \o/.&lt;/td&gt;&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;img alt="Landscape - CC0" class="align-center" src="http://www.servicedenuages.fr/images/whistler-landscape.jpg" style="width: 1024px; height: auto; max-width: 100%;"/&gt;
&lt;/div&gt;
&lt;div class="section" id="awesome-bar"&gt;
&lt;h2&gt;Awesome bar&lt;/h2&gt;
&lt;p&gt;L'équipe &lt;em&gt;Firefox Labs&lt;/em&gt;, le laboratoire qui élève des pandas roux en éprouvette,
serait vraiment intéressé par notre solution, notamment pour abreuver en données
un prototype pour améliorer &lt;em&gt;Awesome bar&lt;/em&gt;, qui fusionnerait URL, historique et recherche.&lt;/p&gt;
&lt;p&gt;Nous ne pouvons pas en dire beaucoup plus pour l'instant, mais les fonctionnalités
de collections d'enregistrements partagées entre utilisateurs de &lt;em&gt;Kinto&lt;/em&gt;
correspondent parfaitement à ce qui est envisagé pour le futur du navigateur :)&lt;/p&gt;
&lt;div class="section" id="id5"&gt;
&lt;h3&gt;À venir&lt;/h3&gt;
&lt;p&gt;Nous serons donc probablement amenés, avant de la fin de l'année, à introduire des
fonctionnalités d'indexation et de recherche &lt;em&gt;full-text&lt;/em&gt; (comprendre &lt;em&gt;ElasticSearch&lt;/em&gt;).
Cela rejoint nos plans précédents, puisque c'est quelque chose que nous avions dans
&lt;em&gt;Daybed&lt;/em&gt;, et qui figurait sur notre feuille de route !&lt;/p&gt;
&lt;img alt="Firefox Labs Meeting - CC0" class="align-center" src="http://www.servicedenuages.fr/images/whistler-labs.jpg" style="width: 1024px; height: auto; max-width: 100%;"/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="browser-html"&gt;
&lt;h2&gt;Browser.html&lt;/h2&gt;
&lt;p&gt;L'équipe &lt;em&gt;Recherche&lt;/em&gt; explore les notions de plateforme, et travaille notamment
sur l'implémentation d'un navigateur en JS/HTML avec &lt;em&gt;React&lt;/em&gt;:
&lt;a class="reference external" href="https://github.com/mozilla/browser.html"&gt;browser.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Kinto&lt;/em&gt; correspond parfaitement aux attentes
de l'équipe pour synchroniser les données associées à un utilisateur.&lt;/p&gt;
&lt;p&gt;Il pourrait s'agir de données de navigation (comme Sync), mais aussi de collections
d'enregistrements diverses, comme par exemple les préférences du navigateur
ou un équivalent à &lt;em&gt;Alexa.com Top 500&lt;/em&gt; pour fournir la complétion d'URL sans
interroger le moteur de recherche.&lt;/p&gt;
&lt;p&gt;L'exercice pourrait être poussé jusqu'à la synchronisation d'états &lt;em&gt;React&lt;/em&gt;
entre périphériques (par exemple pour les onglets).&lt;/p&gt;
&lt;div class="section" id="id7"&gt;
&lt;h3&gt;À venir&lt;/h3&gt;
&lt;p&gt;Si &lt;em&gt;browser.html&lt;/em&gt; doit stocker des données de navigation, il faudra ajouter
des fonctionnalités de chiffrement sur le client JS. Ça tombe bien, c'est un
sujet passionant, et &lt;a class="reference external" href="http://www.w3.org/TR/WebCryptoAPI/"&gt;il y a plusieurs standards&lt;/a&gt; !&lt;/p&gt;
&lt;p&gt;Pour éviter d'interroger le serveur à intervalle régulier afin de synchroniser les
changements, l'introduction des &lt;a class="reference external" href="https://w3c.github.io/push-api/"&gt;*push notifications*&lt;/a&gt; semble assez naturelle.
Il s'agirait alors de la dernière pierre qui manque à l'édifice pour obtenir
un «&lt;em&gt;Mobile/Web backend as a service&lt;/em&gt;» complet.&lt;/p&gt;
&lt;img alt="Roadmap - CC0" class="align-center" src="http://www.servicedenuages.fr/images/whistler-roadmap.jpg" style="width: 1024px; height: auto; max-width: 100%;"/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="conclusion"&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;Nous sommes dans une situation idéale, puisque ce que nous avions imaginé
sur &lt;a class="reference external" href="https://github.com/mozilla-services/kinto/wiki/Roadmap"&gt;notre feuille de route&lt;/a&gt; correspond à ce qui nous est demandé par les
différentes équipes.&lt;/p&gt;
&lt;p&gt;L'enjeu consiste maintenant à se coordonner avec tout le monde, ne pas décevoir,
tenir la charge, continuer à améliorer et à faire la promotion du produit, se concentrer
sur les prochaines étapes et embarquer quelques contributeurs à nos cotés pour
construire une solution libre, générique, simple et auto-hébergeable pour le stockage
de données sur le Web :)&lt;/p&gt;
&lt;img alt="Friday Night Party - CC0" class="align-center" src="http://www.servicedenuages.fr/images/whistler-top-roof.jpg" style="width: 1024px; height: auto; max-width: 100%;"/&gt;
&lt;/div&gt;
</summary><category term="mozilla"></category></entry><entry><title>Achievement unlocked</title><link href="http://www.servicedenuages.fr/kinto-1.0" rel="alternate"></link><published>2015-06-17T00:00:00+02:00</published><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2015-06-17:kinto-1.0</id><summary type="html">&lt;p&gt;Aujourd'hui, c'est jour de fête : nous venons de publier Cliquet &lt;strong&gt;2.0&lt;/strong&gt;
&lt;a class="footnote-reference" href="#id5" id="id1"&gt;[1]&lt;/a&gt; et Kinto &lt;strong&gt;1.0&lt;/strong&gt; &lt;a class="footnote-reference" href="#id6" id="id2"&gt;[2]&lt;/a&gt;.&lt;/p&gt;
&lt;blockquote class="epigraph"&gt;
&lt;p&gt;L'aboutissement de 3 années de R&amp;amp;D !&lt;/p&gt;
&lt;p class="attribution"&gt;—Rémy&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;a class="reference external" href="https://kinto.readthedocs.io/en/latest/"&gt;Kinto&lt;/a&gt; est un service pour
stocker, synchroniser et partager des données arbitraires, attachées à un
compte Firefox (mais le système d'authentification est &lt;em&gt;pluggable&lt;/em&gt;).&lt;/p&gt;
&lt;p&gt;&lt;a class="reference external" href="https://cliquet.readthedocs.io/en/latest/"&gt;Cliquet&lt;/a&gt; est une boite à outils pour faciliter l'implémentation de
micro-services HTTP tels que les APIs &lt;em&gt;REST&lt;/em&gt; ayant des besoins de synchronisation.&lt;/p&gt;
&lt;p&gt;Vous pouvez lire plus à propos des raisons qui nous ont poussé à proposer cette nouvelle solution
et de notre ambition sur &lt;a class="reference external" href="http://www.servicedenuages.fr/eco-systeme-et-stockage-generique.html"&gt;http://www.servicedenuages.fr/eco-systeme-et-stockage-generique.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Nous sommes fiers du travail que nous avons pu réaliser durant ces derniers
mois sur ces deux projets. Bien que la plupart du travail que nous ayons
réalisé pour le serveur de liste de lecture (Reading List) ait pu être utilisé,
beaucoup de parties ont été repensées et nous avons introduit des
fonctionnalités que l'on attendait depuis longtemps, comme la gestion des
permissions.&lt;/p&gt;
&lt;p&gt;Bien sur, exactement comme après un ré-aménagement de salon, on ne peut
s'empêcher de voir toutes les choses qui doivent toujours être améliorées,
notamment sur la documentation et les performances.&lt;/p&gt;
&lt;p&gt;On peut déjà entrevoir à quoi l'écosystème va ressembler, et c'est prometteur.
Il y a déjà un client JavaScript &lt;a class="footnote-reference" href="#id7" id="id3"&gt;[3]&lt;/a&gt; dont l'objectif est de synchroniser les
données locales du navigateur avec une instance de Kinto.&lt;/p&gt;
&lt;p&gt;N'hésitez vraiment pas à nous solliciter pour discuter avec vous si vous avez
des problématiques proches : nous accueillons avec plaisir toutes sortes de
retours, que ce soit à propos du code, de la documentation, de la sécurité de
la solution ou de la manière de communiquer avec le monde extérieur. Si vous
souhaitez nous contacter, vous pouvez laisser un commentaire ici ou nous
contacter sur le canal &lt;a class="reference external" href="irc://irc.mozilla.org/#storage"&gt;#storage&lt;/a&gt; sur le réseau IRC de Mozilla.&lt;/p&gt;
&lt;p&gt;Et ce n'est que le début ! Le futur se dessine dans notre feuille de route
&lt;a class="footnote-reference" href="#id8" id="id4"&gt;[4]&lt;/a&gt;.&lt;/p&gt;
&lt;table class="docutils footnote" frame="void" id="id5" rules="none"&gt;
&lt;colgroup&gt;&lt;col class="label"&gt;&lt;/col&gt;&lt;col&gt;&lt;/col&gt;&lt;/colgroup&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td class="label"&gt;&lt;a class="fn-backref" href="#id1"&gt;[1]&lt;/a&gt;&lt;/td&gt;&lt;td&gt;&lt;strong&gt;Cliquet&lt;/strong&gt; est une boite à outils pour faciliter l'implémentation de
microservices HTTP tels que les APIs &lt;em&gt;REST&lt;/em&gt; ayant des besoins de
synchronisation.&lt;/td&gt;&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;table class="docutils footnote" frame="void" id="id6" rules="none"&gt;
&lt;colgroup&gt;&lt;col class="label"&gt;&lt;/col&gt;&lt;col&gt;&lt;/col&gt;&lt;/colgroup&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td class="label"&gt;&lt;a class="fn-backref" href="#id2"&gt;[2]&lt;/a&gt;&lt;/td&gt;&lt;td&gt;&lt;strong&gt;Kinto&lt;/strong&gt; est un service pour stocker, synchroniser et partager des données
arbitraires, attachées à un compte Firefox (mais le système d'authentification
est &lt;em&gt;pluggable&lt;/em&gt;).&lt;/td&gt;&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;table class="docutils footnote" frame="void" id="id7" rules="none"&gt;
&lt;colgroup&gt;&lt;col class="label"&gt;&lt;/col&gt;&lt;col&gt;&lt;/col&gt;&lt;/colgroup&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td class="label"&gt;&lt;a class="fn-backref" href="#id3"&gt;[3]&lt;/a&gt;&lt;/td&gt;&lt;td&gt;Cliquetis, la bibliothèque JavaScript pour consommer l'API HTTP de Kinto —
&lt;a class="reference external" href="https://github.com/mozilla-services/cliquetis"&gt;https://github.com/mozilla-services/cliquetis&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;table class="docutils footnote" frame="void" id="id8" rules="none"&gt;
&lt;colgroup&gt;&lt;col class="label"&gt;&lt;/col&gt;&lt;col&gt;&lt;/col&gt;&lt;/colgroup&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td class="label"&gt;&lt;a class="fn-backref" href="#id4"&gt;[4]&lt;/a&gt;&lt;/td&gt;&lt;td&gt;La feuille de route de Kinto: &lt;a class="reference external" href="https://github.com/mozilla-services/kinto/wiki/roadmap"&gt;https://github.com/mozilla-services/kinto/wiki/roadmap&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
</summary><category term="mozilla"></category></entry><entry><title>Stocker et interroger les permissions avec Kinto</title><link href="http://www.servicedenuages.fr/stocker-et-interroger-les-permissions" rel="alternate"></link><published>2015-05-26T00:00:00+02:00</published><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2015-05-26:stocker-et-interroger-les-permissions</id><summary type="html">&lt;p&gt;&lt;strong&gt;tl;dr: On a maintenant un super système de permission mais comment faire pour stocker et interroger ces permissions de manière efficace ?&lt;/strong&gt;&lt;/p&gt;
&lt;div class="section" id="la-problematique"&gt;
&lt;h2&gt;La problématique&lt;/h2&gt;
&lt;p&gt;Maintenant que nous avons défini un modèle de gestion des permissions
sur les objets qui nous satisfait, le problème est de stocker ces
permissions de manière efficace afin de pouvoir autoriser ou interdire
l'accès à un objet pour la personne qui fait la requête.&lt;/p&gt;
&lt;p&gt;Chaque requête sur notre API va générer une ou plusieurs demandes
d'accès, il faut donc que la réponse soit très rapide sous peine
d'impacter la vélocité du service.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="obtenir-la-liste-des-principals-d-un-utilisateur"&gt;
&lt;h2&gt;Obtenir la liste des "principals" d'un utilisateur&lt;/h2&gt;
&lt;p&gt;Les &lt;em&gt;principals&lt;/em&gt; de l'utilisateur correspondent à son &lt;tt class="docutils literal"&gt;user_id&lt;/tt&gt;
ainsi qu'à la liste des identifiants des groupes dans lesquels il a
été ajouté.&lt;/p&gt;
&lt;p&gt;Pour éviter de recalculer les &lt;em&gt;principals&lt;/em&gt; de l'utilisateur à chaque
requête, le mieux reste de maintenir une liste des &lt;em&gt;principals&lt;/em&gt; par
utilisateur.&lt;/p&gt;
&lt;p&gt;Ainsi lorsqu'on ajoute un utilisateur à un groupe, il faut bien penser
à ajouter le groupe à la liste des &lt;em&gt;principals&lt;/em&gt; de l'utilisateur.&lt;/p&gt;
&lt;p&gt;Ça se complexifie lorsqu'on ajoute un groupe à un groupe.&lt;/p&gt;
&lt;p&gt;Dans un premier temps interdire l'ajout d'un groupe à un groupe est
une limitation qu'on est prêts à accepter pour simplifier le
modèle.&lt;/p&gt;
&lt;p&gt;L'avantage de maintenir la liste des &lt;em&gt;principals&lt;/em&gt; d'un utilisateur
lors de la modification de cette liste c'est qu'elle est déjà
construite lors des lectures, qui sont dans notre cas plus fréquentes
que les écritures.&lt;/p&gt;
&lt;p&gt;Cela nécessite de donner un identifiant unique aux groupes pour tous
les &lt;em&gt;buckets&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;Nous proposons de de les nommer avec leur URI:
&lt;tt class="docutils literal"&gt;/buckets/blog/groups/moderators&lt;/tt&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="obtenir-la-liste-des-principals-d-un-ace"&gt;
&lt;h2&gt;Obtenir la liste des "principals" d'un ACE&lt;/h2&gt;
&lt;blockquote&gt;
Rappel, un "ACE" est un &lt;em&gt;Access Control Entry&lt;/em&gt;, un des éléments
d'une ACL (e.g. &lt;em&gt;modifier un enregistrement&lt;/em&gt;).&lt;/blockquote&gt;
&lt;p&gt;Avec le &lt;a class="reference external" href="http://www.servicedenuages.fr/la-gestion-des-permissions"&gt;système de permissions choisi&lt;/a&gt;, les permissions d'un
objet héritent de celle de l'objet parent.&lt;/p&gt;
&lt;p&gt;Par exemple, avoir le droit d'écriture sur un &lt;em&gt;bucket&lt;/em&gt; permet la
création des permissions et la modification de tous ses records.&lt;/p&gt;
&lt;p&gt;Ce qui veut dire que pour obtenir la liste complète des &lt;em&gt;principals&lt;/em&gt;
ayant une permission sur un objet, il faut regarder à plusieurs
endroits.&lt;/p&gt;
&lt;p&gt;Rémy a &lt;a class="reference external" href="https://gist.github.com/Natim/77c8f61c1d42e476cef8#file-permission-py-L9-L52"&gt;décrit dans un gist la liste d'héritage de chaque permission&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Prenons l'exemple de l'ajout d'un record dans une collection.&lt;/p&gt;
&lt;p&gt;Le droit &lt;tt class="docutils literal"&gt;records:create&lt;/tt&gt; est obtenu si l'on a l'un des droits suivants:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;tt class="docutils literal"&gt;bucket:write&lt;/tt&gt;&lt;/li&gt;
&lt;li&gt;&lt;tt class="docutils literal"&gt;collection:write&lt;/tt&gt;&lt;/li&gt;
&lt;li&gt;&lt;tt class="docutils literal"&gt;records:create&lt;/tt&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Notre première idée était de stocker les permissions sur chaque objet
et de maintenir la liste exhaustive des permissions lors d'une
modification d'ACL. Cependant cela nécessitait de construire cette
liste lors de l'ajout d'un objet et de mettre à jour tout l'arbre lors
de sa suppression.  (&lt;em&gt;Je vous laisse imaginer le nombre d'opérations
nécessaires pour ajouter un administrateur sur un *bucket&lt;/em&gt; contenant
1000 collections avec 100000 records chacune.*)&lt;/p&gt;
&lt;p&gt;La solution que nous avons désormais adoptée consiste à stocker les
&lt;em&gt;principals&lt;/em&gt; de chaque &lt;em&gt;ACE&lt;/em&gt; (&lt;em&gt;qui&lt;/em&gt; a le droit de faire telle action
sur l'objet), et de faire l'union des &lt;em&gt;ACE&lt;/em&gt; hérités, afin de les
croiser avec les &lt;em&gt;principals&lt;/em&gt; de l'utilisateur :&lt;/p&gt;
&lt;blockquote&gt;
(ACE(object, permission) ∪ inherited_ACE) ∩ PRINCIPALS(user)&lt;/blockquote&gt;
&lt;p&gt;Par exemple l'ACE: &lt;tt class="docutils literal"&gt;/buckets/blog/collections/article:records:create&lt;/tt&gt; hérite de
l'ACE &lt;tt class="docutils literal"&gt;/buckets/blog/collections/article:write&lt;/tt&gt; et de &lt;tt class="docutils literal"&gt;/buckets/blog:write&lt;/tt&gt; :&lt;/p&gt;
&lt;blockquote&gt;
(ACE(/buckets/blog/collections/article:records:create) ∪ ACE(/buckets/blog/collections/article:write) ∪ ACE(/buckets/blog:write)) ∩ PRINCIPALS('fxa:alexis')&lt;/blockquote&gt;
&lt;/div&gt;
&lt;div class="section" id="recuperer-les-donnees-de-l-utilisateur"&gt;
&lt;h2&gt;Récupérer les données de l'utilisateur&lt;/h2&gt;
&lt;p&gt;La situation se corse lorsqu'on souhaite limiter la liste des
&lt;em&gt;records&lt;/em&gt; d'une collection à ceux accessibles pour l'utilisateur, car
on doit faire cette intersection pour tous les &lt;em&gt;records&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;Une première solution est de regarder si l'utilisateur est mentionné
dans les &lt;em&gt;ACL*s du *bucket&lt;/em&gt; ou de la &lt;em&gt;collection&lt;/em&gt;:&lt;/p&gt;
&lt;p&gt;Ensuite, si ce n'est pas le cas, alors on filtre les &lt;em&gt;records&lt;/em&gt; pour
lesquels les &lt;em&gt;principals&lt;/em&gt; correspondent à ceux de l'utilisateur.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;principals&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;get_user_principals&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user_id&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;can_read_all&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;has_read_perms&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;bucket_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;collection_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                              &lt;span class="n"&gt;principals&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;can_read_all&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;records&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;get_all_records&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;bucket_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;collection_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                              &lt;span class="n"&gt;filters&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
&lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;records&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;filter_read_records&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;bucket_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;collection_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                                  &lt;span class="n"&gt;principals&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;principals&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                                  &lt;span class="n"&gt;filters&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Il faudra faire quelque chose de similaire pour la suppression
multiple, lorsqu'un utilisateur souhaitera supprimer des
enregistrements sur lesquels il a les droits de lecture mais pas
d'écriture.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="le-modele-de-donnees"&gt;
&lt;h2&gt;Le modèle de données&lt;/h2&gt;
&lt;p&gt;Pour avoir une idée des requêtes dans un backend SQL, voyons un peu ce
que donnerait le modèle de données.&lt;/p&gt;
&lt;div class="section" id="le-format-des-id"&gt;
&lt;h3&gt;Le format des ID&lt;/h3&gt;
&lt;p&gt;Utiliser des URI comme identifiant des objets présente de nombreux
avantages (lisibilité, unicité, cohérence avec les URLs)&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;bucket: &lt;tt class="docutils literal"&gt;/buckets/blog&lt;/tt&gt;&lt;/li&gt;
&lt;li&gt;groupe: &lt;tt class="docutils literal"&gt;/buckets/blog/group/moderators&lt;/tt&gt;&lt;/li&gt;
&lt;li&gt;collection: &lt;tt class="docutils literal"&gt;/buckets/blog/collections/articles&lt;/tt&gt;&lt;/li&gt;
&lt;li&gt;record: &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;/buckets/blog/collections/articles/records/02f3f76f-7059-4ae4-888f-2ac9824e9200&lt;/span&gt;&lt;/tt&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="section" id="les-tables"&gt;
&lt;h3&gt;Les tables&lt;/h3&gt;
&lt;p&gt;Pour le stockage des principals et des permissions:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;CREATE&lt;/span&gt; &lt;span class="k"&gt;TABLE&lt;/span&gt; &lt;span class="k"&gt;user&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt; &lt;span class="nb"&gt;TEXT&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;principals&lt;/span&gt; &lt;span class="nb"&gt;TEXT&lt;/span&gt;&lt;span class="p"&gt;[]);&lt;/span&gt;
&lt;span class="k"&gt;CREATE&lt;/span&gt; &lt;span class="k"&gt;TABLE&lt;/span&gt; &lt;span class="n"&gt;perms&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ace&lt;/span&gt; &lt;span class="nb"&gt;TEXT&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;principals&lt;/span&gt; &lt;span class="nb"&gt;TEXT&lt;/span&gt;&lt;span class="p"&gt;[]);&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;La table &lt;em&gt;perms&lt;/em&gt; va associer des &lt;em&gt;principals&lt;/em&gt; à chaque &lt;em&gt;ACE&lt;/em&gt;
(e.g.``/buckets/blog:write``).&lt;/p&gt;
&lt;p&gt;Pour le stockage des données:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;CREATE&lt;/span&gt; &lt;span class="k"&gt;TABLE&lt;/span&gt; &lt;span class="k"&gt;object&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt; &lt;span class="nb"&gt;TEXT&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="k"&gt;type&lt;/span&gt; &lt;span class="nb"&gt;TEXT&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;parent_id&lt;/span&gt; &lt;span class="nb"&gt;TEXT&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="k"&gt;data&lt;/span&gt; &lt;span class="n"&gt;JSONB&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                    &lt;span class="n"&gt;write_principals&lt;/span&gt; &lt;span class="nb"&gt;TEXT&lt;/span&gt;&lt;span class="p"&gt;[],&lt;/span&gt; &lt;span class="n"&gt;read_principals&lt;/span&gt; &lt;span class="nb"&gt;TEXT&lt;/span&gt;&lt;span class="p"&gt;[]);&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;La colonne &lt;em&gt;parent_id&lt;/em&gt; permet de savoir à qui appartient l'objet
(e.g. groupe d'un &lt;em&gt;bucket&lt;/em&gt;, collection d'un &lt;em&gt;bucket&lt;/em&gt;, &lt;em&gt;record&lt;/em&gt; d'une
collection, ...).&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="exemple-d-utilisateur"&gt;
&lt;h3&gt;Exemple d'utilisateur&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;INSERT&lt;/span&gt; &lt;span class="k"&gt;INTO&lt;/span&gt; &lt;span class="k"&gt;user&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;principals&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
     &lt;span class="k"&gt;VALUES&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'fxa:alexis'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;'{}'&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

&lt;span class="k"&gt;INSERT&lt;/span&gt; &lt;span class="k"&gt;INTO&lt;/span&gt; &lt;span class="k"&gt;user&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;principals&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
     &lt;span class="k"&gt;VALUES&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'fxa:natim'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
             &lt;span class="s1"&gt;'{"/buckets/blog/groups/moderators"}'&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="exemple-d-objets"&gt;
&lt;h3&gt;Exemple d'objets&lt;/h3&gt;
&lt;div class="section" id="bucket"&gt;
&lt;h4&gt;Bucket&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;INSERT&lt;/span&gt; &lt;span class="k"&gt;INTO&lt;/span&gt; &lt;span class="k"&gt;object&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="k"&gt;type&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;parent_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="k"&gt;data&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                    &lt;span class="n"&gt;read_principals&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;write_principals&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;VALUES&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="s1"&gt;'/buckets/blog'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s1"&gt;'bucket'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="k"&gt;NULL&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s1"&gt;'{"name": "blog"}'&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;JSONB&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s1"&gt;'{}'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;'{"fxa:alexis"}'&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="group"&gt;
&lt;h4&gt;Group&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;INSERT&lt;/span&gt; &lt;span class="k"&gt;INTO&lt;/span&gt; &lt;span class="k"&gt;object&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="k"&gt;type&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;parent_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="k"&gt;data&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                    &lt;span class="n"&gt;read_principals&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;write_principals&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;VALUES&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="s1"&gt;'/buckets/blog/groups/moderators'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s1"&gt;'group'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s1"&gt;'/buckets/blog'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s1"&gt;'{"name": "moderators", "members": ['&lt;/span&gt;&lt;span class="n"&gt;fxa&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;natim&lt;/span&gt;&lt;span class="s1"&gt;']}'&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;JSONB&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s1"&gt;'{}'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;'{}'&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Ce groupe peut être gére par &lt;tt class="docutils literal"&gt;fxa:alexis&lt;/tt&gt; puisqu'il a la permission
&lt;tt class="docutils literal"&gt;write&lt;/tt&gt; dans le &lt;em&gt;bucket&lt;/em&gt; parent.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="collection"&gt;
&lt;h4&gt;Collection&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;INSERT&lt;/span&gt; &lt;span class="k"&gt;INTO&lt;/span&gt; &lt;span class="k"&gt;object&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="k"&gt;type&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;parent_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="k"&gt;data&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                    &lt;span class="n"&gt;read_principals&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;write_principals&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;VALUES&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="s1"&gt;'/buckets/blog/collections/articles'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s1"&gt;'collection'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s1"&gt;'/buckets/blog'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s1"&gt;'{"name": "article"}'&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;JSONB&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s1"&gt;'{"system.Everyone"}'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s1"&gt;'{"/buckets/blog/groups/moderators"}'&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Cette collection d'articles peut être lue par tout le monde,
et gérée par les membres du groupe &lt;tt class="docutils literal"&gt;moderators&lt;/tt&gt;, ainsi que
&lt;tt class="docutils literal"&gt;fxa:alexis&lt;/tt&gt;, via le &lt;em&gt;bucket&lt;/em&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="records"&gt;
&lt;h4&gt;Records&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;INSERT&lt;/span&gt; &lt;span class="k"&gt;INTO&lt;/span&gt; &lt;span class="k"&gt;object&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="k"&gt;type&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;parent_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="k"&gt;data&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                    &lt;span class="n"&gt;read_principals&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;write_principals&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;VALUES&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="s1"&gt;'/buckets/blog/collections/articles/records/02f3f76f-7059-4ae4-888f-2ac9824e9200'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s1"&gt;'record'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s1"&gt;'/buckets/blog/collections/articles'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s1"&gt;'{"name": "02f3f76f-7059-4ae4-888f-2ac9824e9200",&lt;/span&gt;
&lt;span class="s1"&gt;      "title": "Stocker les permissions", ...}'&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;JSONB&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s1"&gt;'{}'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;'{}'&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="interroger-les-permissions"&gt;
&lt;h3&gt;Interroger les permissions&lt;/h3&gt;
&lt;div class="section" id="id1"&gt;
&lt;h4&gt;Obtenir la liste des "principals" d'un ACE&lt;/h4&gt;
&lt;p&gt;Comme vu plus haut, pour vérifier une permission, on fait l'union des
&lt;em&gt;principals&lt;/em&gt; requis par les objets hérités, et on teste leur
intersection avec ceux de l'utilisateur:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;WITH&lt;/span&gt; &lt;span class="n"&gt;required_principals&lt;/span&gt; &lt;span class="k"&gt;AS&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;
     &lt;span class="k"&gt;SELECT&lt;/span&gt; &lt;span class="k"&gt;unnest&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;principals&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;AS&lt;/span&gt; &lt;span class="n"&gt;p&lt;/span&gt;
       &lt;span class="k"&gt;FROM&lt;/span&gt; &lt;span class="n"&gt;perms&lt;/span&gt;
      &lt;span class="k"&gt;WHERE&lt;/span&gt; &lt;span class="n"&gt;ace&lt;/span&gt; &lt;span class="k"&gt;IN&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;
         &lt;span class="s1"&gt;'/buckets/blog:write'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
         &lt;span class="s1"&gt;'/buckets/blog:read'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
         &lt;span class="s1"&gt;'/buckets/blog/collections/article:write'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
         &lt;span class="s1"&gt;'/buckets/blog/collections/article:read'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
 &lt;span class="p"&gt;),&lt;/span&gt;
 &lt;span class="n"&gt;user_principals&lt;/span&gt; &lt;span class="k"&gt;AS&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;
     &lt;span class="k"&gt;SELECT&lt;/span&gt; &lt;span class="k"&gt;unnest&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;principals&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
       &lt;span class="k"&gt;FROM&lt;/span&gt; &lt;span class="k"&gt;user&lt;/span&gt;
      &lt;span class="k"&gt;WHERE&lt;/span&gt; &lt;span class="n"&gt;id&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;'fxa:natim'&lt;/span&gt;
 &lt;span class="p"&gt;)&lt;/span&gt;
 &lt;span class="k"&gt;SELECT&lt;/span&gt; &lt;span class="k"&gt;COUNT&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
   &lt;span class="k"&gt;FROM&lt;/span&gt; &lt;span class="n"&gt;user_principals&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt;
  &lt;span class="k"&gt;INNER&lt;/span&gt; &lt;span class="k"&gt;JOIN&lt;/span&gt; &lt;span class="n"&gt;required_principals&lt;/span&gt; &lt;span class="n"&gt;b&lt;/span&gt;
     &lt;span class="k"&gt;ON&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;p&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="filtrer-les-objets-en-fonction-des-permissions"&gt;
&lt;h4&gt;Filtrer les objets en fonction des permissions&lt;/h4&gt;
&lt;p&gt;Pour filtrer les objets, on fait une simple intersection de liste
(&lt;em&gt;merci PostgreSQL&lt;/em&gt;):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt; &lt;span class="k"&gt;data&lt;/span&gt;
  &lt;span class="k"&gt;FROM&lt;/span&gt; &lt;span class="k"&gt;object&lt;/span&gt; &lt;span class="n"&gt;o&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="k"&gt;user&lt;/span&gt; &lt;span class="n"&gt;u&lt;/span&gt;
 &lt;span class="k"&gt;WHERE&lt;/span&gt; &lt;span class="n"&gt;o&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="k"&gt;type&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;'record'&lt;/span&gt;
   &lt;span class="k"&gt;AND&lt;/span&gt; &lt;span class="n"&gt;o&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;parent_id&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;'/buckets/blog/collections/article'&lt;/span&gt;
   &lt;span class="k"&gt;AND&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;o&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;read_principals&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;principals&lt;/span&gt; &lt;span class="k"&gt;OR&lt;/span&gt;
        &lt;span class="n"&gt;o&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;write_principals&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;principals&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
   &lt;span class="k"&gt;AND&lt;/span&gt; &lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;'fxa:natim'&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Les listes s'indexent bien, notamment grâce aux &lt;a class="reference external" href="http://www.postgresql.org/docs/current/static/indexes-types.html"&gt;index GIN&lt;/a&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="avec-redis"&gt;
&lt;h3&gt;Avec Redis&lt;/h3&gt;
&lt;p&gt;&lt;em&gt;Redis&lt;/em&gt; présente plusieurs avantages pour ce genre de
problématiques. Notamment, il gère les &lt;em&gt;set&lt;/em&gt; nativement (listes de
valeurs uniques), ainsi que les opérations d'intersection et d'union.&lt;/p&gt;
&lt;p&gt;Avec &lt;em&gt;Redis&lt;/em&gt; on peut écrire l'obtention des &lt;em&gt;principals&lt;/em&gt; pour un &lt;em&gt;ACE&lt;/em&gt;
comme cela :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;SUNIONSTORE temp_perm:/buckets/blog/collections/articles:write  permission:/buckets/blog:write  permission:/buckets/blog/collections/articles:write
SINTER temp_perm:/buckets/blog/collections/articles:write principals:fxa:alexis
&lt;/pre&gt;&lt;/div&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;tt class="docutils literal"&gt;SUNIONSTORE&lt;/tt&gt; permet de créer un set contenant les éléments de
l'union de tous les set suivants. Dans notre cas on le nomme
&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;temp_perm:/buckets/blog/collections/articles:write&lt;/span&gt;&lt;/tt&gt; et il contient
l'union des sets d'ACLs suivants:
- &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;permission:/buckets/blog:write&lt;/span&gt;&lt;/tt&gt;
- &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;permission:/buckets/blog/collections/articles:write&lt;/span&gt;&lt;/tt&gt;&lt;/li&gt;
&lt;li&gt;&lt;tt class="docutils literal"&gt;SINTER&lt;/tt&gt; retourne l'intersection de tous les sets passés en paramètres dans notre cas :
- &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;temp_perm:/buckets/blog/collections/articles:write&lt;/span&gt;&lt;/tt&gt;
- &lt;tt class="docutils literal"&gt;principals:fxa:alexis&lt;/tt&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Plus d'informations sur :
- &lt;a class="reference external" href="http://redis.io/commands/sinter"&gt;http://redis.io/commands/sinter&lt;/a&gt;
- &lt;a class="reference external" href="http://redis.io/commands/sunionstore"&gt;http://redis.io/commands/sunionstore&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Si le set résultant de la commande &lt;tt class="docutils literal"&gt;SINTER&lt;/tt&gt; n'est pas vide, alors
l'utilisateur possède la permission.&lt;/p&gt;
&lt;p&gt;On peut ensuite supprimer la clé temporaire &lt;tt class="docutils literal"&gt;temp_perm&lt;/tt&gt;.&lt;/p&gt;
&lt;p&gt;En utilisant &lt;tt class="docutils literal"&gt;MULTI&lt;/tt&gt; on peut &lt;a class="reference external" href="https://gist.github.com/Natim/77c8f61c1d42e476cef8#file-permission-py-L117-L124"&gt;même faire tout cela au sein d'une
transaction&lt;/a&gt;
et garantir ainsi l'intégrité de la requête.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="conclusion"&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;La solution a l'air simple mais nous a demandé beaucoup de réflexion
en passant par plusieurs propositions.&lt;/p&gt;
&lt;p&gt;L'idée finale est d'avoir :&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Un backend spécifique permettant de stocker les &lt;em&gt;principals&lt;/em&gt; des
utilisateurs et des &lt;em&gt;ACE&lt;/em&gt; (e.g. avec les sets Redis) ;&lt;/li&gt;
&lt;li&gt;La liste des principals read et write sur la table des objets.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;C'est dommage d'avoir le concept de permissions à deux endroits, mais
cela permet de connaître rapidement la permission d'un utilisateur sur
un objet et également de pouvoir récupérer tous les objets d'une
collection pour un utilisateur si celui-ci n'a pas accès à tous les
records de la collection, ou toutes les collections du bucket.&lt;/p&gt;
&lt;/div&gt;
</summary><category term="mozilla"></category></entry><entry><title>La gestion des permissions</title><link href="http://www.servicedenuages.fr/la-gestion-des-permissions" rel="alternate"></link><published>2015-05-12T00:00:00+02:00</published><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2015-05-12:la-gestion-des-permissions</id><summary type="html">&lt;p&gt;Dans le cadre de la création d'un service de stockage de données personnelles
(Kinto), la gestion des permissions est un des gros challenges : qui doit avoir
accès à quoi, et comment le définir ?&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;tl;dr: Quelques retours sur le vocabulaire des systèmes de permission et sur nos idées pour l'implementation des permissions dans un stockage générique.&lt;/strong&gt;&lt;/p&gt;
&lt;div class="section" id="la-problematique"&gt;
&lt;h2&gt;La problématique&lt;/h2&gt;
&lt;p&gt;La problématique est simple : des données sont stockées en ligne, et il
faut un moyen de pouvoir les partager avec d'autres personnes.&lt;/p&gt;
&lt;p&gt;En regardant les cas d'utilisations, on se rend compte qu'on a plusieurs types
d'utilisateurs :&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;les utilisateurs "finaux" (vous) ;&lt;/li&gt;
&lt;li&gt;les applications qui interagissent en leurs noms.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Tous les intervenants n'ont donc pas les mêmes droits : certains doivent
pouvoir lire, d'autres écrire, d'autres encore créer de nouveaux
enregistrements, et le contrôle doit pouvoir s'effectuer de manière fine : il
doit être possible de lire un enregistrement mais pas un autre, par exemple.&lt;/p&gt;
&lt;p&gt;Nous sommes partis du constat que les solutions disponibles n'apportaient pas
une réponse satisfaisante à ces besoins.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="un-probleme-de-vocabulaire"&gt;
&lt;h2&gt;Un problème de vocabulaire&lt;/h2&gt;
&lt;p&gt;Le principal problème rencontré lors des réflexions fût le vocabulaire.&lt;/p&gt;
&lt;p&gt;Voici ci-dessous une explication des différents termes.&lt;/p&gt;
&lt;div class="section" id="le-concept-de-principal"&gt;
&lt;h3&gt;Le concept de « principal »&lt;/h3&gt;
&lt;p&gt;Un &lt;em&gt;principal&lt;/em&gt;, en sécurité informatique, est une entité qui peut être
authentifiée par un système informatique. &lt;a class="footnote-reference" href="#id2" id="id1"&gt;[1]&lt;/a&gt; En Français il s'agit
du « commettant », l'acteur qui commet l'action (oui, le terme est conceptuel !)&lt;/p&gt;
&lt;p&gt;Il peut s'agir aussi bien d'un individu, d'un ordinateur, d'un
service ou d'un groupe regroupant l'une de ces entités, ce qui
est plus large que le classique « &lt;em&gt;user id&lt;/em&gt; ».&lt;/p&gt;
&lt;p&gt;Les permissions sont alors associées à ces &lt;em&gt;principals&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;Par exemple, un utilisateur est identifié de manière unique lors de la
connexion par le système d'authentification dont le rôle est de
définir une liste de &lt;em&gt;principals&lt;/em&gt; pour l'utilisateur se connectant.&lt;/p&gt;
&lt;table class="docutils footnote" frame="void" id="id2" rules="none"&gt;
&lt;colgroup&gt;&lt;col class="label"&gt;&lt;/col&gt;&lt;col&gt;&lt;/col&gt;&lt;/colgroup&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td class="label"&gt;&lt;a class="fn-backref" href="#id1"&gt;[1]&lt;/a&gt;&lt;/td&gt;&lt;td&gt;Pour en savoir plus sur les &lt;em&gt;principals&lt;/em&gt; :
&lt;a class="reference external" href="https://en.wikipedia.org/wiki/Principal_%28computer_security%29"&gt;https://en.wikipedia.org/wiki/Principal_%28computer_security%29&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;div class="section" id="la-difference-entre-role-et-groupe"&gt;
&lt;h3&gt;La différence entre rôle et groupe&lt;/h3&gt;
&lt;p&gt;De but en blanc, il n'est pas évident de définir précisément la
différence entre ces deux concepts qui permettent d'associer
des permissions à un groupe de &lt;em&gt;principals&lt;/em&gt;. &lt;a class="footnote-reference" href="#id4" id="id3"&gt;[2]&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;La différence est principalement sémantique. Mais on peut y voir une
différence dans la « direction » de la relation entre les deux concepts.&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Un rôle est une liste de permissions que l'on associe à un &lt;em&gt;principal&lt;/em&gt;.&lt;/li&gt;
&lt;li&gt;Un groupe est une liste de &lt;em&gt;principals&lt;/em&gt; que l'on peut associer à une permission.&lt;/li&gt;
&lt;/ul&gt;
&lt;table class="docutils footnote" frame="void" id="id4" rules="none"&gt;
&lt;colgroup&gt;&lt;col class="label"&gt;&lt;/col&gt;&lt;col&gt;&lt;/col&gt;&lt;/colgroup&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td class="label"&gt;&lt;a class="fn-backref" href="#id3"&gt;[2]&lt;/a&gt;&lt;/td&gt;&lt;td&gt;Plus d'informations :
&lt;a class="reference external" href="http://stackoverflow.com/questions/7770728/group-vs-role-any-real-difference"&gt;http://stackoverflow.com/questions/7770728/group-vs-role-any-real-difference&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;div class="section" id="la-difference-entre-permission-acl-ace"&gt;
&lt;h3&gt;La différence entre permission, ACL, ACE&lt;/h3&gt;
&lt;blockquote class="epigraph"&gt;
&lt;p&gt;Une ACL est une liste d’Access Control Entry (ACE) ou entrée de contrôle d'accès
donnant ou supprimant des droits d'accès à une personne ou un groupe.&lt;/p&gt;
&lt;p class="attribution"&gt;—&lt;a class="reference external" href="https://fr.wikipedia.org/wiki/Access_Control_List"&gt;https://fr.wikipedia.org/wiki/Access_Control_List&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Je dirais même plus, dans notre cas, « à un &lt;em&gt;principal&lt;/em&gt; ». Par exemple:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;create_record: alexis,remy,tarek
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Cet ACE donne la permission &lt;tt class="docutils literal"&gt;create&lt;/tt&gt; sur l'objet &lt;tt class="docutils literal"&gt;record&lt;/tt&gt; aux
utilisateurs Tarek, Rémy et Alexis.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="la-delegation-de-permissions"&gt;
&lt;h2&gt;La délégation de permissions&lt;/h2&gt;
&lt;p&gt;Imaginez l'exemple suivant, où un utilisateur stocke deux types de données en
ligne :&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;des contacts ;&lt;/li&gt;
&lt;li&gt;une liste de tâches à faire qu'il peut associer à ses contacts.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;L'utilisateur a tous les droits sur ses données.&lt;/p&gt;
&lt;p&gt;Cependant il utilise deux applications qui doivent elles avoir un accès restreint :&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;une application de gestion des contacts à qui il souhaite déléguer
la gestion intégrale de ses contacts : &lt;tt class="docutils literal"&gt;contacts:write&lt;/tt&gt; ;&lt;/li&gt;
&lt;li&gt;une application de gestion des tâches à qui il souhaite déléguer la
gestion des tâches : &lt;tt class="docutils literal"&gt;contacts:read tasks:write&lt;/tt&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Il souhaite que son application de contacts ne puisse pas accéder à
ses tâches et que son application de tâches ne puisse pas modifier ses
contacts existants, juste éventuellement en créer de nouveaux.&lt;/p&gt;
&lt;p&gt;Il lui faut donc un moyen de déléguer certains de ses droits à un tiers
(l'application).&lt;/p&gt;
&lt;p&gt;C'est précisément le rôle des &lt;a class="reference external" href="http://tools.ietf.org/html/rfc6749#page-23"&gt;scopes OAuth2&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Lors de la connexion d'un utilisateur, une fenêtre lui demande quels
accès il veut donner à l'application qui va agir en son nom.&lt;/p&gt;
&lt;p&gt;Le service aura ensuite accès à ces &lt;em&gt;scopes&lt;/em&gt; en regardant le jeton
d'authentification utilisé. Cette information doit être
considérée comme une entrée utilisateur (c'est à dire qu'on ne peut
pas lui faire confiance). Il s'agit de ce que l'utilisateur souhaite.&lt;/p&gt;
&lt;p&gt;Or, il est également possible que l'utilisateur n'ait pas accès aux données
qu'il demande. Le service doit donc utiliser deux niveaux de permissions :
celles de l'utilisateur, et celles qui ont été déléguées à l'application.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="espace-de-noms"&gt;
&lt;h2&gt;Espace de noms&lt;/h2&gt;
&lt;p&gt;Dans notre implémentation initiale de &lt;em&gt;Kinto&lt;/em&gt; (notre service de stockage en
construction), l'espace de nom était implicite : les données stockées étaient
nécessairement celles de l'utilisateur connecté.&lt;/p&gt;
&lt;p&gt;Les données d'un utilisateur étaient donc cloisonnées et impossible à partager.&lt;/p&gt;
&lt;p&gt;L'utilisation d'espaces de noms est une manière simple de gérer le partage des données.&lt;/p&gt;
&lt;p&gt;Nous avons choisi de reprendre le modèle de GitHub et de Bitbucket, qui
utilisent les « organisations » comme espaces de noms.&lt;/p&gt;
&lt;p&gt;Dans notre cas, il est possible de créer des "buckets", qui correspondent à ces
espaces de noms. Un bucket est un conteneur de collections et de groupes
utilisateurs.&lt;/p&gt;
&lt;p&gt;Les ACLs sur ces collections peuvent être attribuées à certains groupes du
&lt;em&gt;bucket&lt;/em&gt; ainsi qu'à d'autres &lt;em&gt;principals&lt;/em&gt; directement.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="notre-proposition-d-api"&gt;
&lt;h2&gt;Notre proposition d'API&lt;/h2&gt;
&lt;div class="section" id="les-objets-manipules"&gt;
&lt;h3&gt;Les objets manipulés&lt;/h3&gt;
&lt;p&gt;Pour mettre en place la gestion des permissions, nous avons identifié les
objets suivants :&lt;/p&gt;
&lt;table border="1" class="docutils"&gt;
&lt;colgroup&gt;
&lt;col width="23%"&gt;&lt;/col&gt;
&lt;col width="77%"&gt;&lt;/col&gt;
&lt;/colgroup&gt;
&lt;thead valign="bottom"&gt;
&lt;tr&gt;&lt;th class="head"&gt;Objet&lt;/th&gt;
&lt;th class="head"&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td&gt;&lt;strong&gt;bucket&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;On peut les voir comme des espaces de noms. Ils
permettent d'avoir différentes collections portant
le même nom mais stockées dans différents &lt;em&gt;buckets&lt;/em&gt; de
manière à ce que les données soient distinctes.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;strong&gt;collection&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Une liste d'enregistrements.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;strong&gt;record&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Un enregistrement d'une collection.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;strong&gt;group&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Un groupe de commetants (« &lt;em&gt;principals&lt;/em&gt; »).&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Pour la définition des ACLs, il y a une hiérarchie et les objets « héritent » des
ACLs de leur parents :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;           +---------------+
           | Bucket        |
           +---------------+
    +-----&amp;gt;+ - id          +&amp;lt;---+
    |      | - permissions |    |
    |      +---------------+    |
    |                           |
    |                           |
    |                           |
    |                           |
    |                           |
+---+-----------+        +------+---------+
| Collection    |        | Group          |
+---------------+        +----------------+
| - id          |        |  - id          |
| - permissions |        |  - members     |
+------+--------+        |  - permissions |
       ^                 +----------------+
       |
       |
+------+---------+
| Record         |
+----------------+
|  - id          |
|  - data        |
|  - permissions |
+----------------+
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="les-permissions"&gt;
&lt;h3&gt;Les permissions&lt;/h3&gt;
&lt;p&gt;Pour chacun de ces objets nous avons identifié les permissions suivantes :&lt;/p&gt;
&lt;table border="1" class="docutils"&gt;
&lt;colgroup&gt;
&lt;col width="23%"&gt;&lt;/col&gt;
&lt;col width="77%"&gt;&lt;/col&gt;
&lt;/colgroup&gt;
&lt;thead valign="bottom"&gt;
&lt;tr&gt;&lt;th class="head"&gt;Permission&lt;/th&gt;
&lt;th class="head"&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td&gt;&lt;strong&gt;read&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;La permission de lire le contenu de
l'objet et de ses sous-objets.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;strong&gt;write&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;La permission de modifier et
d'administrer un objet et ses sous-
objets. La permission &lt;em&gt;write&lt;/em&gt; permet la
lecture, modification et suppression
d'un objet ainsi que la gestion de ses
permissions.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;strong&gt;create&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;La permission de créer le sous-objet
spécifié. Par exemple:
&lt;tt class="docutils literal"&gt;collections:create&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;À chaque permission spécifiée sur un objet est associée une liste de
&lt;em&gt;principals&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;Dans le cas de la permission &lt;tt class="docutils literal"&gt;create&lt;/tt&gt; on est obligé de spécifier
l'objet enfant en question car un objet peut avoir plusieurs types
d'enfants. Par exemple : &lt;tt class="docutils literal"&gt;collections:create&lt;/tt&gt;, &lt;tt class="docutils literal"&gt;groups:create&lt;/tt&gt;.&lt;/p&gt;
&lt;p&gt;Nous n'avons pour l'instant pas de permission pour &lt;cite&gt;delete&lt;/cite&gt; et &lt;cite&gt;update&lt;/cite&gt;,
puisque nous n'avons pas trouvé de cas d'utilisation qui les nécessitent.
Quiconque avec le droit d'écriture peut donc supprimer un enregistrement.&lt;/p&gt;
&lt;p&gt;Les permissions d'un objet sont héritées de son parent. Par exemple,
un enregistrement créé dans une collection accessible à tout le monde
en lecture sera lui aussi accessible à tout le monde.&lt;/p&gt;
&lt;p&gt;Par conséquent, les permissions sont cumulées. Autrement dit, il n'est pas
possible qu'un objet ait des permissions plus restrictives que son parent.&lt;/p&gt;
&lt;p&gt;Voici la liste exhaustive des permissions :&lt;/p&gt;
&lt;table border="1" class="docutils"&gt;
&lt;colgroup&gt;
&lt;col width="21%"&gt;&lt;/col&gt;
&lt;col width="32%"&gt;&lt;/col&gt;
&lt;col width="47%"&gt;&lt;/col&gt;
&lt;/colgroup&gt;
&lt;thead valign="bottom"&gt;
&lt;tr&gt;&lt;th class="head"&gt;Objet&lt;/th&gt;
&lt;th class="head"&gt;Permissions associées&lt;/th&gt;
&lt;th class="head"&gt;Commentaire&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td&gt;Configuration
(.ini)&lt;/td&gt;
&lt;td&gt;&lt;cite&gt;buckets:create&lt;/cite&gt;&lt;/td&gt;
&lt;td&gt;Les &lt;em&gt;principals&lt;/em&gt; ayant le droit
de créer un bucket sont définis
dans la configuration du serveur.
(&lt;em&gt;ex. utilisateurs authentifiés&lt;/em&gt;)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td rowspan="4"&gt;&lt;tt class="docutils literal"&gt;bucket&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;cite&gt;write&lt;/cite&gt;&lt;/td&gt;
&lt;td&gt;C'est en quelque sorte le droit
d'administration du &lt;em&gt;bucket&lt;/em&gt;.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;cite&gt;read&lt;/cite&gt;&lt;/td&gt;
&lt;td&gt;C'est le droit de lire le contenu
de tous les objets du &lt;em&gt;bucket&lt;/em&gt;.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;cite&gt;collections:create&lt;/cite&gt;&lt;/td&gt;
&lt;td&gt;Permission de créer des
collections dans le &lt;em&gt;bucket&lt;/em&gt;.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;cite&gt;groups:create&lt;/cite&gt;&lt;/td&gt;
&lt;td&gt;Permission de créer des groupes
dans le &lt;em&gt;bucket&lt;/em&gt;.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td rowspan="3"&gt;&lt;tt class="docutils literal"&gt;collection&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;cite&gt;write&lt;/cite&gt;&lt;/td&gt;
&lt;td&gt;Permission d'administrer tous les
objets de la collection.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;cite&gt;read&lt;/cite&gt;&lt;/td&gt;
&lt;td&gt;Permission de consulter tous les
objets de la collection.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;cite&gt;records:create&lt;/cite&gt;&lt;/td&gt;
&lt;td&gt;Permission de créer des nouveaux
enregistrement dans la collection.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td rowspan="2"&gt;&lt;tt class="docutils literal"&gt;record&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;cite&gt;write&lt;/cite&gt;&lt;/td&gt;
&lt;td&gt;Permission de modifier ou de
partager l'enregistrement.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;cite&gt;read&lt;/cite&gt;&lt;/td&gt;
&lt;td&gt;Permission de consulter
l'enregistrement.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td rowspan="2"&gt;&lt;tt class="docutils literal"&gt;group&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;cite&gt;write&lt;/cite&gt;&lt;/td&gt;
&lt;td&gt;Permission d'administrer le
groupe&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;cite&gt;read&lt;/cite&gt;&lt;/td&gt;
&lt;td&gt;Permission de consulter les
membres du groupe.&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;div class="section" id="les-principals"&gt;
&lt;h3&gt;Les « &lt;em&gt;principals&lt;/em&gt; »&lt;/h3&gt;
&lt;p&gt;Les acteurs se connectant au service de stockage peuvent s'authentifier.&lt;/p&gt;
&lt;p&gt;Ils reçoivent alors une liste de &lt;em&gt;principals&lt;/em&gt; :&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;tt class="docutils literal"&gt;Everyone&lt;/tt&gt;: le &lt;em&gt;principal&lt;/em&gt; donné à tous les acteurs (authentifiés ou pas) ;&lt;/li&gt;
&lt;li&gt;&lt;tt class="docutils literal"&gt;Authenticated&lt;/tt&gt;: le &lt;em&gt;principal&lt;/em&gt; donné à tous les acteurs authentifiés ;&lt;/li&gt;
&lt;li&gt;un &lt;em&gt;principal&lt;/em&gt; identifiant l'acteur, par exemple &lt;tt class="docutils literal"&gt;fxa:32aa95a474c984d41d395e2d0b614aa2&lt;/tt&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Afin d'éviter les collisions d'identifiants, le &lt;em&gt;principal&lt;/em&gt; de l'acteur dépend
de son type d'authentification (&lt;tt class="docutils literal"&gt;system&lt;/tt&gt;, &lt;tt class="docutils literal"&gt;basic&lt;/tt&gt;, &lt;tt class="docutils literal"&gt;ipaddr&lt;/tt&gt;, &lt;tt class="docutils literal"&gt;hawk&lt;/tt&gt;,
&lt;tt class="docutils literal"&gt;fxa&lt;/tt&gt;) et de son identifiant (unique par acteur).&lt;/p&gt;
&lt;p&gt;En fonction du &lt;em&gt;bucket&lt;/em&gt; sur lequel se passe l'action, les groupes dont
fait partie l'utilisateur sont également ajoutés à sa liste de
&lt;tt class="docutils literal"&gt;principals&lt;/tt&gt;. &lt;tt class="docutils literal"&gt;group:moderators&lt;/tt&gt; par exemple.&lt;/p&gt;
&lt;p&gt;Ainsi, si Bob se connecte avec &lt;em&gt;Firefox Accounts&lt;/em&gt; sur le &lt;em&gt;bucket&lt;/em&gt;
&lt;tt class="docutils literal"&gt;servicedenuages_blog&lt;/tt&gt; dans lequel il fait partie du groupe
&lt;tt class="docutils literal"&gt;moderators&lt;/tt&gt;, il aura la liste de &lt;em&gt;principals&lt;/em&gt; suivante :
&lt;tt class="docutils literal"&gt;Everyone, Authenticated, fxa:32aa95a474c984d41d395e2d0b614aa2, group:moderators&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Il est donc possible d'assigner une permission à Bob en utilisant l'un de
ces quatre &lt;em&gt;principals&lt;/em&gt;.&lt;/p&gt;
&lt;div class="note"&gt;
&lt;p class="first admonition-title"&gt;Note&lt;/p&gt;
&lt;p class="last"&gt;Le &lt;em&gt;principal&lt;/em&gt; &lt;tt class="docutils literal"&gt;&amp;lt;userid&amp;gt;&lt;/tt&gt; dépend du &lt;em&gt;back-end&lt;/em&gt; d'authentification (e.g.
&lt;tt class="docutils literal"&gt;github:leplatrem&lt;/tt&gt;).&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="quelques-exemples"&gt;
&lt;h3&gt;Quelques exemples&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;Blog&lt;/strong&gt;&lt;/p&gt;
&lt;table border="1" class="docutils"&gt;
&lt;colgroup&gt;
&lt;col width="35%"&gt;&lt;/col&gt;
&lt;col width="18%"&gt;&lt;/col&gt;
&lt;col width="46%"&gt;&lt;/col&gt;
&lt;/colgroup&gt;
&lt;thead valign="bottom"&gt;
&lt;tr&gt;&lt;th class="head"&gt;Objet&lt;/th&gt;
&lt;th class="head"&gt;Permissions&lt;/th&gt;
&lt;th class="head"&gt;Principals&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td&gt;&lt;tt class="docutils literal"&gt;bucket:blog&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;write&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;fxa:&amp;lt;blog&lt;/span&gt; owner id&amp;gt;&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td rowspan="2"&gt;&lt;tt class="docutils literal"&gt;collection:articles&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;write&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;group:moderators&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;tt class="docutils literal"&gt;read&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;Everyone&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;tt class="docutils literal"&gt;record:569e28r98889&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;write&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;fxa:&amp;lt;co-author&lt;/span&gt; id&amp;gt;&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;Wiki&lt;/strong&gt;&lt;/p&gt;
&lt;table border="1" class="docutils"&gt;
&lt;colgroup&gt;
&lt;col width="35%"&gt;&lt;/col&gt;
&lt;col width="18%"&gt;&lt;/col&gt;
&lt;col width="46%"&gt;&lt;/col&gt;
&lt;/colgroup&gt;
&lt;thead valign="bottom"&gt;
&lt;tr&gt;&lt;th class="head"&gt;Object&lt;/th&gt;
&lt;th class="head"&gt;Permissions&lt;/th&gt;
&lt;th class="head"&gt;Principals&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td&gt;&lt;tt class="docutils literal"&gt;bucket:wiki&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;write&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;fxa:&amp;lt;wiki&lt;/span&gt; administrator id&amp;gt;&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td rowspan="2"&gt;&lt;tt class="docutils literal"&gt;collection:articles&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;write&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;Authenticated&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;tt class="docutils literal"&gt;read&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;Everyone&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;Sondages&lt;/strong&gt;&lt;/p&gt;
&lt;table border="1" class="docutils"&gt;
&lt;colgroup&gt;
&lt;col width="34%"&gt;&lt;/col&gt;
&lt;col width="31%"&gt;&lt;/col&gt;
&lt;col width="35%"&gt;&lt;/col&gt;
&lt;/colgroup&gt;
&lt;thead valign="bottom"&gt;
&lt;tr&gt;&lt;th class="head"&gt;Objet&lt;/th&gt;
&lt;th class="head"&gt;Permissions&lt;/th&gt;
&lt;th class="head"&gt;Principals&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td rowspan="2"&gt;&lt;tt class="docutils literal"&gt;bucket:poll&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;write&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;fxa:&amp;lt;admin&lt;/span&gt; id&amp;gt;&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;tt class="docutils literal"&gt;collection:create&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;Authenticated&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td rowspan="2"&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;collection:&amp;lt;poll&lt;/span&gt; id&amp;gt;&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;write&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;fxa:&amp;lt;poll&lt;/span&gt; author id&amp;gt;&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;tt class="docutils literal"&gt;record:create&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;Everyone&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;Cartes colaboratives&lt;/strong&gt;&lt;/p&gt;
&lt;table border="1" class="docutils"&gt;
&lt;colgroup&gt;
&lt;col width="34%"&gt;&lt;/col&gt;
&lt;col width="31%"&gt;&lt;/col&gt;
&lt;col width="35%"&gt;&lt;/col&gt;
&lt;/colgroup&gt;
&lt;thead valign="bottom"&gt;
&lt;tr&gt;&lt;th class="head"&gt;Objet&lt;/th&gt;
&lt;th class="head"&gt;Permissions&lt;/th&gt;
&lt;th class="head"&gt;Principals&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td rowspan="2"&gt;&lt;tt class="docutils literal"&gt;bucket:maps&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;write&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;fxa:&amp;lt;admin&lt;/span&gt; id&amp;gt;&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;tt class="docutils literal"&gt;collection:create&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;Authenticated&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td rowspan="2"&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;collection:&amp;lt;map&lt;/span&gt; id&amp;gt;&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;write&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;fxa:&amp;lt;map&lt;/span&gt; author id&amp;gt;&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;tt class="docutils literal"&gt;read&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;Everyone&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;record:&amp;lt;record&lt;/span&gt; id&amp;gt;&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;write&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;fxa:&amp;lt;maintainer&lt;/span&gt; id&amp;gt;&lt;/tt&gt;
(&lt;em&gt;ex. event staff member
maintaining venues&lt;/em&gt;)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;Plateformes&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Bien sûr, il y a plusieurs façons de modéliser les cas d'utilisation typiques.
Par exemple, on peut imaginer une plateforme de wikis (à la wikia.com), où les
wikis sont privés par défaut et certaines pages peuvent être rendues publiques :&lt;/p&gt;
&lt;table border="1" class="docutils"&gt;
&lt;colgroup&gt;
&lt;col width="32%"&gt;&lt;/col&gt;
&lt;col width="30%"&gt;&lt;/col&gt;
&lt;col width="38%"&gt;&lt;/col&gt;
&lt;/colgroup&gt;
&lt;thead valign="bottom"&gt;
&lt;tr&gt;&lt;th class="head"&gt;Objet&lt;/th&gt;
&lt;th class="head"&gt;Permissions&lt;/th&gt;
&lt;th class="head"&gt;Principals&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td rowspan="3"&gt;&lt;tt class="docutils literal"&gt;bucket:freewiki&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;write&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;fxa:&amp;lt;administrator&lt;/span&gt; id&amp;gt;&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;tt class="docutils literal"&gt;collection:create&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;Authenticated&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;tt class="docutils literal"&gt;group:create&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;Authenticated&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td rowspan="2"&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;collection:&amp;lt;wiki&lt;/span&gt; id&amp;gt;&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;write&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;fxa:&amp;lt;wiki&lt;/span&gt; owner id&amp;gt;&lt;/tt&gt;,
&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;group:&amp;lt;editors&lt;/span&gt; id&amp;gt;&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;tt class="docutils literal"&gt;read&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;group:&amp;lt;readers&lt;/span&gt; id&amp;gt;&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;record:&amp;lt;page&lt;/span&gt; id&amp;gt;&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;read&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;Everyone&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;div class="section" id="l-api-http"&gt;
&lt;h3&gt;L'API HTTP&lt;/h3&gt;
&lt;p&gt;Lors de la création d'un objet, l'utilisateur se voit
attribué la permission &lt;tt class="docutils literal"&gt;write&lt;/tt&gt; sur l'objet :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nf"&gt;PUT&lt;/span&gt; &lt;span class="nn"&gt;/v1/buckets/servicedenuages_blog&lt;/span&gt; &lt;span class="kr"&gt;HTTP&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="m"&gt;1.1&lt;/span&gt;
&lt;span class="na"&gt;Authorization&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="l"&gt;Bearer 0b9c2625dc21ef05f6ad4ddf47c5f203837aa32ca42fced54c2625dc21efac32&lt;/span&gt;
&lt;span class="na"&gt;Accept&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="l"&gt;application/json&lt;/span&gt;

HTTP/1.1 201 Created
Content-Type: application/json; charset=utf-8

{
    "id": "servicedenuages_blog",
    "permissions": {
        "write": ["fxa:49d02d55ad10973b7b9d0dc9eba7fdf0"]
    }
}
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Il est possible d'ajouter des permissions à l'aide de &lt;tt class="docutils literal"&gt;PATCH&lt;/tt&gt; :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nf"&gt;PATCH&lt;/span&gt; &lt;span class="nn"&gt;/v1/buckets/servicedenuages_blog/collections/articles&lt;/span&gt; &lt;span class="kr"&gt;HTTP&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="m"&gt;1.1&lt;/span&gt;
&lt;span class="na"&gt;Authorization&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="l"&gt;Bearer 0b9c2625dc21ef05f6ad4ddf47c5f203837aa32ca42fced54c2625dc21efac32&lt;/span&gt;
&lt;span class="na"&gt;Accept&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="l"&gt;application/json&lt;/span&gt;

{
    "permissions": {
        "read": ["+system.Everyone"]
    }
}

HTTP/1.1 201 Created
Content-Type: application/json; charset=utf-8

{
    "id": "servicedenuages_blog",
    "permissions": {
        "write": ["fxa:49d02d55ad10973b7b9d0dc9eba7fdf0"],
        "read": ["system.Everyone"]
    }
}
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Pour le &lt;tt class="docutils literal"&gt;PATCH&lt;/tt&gt; nous utilisons la syntaxe préfixée par un &lt;tt class="docutils literal"&gt;+&lt;/tt&gt; ou
par un &lt;tt class="docutils literal"&gt;-&lt;/tt&gt; pour ajouter ou enlever des &lt;em&gt;principals&lt;/em&gt; sur un ACL.&lt;/p&gt;
&lt;p&gt;Il est également possible de faire un &lt;tt class="docutils literal"&gt;PUT&lt;/tt&gt; pour réinitialiser les ACLs,
sachant que le &lt;tt class="docutils literal"&gt;PUT&lt;/tt&gt; va ajouter l'utilisateur courant à la
liste automatiquement mais qu'il pourra se retirer avec un &lt;tt class="docutils literal"&gt;PATCH&lt;/tt&gt;.
Ajouter l'utilisateur courant permet d'éviter les situations où plus
personne n'a accès aux données.&lt;/p&gt;
&lt;div class="note"&gt;
&lt;p class="first admonition-title"&gt;Note&lt;/p&gt;
&lt;p class="last"&gt;La permission &lt;tt class="docutils literal"&gt;create&lt;/tt&gt; est valable pour &lt;tt class="docutils literal"&gt;POST&lt;/tt&gt; mais aussi pour &lt;tt class="docutils literal"&gt;PUT&lt;/tt&gt;
lorsque l'enregistrement n'existe pas.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="le-cas-specifique-des-donnees-utilisateurs"&gt;
&lt;h3&gt;Le cas spécifique des données utilisateurs&lt;/h3&gt;
&lt;p&gt;Une des fonctionnalités actuelles de &lt;em&gt;Kinto&lt;/em&gt; est de pouvoir gérer des
collections d'enregistrements par utilisateur.&lt;/p&gt;
&lt;p&gt;Sous &lt;em&gt;*nix&lt;/em&gt; il est possible, pour une
application, de sauvegarder la configuration de l'utilisateur courant
dans son dossier personnel sans se soucier de l'emplacement sur
le disque en utilisant &lt;tt class="docutils literal"&gt;~/&lt;/tt&gt;.&lt;/p&gt;
&lt;p&gt;Dans notre cas si une application souhaite sauvegarder les contacts d'un
utilisateur, elle peut utiliser le raccourci &lt;tt class="docutils literal"&gt;~&lt;/tt&gt; pour faire référence au
&lt;em&gt;bucket&lt;/em&gt; &lt;strong&gt;personnel&lt;/strong&gt; de l'utilisateur : &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;/buckets/~/collections/contacts&lt;/span&gt;&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Cette URL retournera le code &lt;tt class="docutils literal"&gt;HTTP 307&lt;/tt&gt; vers le &lt;em&gt;bucket&lt;/em&gt; de l'utilisateur courant :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nf"&gt;POST&lt;/span&gt; &lt;span class="nn"&gt;/v1/buckets/~/collections/contacts/records&lt;/span&gt; &lt;span class="kr"&gt;HTTP&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="m"&gt;1.1&lt;/span&gt;

{
   "name": "Rémy",
   "emails": ["remy@example.com"],
   "phones": ["+330820800800"]
}

HTTP/1.1 307 Temporary Redirect
Location: /v1/buckets/fxa:49d02d55ad10973b7b9d0dc9eba7fdf0/collections/contacts/records
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Ainsi il est tout à fait possible à Alice de partager ses contacts
avec Bob. Il lui suffit pour cela de donner la permission &lt;tt class="docutils literal"&gt;read&lt;/tt&gt; à
Bob sur sa collection et de donner l'URL complète
&lt;tt class="docutils literal"&gt;/v1/buckets/fxa:49d02d55ad10973b7b9d0dc9eba7fdf0/collections/contacts/records&lt;/tt&gt;
à Bob.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="la-delegation-des-permissions"&gt;
&lt;h3&gt;La délégation des permissions&lt;/h3&gt;
&lt;p&gt;Dans le cas de &lt;em&gt;Kinto&lt;/em&gt;, nous avons défini un format pour restreindre les
permissions via les scopes OAuth2:
&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;storage:&amp;lt;bucket_id&amp;gt;:&amp;lt;collection_id&amp;gt;:&amp;lt;permissions_list&amp;gt;&lt;/span&gt;&lt;/tt&gt;.&lt;/p&gt;
&lt;p&gt;Ainsi, si on reprend l'exemple précédent de la liste de tâches, il est possible pour
Bob de créer un token OAuth spécifique avec les &lt;em&gt;scopes&lt;/em&gt; suivants :
&lt;tt class="docutils literal"&gt;profile storage:todolist:tasks:write &lt;span class="pre"&gt;storage:~:contacts:read+records:create&lt;/span&gt;&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Donc, bien que Bob a la permission &lt;tt class="docutils literal"&gt;write&lt;/tt&gt; sur ses contacts,
l'application utilisant ce token pourra uniquement lire les contacts
existants et en ajouter de nouveaux.&lt;/p&gt;
&lt;p&gt;Une partie de la complexité est donc de réussir à présenter ces &lt;em&gt;scopes&lt;/em&gt; de
manière lisible à l'utilisateur, afin qu'il choisisse quelles permissions
donner aux applications qui agissent en son nom.&lt;/p&gt;
&lt;p&gt;Voilà où nous en sommes de notre réflexion !&lt;/p&gt;
&lt;p&gt;Si vous avez des choses à ajouter, des points de désaccord ou autres
réflexions, n'hésitez pas à nous interrompre pendant qu'il est encore temps !&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
</summary><category term="mozilla"></category></entry><entry><title>Retours des APIdays Barcelona</title><link href="http://www.servicedenuages.fr/apidays-barcelona-retours" rel="alternate"></link><published>2015-05-11T00:00:00+02:00</published><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2015-05-11:apidays-barcelona-retours</id><summary type="html">&lt;p&gt;Cette journée aux APIDays Barcelona a été d'une rare richesse ! Pour commencer, bravo à toute l'équipe et
tous les participants !&lt;/p&gt;
&lt;div class="figure align-center" style="width: 1024px; height: auto; max-width: 100%;"&gt;
&lt;img alt="@thetonyblank — https://twitter.com/thetonyblank/status/595860394561921025" src="http://www.servicedenuages.fr/images/apidays-room.jpg" style="width: 1024px; height: auto; max-width: 100%;"/&gt;
&lt;/div&gt;
&lt;p&gt;Je vais tenter de faire un retour le plus complet possible, en restant un minimum concis :) S'il y a
des points obscurs, «&lt;em&gt;lache tes coms&lt;/em&gt;» &lt;a class="footnote-reference" href="#id3" id="id1"&gt;[1]&lt;/a&gt;  !&lt;/p&gt;
&lt;div class="section" id="l-evenement"&gt;
&lt;h2&gt;L'évènement&lt;/h2&gt;
&lt;p&gt;&lt;a class="reference external" href="http://mediterranea.apidays.io/"&gt;APIdays&lt;/a&gt; est un évènement qui a lieu dans plusieurs villes,
et par chance aussi à Barcelone.&lt;/p&gt;
&lt;p&gt;Naïvement, je n'aurais jamais pensé qu'il puisse exister une communauté aussi forte autour des APIs !
Je découvre donc une nouvelle famille de passionnés, pluri-disciplinaire et agnostique \o/.
Des nouveaux métiers et des participants de tous horizons, de la grosse multinationale aux obédiences XML/Java à la startup
hype en passant par des indépendants de toute sorte !&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="l-affordance"&gt;
&lt;h2&gt;L'affordance&lt;/h2&gt;
&lt;p&gt;L'affordance, formulé par Don Norman, est un concept assez connu en ergonomie. Cela définit
la capacité d'un objet à transmettre ses fonctionnalités via son apparence. Pensez aux poignées
de porte, selon leur forme on sait si on doit tourner, tirer ou pousser.&lt;/p&gt;
&lt;p&gt;&lt;a class="reference external" href="https://twitter.com/mamund"&gt;Mike Amundsen&lt;/a&gt; ouvrait la journée en étendant le concept aux APIs.
Une API, et l'apparence des informations présentées, doit suggérer ce qu'on peut faire avec.&lt;/p&gt;
&lt;p&gt;Il a rappelé cependant que les meilleurs designs étaient ceux qui permettaient de faire des
choses choses auxquelles les auteurs n'avaient pas pensé.&lt;/p&gt;
&lt;blockquote class="epigraph"&gt;
&lt;p&gt;A good API is hard to misuse.&lt;/p&gt;
&lt;p class="attribution"&gt;—&lt;a class="reference external" href="https://twitter.com/orliesaurus"&gt;Orlando Kalossakas&lt;/a&gt;, plus tard dans la journée.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/div&gt;
&lt;div class="section" id="hypermedia"&gt;
&lt;h2&gt;Hypermedia&lt;/h2&gt;
&lt;p&gt;Plusieurs fois dans la journée, les évangélistes et fins prédicateurs ont expliqué que le
monde des APIs était là où était le Web il y 15 ans. On a dépassé le stade d'utiliser
&lt;tt class="docutils literal"&gt;GET /action=create&lt;/tt&gt; et REST est bien implanté, mais l'accessibilité des APIs, leur
fédération, leur utilisation transparente ou leur caractère inter-changeable semble encore loin.&lt;/p&gt;
&lt;p&gt;Les APIs manquent de liens.&lt;/p&gt;
&lt;blockquote class="epigraph"&gt;
&lt;p&gt;Hypermedia is just like hypertext but not limited to...text!&lt;/p&gt;
&lt;p class="attribution"&gt;—&lt;a class="reference external" href="https://twitter.com/gssor"&gt;Ross Garett&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Le Web était initialement pensé comme une gigantesque base de données distribuée et
exploitable sans préconfiguration. Sur le tard, il y a eu diverses initiatives,
comme le Web sémantique, avec les &lt;a class="reference external" href="http://fr.wikipedia.org/wiki/Ontologie_%28informatique%29"&gt;graphes d'ontologie&lt;/a&gt;, &lt;a class="reference external" href="http://fr.wikipedia.org/wiki/Resource_Description_Framework"&gt;RDF&lt;/a&gt; ou les micro-formats. On devrait pouvoir dire
aujourd'hui que c'est un échec, car cela n'a pas été adopté partout.&lt;/p&gt;
&lt;p&gt;Mais, mais... il y a encore de l'espoir avec les APIs :) &lt;a class="footnote-reference" href="#id4" id="id2"&gt;[2]&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="conventions"&gt;
&lt;h2&gt;Conventions&lt;/h2&gt;
&lt;p&gt;En contrebas du Web ou des APIs sémantiques, il y a l'approche qui consiste à mettre au point des
conventions simples.&lt;/p&gt;
&lt;p&gt;&lt;a class="reference external" href="https://twitter.com/steveklabnik"&gt;Steve Klabnik&lt;/a&gt; qui a une culture Ruby a fait le parallèle
avec les frameworks Web et l'approche «&lt;em&gt;Convention over configuration&lt;/em&gt;».&lt;/p&gt;
&lt;div class="figure align-center" style="width: 1023px; height: auto; max-width: 100%;"&gt;
&lt;img alt="https://twitter.com/apidaysMedit/status/595883679500623872" src="http://www.servicedenuages.fr/images/apidays-steve-klabnik.jpg" style="width: 1023px; height: auto; max-width: 100%;"/&gt;
&lt;/div&gt;
&lt;p&gt;C'est le cas de la &lt;a class="reference external" href="http://jsonapi.org/"&gt;spécification JSON-API&lt;/a&gt;, qui ne cherche pas à aborder
les concepts de sémantique mais simplement d'économiser aux développeurs de débattre des
&lt;a class="reference external" href="http://fr.wikipedia.org/wiki/Loi_de_futilit%C3%A9_de_Parkinson"&gt;choix inutiles&lt;/a&gt;.&lt;/p&gt;
&lt;blockquote class="epigraph"&gt;
&lt;p&gt;I looked in Google Images to find pictures of bikesheds and found that.
I thought «that's not a bikeshed». OMG, I was actually bikeshedding about bikesheds!&lt;/p&gt;
&lt;p class="attribution"&gt;—Steve&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Par la même occasion, l'idée est de faciliter l'implémentation des clients, et &lt;a class="reference external" href="https://github.com/emberjs/data"&gt;le composant data Ember.js&lt;/a&gt;
supportera la spec dans la prochaine release.&lt;/p&gt;
&lt;p&gt;Nos intentions pour &lt;a class="reference external" href="http://cliquet.readthedocs.io/en/latest/rationale.html#philosophy"&gt;Cliquet&lt;/a&gt; sont exactement celles-ci. Nous
allons donc &lt;a class="reference external" href="https://github.com/mozilla-services/cliquet/issues/254"&gt;probablement converger&lt;/a&gt;. D'autant
que les specs sont très proches.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="documentation-d-api"&gt;
&lt;h2&gt;Documentation d'API&lt;/h2&gt;
&lt;p&gt;J'ai pu assister à une &lt;a class="reference external" href="https://speakerdeck.com/l0ck3/beyond-docs-lessons-learned-rebuilding-the-paymill-documentation"&gt;excellente présentation&lt;/a&gt;
de &lt;a class="reference external" href="https://twitter.com/yannirbah"&gt;Yann Irbah&lt;/a&gt;,
qui résumait les bonnes pratiques pour documenter une API sous forme de produit.&lt;/p&gt;
&lt;p&gt;Les points importants:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Exposer la valeur ajoutée du produit : Pourquoi est-ce qu'il simplifie la vie ?&lt;/li&gt;
&lt;li&gt;Documenter les premiers pas jusqu'à l'utilisation avancée ;&lt;/li&gt;
&lt;li&gt;Ne pas se contenter du «&lt;em&gt;hello world&lt;/em&gt;» ;&lt;/li&gt;
&lt;li&gt;Écrire des tutoriaux pour chacun des cas d'utilisation ;&lt;/li&gt;
&lt;li&gt;Les développeurs constituent un excellent vecteur marketting ;&lt;/li&gt;
&lt;li&gt;Aider à avoir confiance en l'outil ;&lt;/li&gt;
&lt;li&gt;Proposer une documentation avec des end-points interactifs ;&lt;/li&gt;
&lt;li&gt;Mettre à jour en continu.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a class="reference external" href="http://swagger.io/"&gt;Swagger&lt;/a&gt; et &lt;a class="reference external" href="https://github.com/tripit/slate"&gt;Slate&lt;/a&gt; ont le vent en poupe.&lt;/p&gt;
&lt;p&gt;Il est possible d'aller très très loin, avec des outils qui mettent à jour les snippets
de la doc quand l'API change par exemple...&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="annuaire-d-api"&gt;
&lt;h2&gt;Annuaire d'API&lt;/h2&gt;
&lt;p&gt;La dernière conférence de la journée était celle de &lt;a class="reference external" href="https://twitter.com/kinlane"&gt;Kin Lane&lt;/a&gt; sur
les cycles de vie des APIs.&lt;/p&gt;
&lt;p&gt;Il a présenté &lt;a class="reference external" href="http://apis.io"&gt;http://apis.io&lt;/a&gt;, un annuaire d'APIs.&lt;/p&gt;
&lt;p&gt;L'idée consiste à écrire un fichier &lt;a class="reference external" href="http://apisjson.org/"&gt;apis.json&lt;/a&gt;, un peu l'équivalent
des &lt;em&gt;sitemaps&lt;/em&gt;, mais pour les APIs.&lt;/p&gt;
&lt;p&gt;Celui-ci va décrire les end-points (en référençant un fichier &lt;a class="reference external" href="http://swagger.io/"&gt;Swagger&lt;/a&gt; par exemple) et ajouter des
métadonnées (description, tags, version, blog URI, licence, ...).&lt;/p&gt;
&lt;p&gt;Cela n'a pas seulement pour objectif de construire un annuaire global ! Cela peut être un
annuaire local à l'infrastructure que les (micro)services interrogent, plutôt que reposer
sur une configuration en dur (a.k.a &lt;a class="reference external" href="http://jasonwilder.com/blog/2014/02/04/service-discovery-in-the-cloud/"&gt;Service discovery&lt;/a&gt;).&lt;/p&gt;
&lt;p&gt;À terme, on pourrait aussi imaginer que tous les appareils de la maison qui disposent
d'une API viennent s'enregistrer sur le routeur ADSL du domicile !
Ainsi en un seul coup d'oeil on pourrait avoir accès à leur documentation et les bidouiller !
Voire même que les appareils se détectent et se connectent entre eux automatiquement
si leurs APIs respectives suivent des normes/standards.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="discussions"&gt;
&lt;h2&gt;Discussions&lt;/h2&gt;
&lt;p&gt;Cette journée a été l'occasion de faire des rencontres ! Tout d'abord, ce fût un grand
plaisir de retrouver Silvia, qui a été &lt;a class="reference external" href="https://github.com/mozilla-services/cliquet/pull/120"&gt;la première à contribuer sur Cliquet&lt;/a&gt; !&lt;/p&gt;
&lt;div class="section" id="loosely-coupled"&gt;
&lt;h3&gt;« Loosely coupled »&lt;/h3&gt;
&lt;p&gt;De nombreux participants semblaient nous rejoindre sur l'idée qu'une solution à
un problème ne doit pas être pas liée à une implémentation (ex. &lt;em&gt;CouchDB&lt;/em&gt;).&lt;/p&gt;
&lt;p&gt;Il semblerait que les grandes idées passent aujourd'hui d'abord par la définition d'un protocole,
puis seulement ensuite par la proposition d'implémentations de référence (e.g. &lt;a class="reference external" href="http://matrix.org"&gt;http://matrix.org&lt;/a&gt;, &lt;a class="reference external" href="http://wamp.ws/"&gt;http://wamp.ws/&lt;/a&gt;).&lt;/p&gt;
&lt;p&gt;C'est une condition nécessaire pour que les services soient «&lt;em&gt;faiblement liés&lt;/em&gt;», simples et interchangeables.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="kinto-est-pertinent"&gt;
&lt;h3&gt;Kinto est pertinent&lt;/h3&gt;
&lt;p&gt;En échangeant, j'ai pu confirmer que ce que nous essayons de faire avec &lt;a class="reference external" href="http://kinto.readthedocs.io/"&gt;Kinto&lt;/a&gt; a du sens.
La plupart ont résumé en disant «&lt;em&gt;Oh, un [Parse|Kinvey|Firebase] open-source !&lt;/em&gt;». Nous aurons
l'occasion d'en reparler, et restons modestes...&lt;/p&gt;
&lt;p&gt;Même les gens de &lt;a class="reference external" href="http://www.typeform.com/"&gt;Typeform&lt;/a&gt;, une startup barcelonaise qui fait une alternative
à Google Forms, ont manifesté son intérêt pour ce genre de solution !&lt;/p&gt;
&lt;p&gt;L'idée qu'on expérimente autour des permissions et des rôles avec OAuth2
paraissait séduire :) Après un très bref échange avec &lt;a class="reference external" href="https://twitter.com/medjawii"&gt;Medhi&lt;/a&gt; fondateur
de &lt;a class="reference external" href="https://oauth.io"&gt;OAuth.io&lt;/a&gt;, il semblerait que les scopes OAuth2 ne suffisent pas pour
faire ce qu'on veut.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="mashape-kong"&gt;
&lt;h3&gt;Mashape Kong&lt;/h3&gt;
&lt;p&gt;Les gens de Mashape m'ont sauté dessus «&lt;em&gt;Oh Mathieu !&lt;/em&gt;». Ça fait drôle ! ... c'était juste
grâce à &lt;a class="reference external" href="https://twitter.com/leplatrem/status/594238272177577984"&gt;ce tweet sur Kong&lt;/a&gt; :]&lt;/p&gt;
&lt;p&gt;Ils n'ont pas lâché le mode gros délire, et on a bien papotté, notamment de
&lt;a class="reference external" href="https://github.com/mozilla/videur"&gt;videur&lt;/a&gt;, qu'ils ne connaissaient pas. Ils semblaient
bien intéressés par la partie &lt;em&gt;validation de RFC / specs&lt;/em&gt; et devraient revenir
vers nous :)&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="boite-a-outils"&gt;
&lt;h2&gt;Boite à outils&lt;/h2&gt;
&lt;p&gt;Gestion&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;a class="reference external" href="http://getkong.org"&gt;http://getkong.org&lt;/a&gt; — API middleware&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://www.apitools.com"&gt;https://www.apitools.com&lt;/a&gt; — API middleware&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://www.mashape.com"&gt;https://www.mashape.com&lt;/a&gt; — Market place pour APIs&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Documentation&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;a class="reference external" href="https://docpad.org"&gt;https://docpad.org&lt;/a&gt; — générateur de sites statiques ;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://apiblueprint.org"&gt;https://apiblueprint.org&lt;/a&gt; — comme Swagger mais en markdown ;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="http://raml.org"&gt;http://raml.org&lt;/a&gt; — RESTful API Modeling Language ;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="http://readme.io"&gt;http://readme.io&lt;/a&gt; — Service de documentation&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://gelato.io"&gt;https://gelato.io&lt;/a&gt; — Documentations techniques jolies&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://apiembed.com"&gt;https://apiembed.com&lt;/a&gt; — Snippets de requetes API&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Studio / Mock / SDK&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;a class="reference external" href="https://apiary.io"&gt;https://apiary.io&lt;/a&gt; ­— Studio&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://www.mocaroni.com"&gt;https://www.mocaroni.com&lt;/a&gt; — Studio/Mock&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="http://mockbin.org"&gt;http://mockbin.org&lt;/a&gt; — Créer des mock d'API&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="http://restunited.com"&gt;http://restunited.com&lt;/a&gt; — Génération de SDK&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://apimatic.io"&gt;https://apimatic.io&lt;/a&gt; — Génération de SDK&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://www.getpostman.com"&gt;https://www.getpostman.com&lt;/a&gt; — Extension Chrome pour REST&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Divers&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;a class="reference external" href="http://management.apievangelist.com/building-blocks.html"&gt;API building blocks&lt;/a&gt; par Kin Lane&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://github.com/cjbarber/ToolsOfTheTrade"&gt;https://github.com/cjbarber/ToolsOfTheTrade&lt;/a&gt; — Services en ligne utiles&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://github.com/oauth-io/oauthd"&gt;OAuthd&lt;/a&gt; — Le daemon de OAuth.io&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="http://loader.io"&gt;http://loader.io&lt;/a&gt; — Load testing service&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://divshot.com"&gt;https://divshot.com&lt;/a&gt; — Hébergement de fichiers statiques&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="http://schemaform.io"&gt;http://schemaform.io&lt;/a&gt; — Angular + JSON Schema&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://github.com/mgonto/restangular"&gt;restangular&lt;/a&gt; — REST + Angular&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="http://sailsjs.org"&gt;http://sailsjs.org&lt;/a&gt; — Framework NodeJS&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="section" id="conclusion"&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;Les APIs sont partout. Toutes les entreprises ont des APIs. Les APIs sont les
blocs avec lesquels les développeurs construiront les applications du futur.&lt;/p&gt;
&lt;img alt="@paulsbruce — https://twitter.com/paulsbruce/status/596347015283548161" src="http://www.servicedenuages.fr/images/apidays-thanks-staff.jpg" style="width: 1024px; height: auto; max-width: 100%;"/&gt;
&lt;p&gt;Merci à toutes et tous ceux qui ont participé de près ou de loin à l'organisation
de cet évènement fédérateur.&lt;/p&gt;
&lt;p&gt;Je vous conseille de guetter les futures dates dans les différentes villes du monde !&lt;/p&gt;
&lt;p&gt;&lt;a class="reference external" href="http://www.apidays.io"&gt;http://www.apidays.io&lt;/a&gt;&lt;/p&gt;
&lt;table class="docutils footnote" frame="void" id="id3" rules="none"&gt;
&lt;colgroup&gt;&lt;col class="label"&gt;&lt;/col&gt;&lt;col&gt;&lt;/col&gt;&lt;/colgroup&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td class="label"&gt;&lt;a class="fn-backref" href="#id1"&gt;[1]&lt;/a&gt;&lt;/td&gt;&lt;td&gt;Bon courage à celui qui tentera de traduire ça &lt;a class="reference external" href="http://blog.notmyidea.org/language.html"&gt;tiens&lt;/a&gt; !&lt;/td&gt;&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;table class="docutils footnote" frame="void" id="id4" rules="none"&gt;
&lt;colgroup&gt;&lt;col class="label"&gt;&lt;/col&gt;&lt;col&gt;&lt;/col&gt;&lt;/colgroup&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td class="label"&gt;&lt;a class="fn-backref" href="#id2"&gt;[2]&lt;/a&gt;&lt;/td&gt;&lt;td&gt;&lt;a class="reference external" href="http://sookocheff.com/posts/2014-03-11-on-choosing-a-hypermedia-format/"&gt;http://sookocheff.com/posts/2014-03-11-on-choosing-a-hypermedia-format/&lt;/a&gt; (gist: &lt;a class="reference external" href="https://gist.github.com/soofaloofa/9350847"&gt;https://gist.github.com/soofaloofa/9350847&lt;/a&gt;)&lt;/td&gt;&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
</summary><category term="mozilla"></category></entry><entry><title>Utiliser les continuation tokens pour sa pagination</title><link href="http://www.servicedenuages.fr/pagination-continuation-token" rel="alternate"></link><published>2015-05-04T00:00:00+02:00</published><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2015-05-04:pagination-continuation-token</id><summary type="html">&lt;p&gt;Si vous êtes là, c'est que quelqu'un a dû vous le dire : Paginer sur des
grosses tables avec LIMIT et OFFSET ne monte pas en charge : plus
on avance dans les pages, plus c'est lent.&lt;/p&gt;
&lt;p&gt;C'est dommage parce que c'était facile à appréhender ! La limite donne
le nombre d'éléments affichés et le décalage est calculé en fonction
de la page en cours !&lt;/p&gt;
&lt;p&gt;Il y a même une initiative "&lt;a class="reference external" href="http://use-the-index-luke.com/no-offset"&gt;STOP OFFSET&lt;/a&gt;" pour que les développeurs y
pensent.&lt;/p&gt;
&lt;p&gt;Sur ce site, la solution évoquée consiste à mettre en place une keyset
pagination, ou seek method. Autrement dit une pagination à base de
filtrage.&lt;/p&gt;
&lt;p&gt;L'idée générale consiste à remplacer les &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;?page=3&amp;amp;size=10&lt;/span&gt;&lt;/tt&gt; de vos URLs
par un ensemble de critères de filtrage sur la table qui réduiront les
résultats obtenus à ceux attendus sur la page en cours.&lt;/p&gt;
&lt;p&gt;C'est le serveur qui va construire les requêtes de filtrages
nécessaires à la pagination à partir d'informations sur le dernier
élément affiché. Ces informations sont appelées &lt;strong&gt;continuation
token&lt;/strong&gt; car elles permettent au serveur de savoir d'où il doit
reprendre pour continuer à afficher les résultats.&lt;/p&gt;
&lt;div class="section" id="pourquoi-c-est-mal-d-utiliser-offset-et-limit"&gt;
&lt;h2&gt;Pourquoi c'est mal d'utiliser OFFSET et LIMIT ?&lt;/h2&gt;
&lt;p&gt;Le site ci-dessus l'explique mieux que moi, mais ce qu'il faut retenir
c'est que la base de données doit faire la requête entière pour
ensuite aller se déplacer jusqu'à la bonne ligne.&lt;/p&gt;
&lt;p&gt;Si pendant que vous changez de page quelqu'un modifie la collection
vous pouvez aussi louper des entrées ou avoir des doublons dans les
résultats. Cela rend la liste des résultats incohérente entre deux
affichages.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="comment-faire-pour-s-en-passer"&gt;
&lt;h2&gt;Comment faire pour s'en passer ?&lt;/h2&gt;
&lt;p&gt;Pour bien comprendre, prenons le cas le plus simple.&lt;/p&gt;
&lt;p&gt;Si vous triez par &lt;tt class="docutils literal"&gt;id&lt;/tt&gt; (la clé primaire), il vous suffit de garder
trace du dernier &lt;tt class="docutils literal"&gt;id&lt;/tt&gt; de la page précédente.&lt;/p&gt;
&lt;p&gt;Prenons comme exemple la table de salariés suivante.
Pour les besoins de l'exercice la date de recrutement est unique.
Les données sont inexactes mais plausibles.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;CREATE&lt;/span&gt; &lt;span class="k"&gt;TABLE&lt;/span&gt; &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;salaries&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;
  &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt; &lt;span class="nb"&gt;int&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;NOT&lt;/span&gt; &lt;span class="k"&gt;NULL&lt;/span&gt; &lt;span class="n"&gt;AUTO_INCREMENT&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;nom&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt; &lt;span class="nb"&gt;text&lt;/span&gt; &lt;span class="k"&gt;NOT&lt;/span&gt; &lt;span class="k"&gt;NULL&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;societe&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt; &lt;span class="nb"&gt;text&lt;/span&gt; &lt;span class="k"&gt;NOT&lt;/span&gt; &lt;span class="k"&gt;NULL&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;date_embauche&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt; &lt;span class="nb"&gt;date&lt;/span&gt; &lt;span class="k"&gt;NOT&lt;/span&gt; &lt;span class="k"&gt;NULL&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="k"&gt;PRIMARY&lt;/span&gt; &lt;span class="k"&gt;KEY&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
  &lt;span class="k"&gt;UNIQUE&lt;/span&gt; &lt;span class="k"&gt;KEY&lt;/span&gt; &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;date_embauche&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;date_embauche&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="n"&gt;CHARSET&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;utf8&lt;/span&gt; &lt;span class="p"&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;ID&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Nom&lt;/span&gt;      &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Soci&lt;/span&gt;&lt;span class="err"&gt;é&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="err"&gt;é&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="nb"&gt;Date&lt;/span&gt; &lt;span class="n"&gt;de&lt;/span&gt; &lt;span class="n"&gt;recrutement&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Rodolphe&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Novapost&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;2014&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;09&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;03&lt;/span&gt;          &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Tarek&lt;/span&gt;    &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Mozilla&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;2009&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;03&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;01&lt;/span&gt;          &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Benoit&lt;/span&gt;   &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Novapost&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;2012&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;02&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;25&lt;/span&gt;          &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Alexis&lt;/span&gt;   &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Mozilla&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;2012&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;09&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;24&lt;/span&gt;          &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;5&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Bruno&lt;/span&gt;    &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Novapost&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;2013&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;06&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;14&lt;/span&gt;          &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;6&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;R&lt;/span&gt;&lt;span class="err"&gt;é&lt;/span&gt;&lt;span class="n"&gt;my&lt;/span&gt;     &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Mozilla&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;2014&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;03&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;          &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;7&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Mathieu&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Mozilla&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;2014&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;06&lt;/span&gt;          &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;8&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Natal&lt;/span&gt;    &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Novapost&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;2013&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;08&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;05&lt;/span&gt;          &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;9&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Nicolas&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Mozilla&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;2014&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;02&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;27&lt;/span&gt;          &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Pour l'exemple, nous allons également paginer nos
résultats par deux.&lt;/p&gt;
&lt;div class="section" id="voici-les-requetes-que-nous-ferions-en-utilisant-offset-et-limit"&gt;
&lt;h3&gt;Voici les requêtes que nous ferions en utilisant OFFSET et LIMIT&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="k"&gt;FROM&lt;/span&gt; &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;salaries&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;
&lt;span class="k"&gt;ORDER&lt;/span&gt; &lt;span class="k"&gt;BY&lt;/span&gt; &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;
&lt;span class="k"&gt;LIMIT&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;

&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Rodolphe&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Novapost&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;2014&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;09&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;03&lt;/span&gt;          &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Tarek&lt;/span&gt;    &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Mozilla&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;2009&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;03&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;01&lt;/span&gt;          &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;

&lt;span class="k"&gt;SELECT&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="k"&gt;FROM&lt;/span&gt; &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;salaries&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;
&lt;span class="k"&gt;ORDER&lt;/span&gt; &lt;span class="k"&gt;BY&lt;/span&gt; &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;
&lt;span class="k"&gt;LIMIT&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;
&lt;span class="k"&gt;OFFSET&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;

&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Benoit&lt;/span&gt;   &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Novapost&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;2012&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;02&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;25&lt;/span&gt;          &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Alexis&lt;/span&gt;   &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Mozilla&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;2012&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;09&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;24&lt;/span&gt;          &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="comment-peut-on-obtenir-le-meme-resultat-sans-utiliser-offset"&gt;
&lt;h3&gt;Comment peut-on obtenir le même résultat sans utiliser OFFSET ?&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="k"&gt;FROM&lt;/span&gt; &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;salaries&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;
&lt;span class="k"&gt;ORDER&lt;/span&gt; &lt;span class="k"&gt;BY&lt;/span&gt; &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;
&lt;span class="k"&gt;LIMIT&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;

&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Rodolphe&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Novapost&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;2014&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;09&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;03&lt;/span&gt;          &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Tarek&lt;/span&gt;    &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Mozilla&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;2009&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;03&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;01&lt;/span&gt;          &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;

&lt;span class="k"&gt;SELECT&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="k"&gt;FROM&lt;/span&gt; &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;salaries&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;
&lt;span class="k"&gt;WHERE&lt;/span&gt; &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;
&lt;span class="k"&gt;ORDER&lt;/span&gt; &lt;span class="k"&gt;BY&lt;/span&gt; &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;
&lt;span class="k"&gt;LIMIT&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;

&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Benoit&lt;/span&gt;   &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Novapost&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;2012&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;02&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;25&lt;/span&gt;          &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Alexis&lt;/span&gt;   &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Mozilla&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;2012&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;09&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;24&lt;/span&gt;          &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Quand on fait le tri sur une valeur unique pour toute la collection,
on se rend compte que l'on peut sauvegarder la valeur du dernier
élément de la liste et l'utiliser pour faire une condition where.&lt;/p&gt;
&lt;p&gt;Faisons maintenant le tri sur la date d'embauche :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="k"&gt;FROM&lt;/span&gt; &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;salaries&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;
&lt;span class="k"&gt;ORDER&lt;/span&gt; &lt;span class="k"&gt;BY&lt;/span&gt; &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;date_embauche&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;
&lt;span class="k"&gt;LIMIT&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;

&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Tarek&lt;/span&gt;    &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Mozilla&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;2009&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;03&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;01&lt;/span&gt;          &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Benoit&lt;/span&gt;   &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Novapost&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;2012&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;02&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;25&lt;/span&gt;          &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;

&lt;span class="k"&gt;SELECT&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="k"&gt;FROM&lt;/span&gt; &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;salaries&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;
&lt;span class="k"&gt;WHERE&lt;/span&gt; &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;date_embauche&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="s1"&gt;'2012-02-25'&lt;/span&gt;
&lt;span class="k"&gt;ORDER&lt;/span&gt; &lt;span class="k"&gt;BY&lt;/span&gt; &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;date_embauche&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;
&lt;span class="k"&gt;LIMIT&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;

&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Alexis&lt;/span&gt;   &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Mozilla&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;2012&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;09&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;24&lt;/span&gt;          &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;5&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Bruno&lt;/span&gt;    &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Novapost&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;2013&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;06&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;14&lt;/span&gt;          &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;

&lt;span class="k"&gt;SELECT&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="k"&gt;FROM&lt;/span&gt; &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;salaries&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;
&lt;span class="k"&gt;WHERE&lt;/span&gt; &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;date_embauche&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="s1"&gt;'2013-06-14'&lt;/span&gt;
&lt;span class="k"&gt;ORDER&lt;/span&gt; &lt;span class="k"&gt;BY&lt;/span&gt; &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;date_embauche&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;
&lt;span class="k"&gt;LIMIT&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;

&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;8&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Natal&lt;/span&gt;    &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Novapost&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;2013&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;08&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;05&lt;/span&gt;          &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;9&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Nicolas&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Mozilla&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;2014&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;02&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;27&lt;/span&gt;          &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="et-pour-la-page-precedente"&gt;
&lt;h3&gt;Et pour la page précédente ?&lt;/h3&gt;
&lt;p&gt;Soit on se rappelle de la règle de filtrage précédente, soit on peut
ruser en inversant l'ordre de tri puis en selectionnant les résultats
supérieurs au premier élément de la page courante et en affichant les
résultats dans l'ordre inverse :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="k"&gt;FROM&lt;/span&gt; &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;salaries&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;
&lt;span class="k"&gt;WHERE&lt;/span&gt; &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;date_embauche&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="s1"&gt;'2013-08-05'&lt;/span&gt;
&lt;span class="k"&gt;ORDER&lt;/span&gt; &lt;span class="k"&gt;BY&lt;/span&gt; &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;date_embauche&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt; &lt;span class="k"&gt;DESC&lt;/span&gt;
&lt;span class="k"&gt;LIMIT&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;

&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;5&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Bruno&lt;/span&gt;    &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Novapost&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;2013&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;06&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;14&lt;/span&gt;          &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Alexis&lt;/span&gt;   &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Mozilla&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;2012&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;09&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;24&lt;/span&gt;          &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Qu'il faut afficher à l'utilisateur comme cela :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Alexis&lt;/span&gt;   &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Mozilla&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;2012&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;09&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;24&lt;/span&gt;          &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;5&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Bruno&lt;/span&gt;    &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Novapost&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;2013&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;06&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;14&lt;/span&gt;          &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="et-pour-les-tris-sur-des-cles-non-uniques"&gt;
&lt;h2&gt;Et pour les tris sur des clés non uniques ?&lt;/h2&gt;
&lt;p&gt;Dès lors qu'une clé de tri n'est plus unique, contrairement à
&lt;tt class="docutils literal"&gt;date_embauche&lt;/tt&gt; et &lt;tt class="docutils literal"&gt;id&lt;/tt&gt; dans notre exemple, il faut trouver une
requête qui permet d'identifier de manière unique la ligne à partir de
laquelle continuer.&lt;/p&gt;
&lt;p&gt;Prenons la requête suivante :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="k"&gt;FROM&lt;/span&gt; &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;salaries&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;
&lt;span class="k"&gt;ORDER&lt;/span&gt; &lt;span class="k"&gt;BY&lt;/span&gt; &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;societe&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;nom&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;

&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;ID&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Nom&lt;/span&gt;      &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Soci&lt;/span&gt;&lt;span class="err"&gt;é&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="err"&gt;é&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="nb"&gt;Date&lt;/span&gt; &lt;span class="n"&gt;de&lt;/span&gt; &lt;span class="n"&gt;recrutement&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Alexis&lt;/span&gt;   &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Mozilla&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;2012&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;09&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;24&lt;/span&gt;          &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;7&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Mathieu&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Mozilla&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;2014&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;06&lt;/span&gt;          &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;9&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Nicolas&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Mozilla&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;2014&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;02&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;27&lt;/span&gt;          &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;6&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;R&lt;/span&gt;&lt;span class="err"&gt;é&lt;/span&gt;&lt;span class="n"&gt;my&lt;/span&gt;     &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Mozilla&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;2014&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;03&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;          &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Tarek&lt;/span&gt;    &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Mozilla&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;2009&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;03&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;01&lt;/span&gt;          &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Benoit&lt;/span&gt;   &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Novapost&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;2012&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;02&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;25&lt;/span&gt;          &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;5&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Bruno&lt;/span&gt;    &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Novapost&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;2013&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;06&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;14&lt;/span&gt;          &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;8&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Natal&lt;/span&gt;    &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Novapost&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;2013&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;08&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;05&lt;/span&gt;          &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Rodolphe&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Novapost&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;2014&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;09&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;03&lt;/span&gt;          &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Si on souhaite obtenir la deuxième page en utilisant &lt;tt class="docutils literal"&gt;id&lt;/tt&gt; on se rend
compte qu'il y a un souci.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="k"&gt;FROM&lt;/span&gt; &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;salaries&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;
&lt;span class="k"&gt;WHERE&lt;/span&gt; &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;7&lt;/span&gt;
&lt;span class="k"&gt;ORDER&lt;/span&gt; &lt;span class="k"&gt;BY&lt;/span&gt; &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;societe&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;nom&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;

&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;9&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Nicolas&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Mozilla&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;2014&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;02&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;27&lt;/span&gt;          &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;8&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Natal&lt;/span&gt;    &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Novapost&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;2013&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;08&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;05&lt;/span&gt;          &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Or la seconde page attendue est :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;9&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Nicolas&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Mozilla&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;2014&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;02&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;27&lt;/span&gt;          &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;6&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;R&lt;/span&gt;&lt;span class="err"&gt;é&lt;/span&gt;&lt;span class="n"&gt;my&lt;/span&gt;     &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Mozilla&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;2014&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;03&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;          &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;div class="section" id="tri-avec-une-seule-cle-non-unique"&gt;
&lt;h3&gt;Tri avec une seule clé non unique&lt;/h3&gt;
&lt;p&gt;Commençons avec un tri sur une seule colonne non unique &lt;tt class="docutils literal"&gt;societe&lt;/tt&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="k"&gt;FROM&lt;/span&gt; &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;salaries&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;
&lt;span class="k"&gt;ORDER&lt;/span&gt; &lt;span class="k"&gt;BY&lt;/span&gt; &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;societe&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;

&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;ID&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Nom&lt;/span&gt;      &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Soci&lt;/span&gt;&lt;span class="err"&gt;é&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="err"&gt;é&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="nb"&gt;Date&lt;/span&gt; &lt;span class="n"&gt;de&lt;/span&gt; &lt;span class="n"&gt;recrutement&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Tarek&lt;/span&gt;    &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Mozilla&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;2009&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;03&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;01&lt;/span&gt;          &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Alexis&lt;/span&gt;   &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Mozilla&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;2012&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;09&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;24&lt;/span&gt;          &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;6&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;R&lt;/span&gt;&lt;span class="err"&gt;é&lt;/span&gt;&lt;span class="n"&gt;my&lt;/span&gt;     &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Mozilla&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;2014&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;03&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;          &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;7&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Mathieu&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Mozilla&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;2014&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;06&lt;/span&gt;          &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;9&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Nicolas&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Mozilla&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;2014&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;02&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;27&lt;/span&gt;          &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Rodolphe&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Novapost&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;2014&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;09&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;03&lt;/span&gt;          &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Benoit&lt;/span&gt;   &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Novapost&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;2012&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;02&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;25&lt;/span&gt;          &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;5&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Bruno&lt;/span&gt;    &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Novapost&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;2013&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;06&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;14&lt;/span&gt;          &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;8&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Natal&lt;/span&gt;    &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Novapost&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;2013&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;08&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;05&lt;/span&gt;          &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;On se rend compte qu'il s'agit en fait de cette requête :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="k"&gt;FROM&lt;/span&gt; &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;salaries&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;
&lt;span class="k"&gt;ORDER&lt;/span&gt; &lt;span class="k"&gt;BY&lt;/span&gt; &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;societe&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Notre requête pour la page deux est donc :&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Les salariés qui ont un nom de société supérieur à Mozilla &lt;strong&gt;ou&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;Les salariés de Mozilla qui ont un id supérieur à 4&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="k"&gt;FROM&lt;/span&gt; &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;salaries&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;
&lt;span class="k"&gt;WHERE&lt;/span&gt; &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;societe&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="s1"&gt;'Mozilla'&lt;/span&gt;
&lt;span class="k"&gt;OR&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;societe&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;'Mozilla'&lt;/span&gt; &lt;span class="k"&gt;AND&lt;/span&gt; &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;ORDER&lt;/span&gt; &lt;span class="k"&gt;BY&lt;/span&gt; &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;societe&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;
&lt;span class="k"&gt;LIMIT&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;

&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;6&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;R&lt;/span&gt;&lt;span class="err"&gt;é&lt;/span&gt;&lt;span class="n"&gt;my&lt;/span&gt;     &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Mozilla&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;2014&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;03&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;          &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;7&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Mathieu&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Mozilla&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;2014&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;06&lt;/span&gt;          &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;On peut vérifier que le cas limite fonctionne aussi:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="k"&gt;FROM&lt;/span&gt; &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;salaries&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;
&lt;span class="k"&gt;WHERE&lt;/span&gt; &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;societe&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="s1"&gt;'Mozilla'&lt;/span&gt;
&lt;span class="k"&gt;OR&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;societe&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;'Mozilla'&lt;/span&gt; &lt;span class="k"&gt;AND&lt;/span&gt; &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;7&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;ORDER&lt;/span&gt; &lt;span class="k"&gt;BY&lt;/span&gt; &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;societe&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;
&lt;span class="k"&gt;LIMIT&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;

&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;9&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Nicolas&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Mozilla&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;2014&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;02&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;27&lt;/span&gt;          &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Rodolphe&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Novapost&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;2014&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;09&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;03&lt;/span&gt;          &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="tri-sur-de-multiples-cle-non-uniques"&gt;
&lt;h3&gt;Tri sur de multiples clé non uniques&lt;/h3&gt;
&lt;p&gt;Maintenant revenons à notre tri par &lt;tt class="docutils literal"&gt;societe&lt;/tt&gt; et par &lt;tt class="docutils literal"&gt;nom&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Pour atteindre la page deux, on a donc trois ensembles à concaténer:&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Les salariés de &lt;tt class="docutils literal"&gt;Mozilla&lt;/tt&gt; qui s'appellent &lt;tt class="docutils literal"&gt;Mathieu&lt;/tt&gt; et dont l'&lt;tt class="docutils literal"&gt;id&lt;/tt&gt; est supérieur à &lt;tt class="docutils literal"&gt;7&lt;/tt&gt;&lt;/li&gt;
&lt;li&gt;Les salariés de &lt;tt class="docutils literal"&gt;Mozilla&lt;/tt&gt; dont le nom est supérieur à &lt;tt class="docutils literal"&gt;Mathieu&lt;/tt&gt;&lt;/li&gt;
&lt;li&gt;Les salariés dont le nom de société est supérieur à &lt;tt class="docutils literal"&gt;Mozilla&lt;/tt&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="k"&gt;FROM&lt;/span&gt; &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;salaries&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;
&lt;span class="k"&gt;WHERE&lt;/span&gt; &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;societe&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;'Mozilla'&lt;/span&gt; &lt;span class="k"&gt;AND&lt;/span&gt; &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;nom&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;'Mathieu'&lt;/span&gt; &lt;span class="k"&gt;AND&lt;/span&gt; &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;7&lt;/span&gt;
&lt;span class="k"&gt;OR&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;societe&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;'Mozilla'&lt;/span&gt; &lt;span class="k"&gt;AND&lt;/span&gt; &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;nom&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="s1"&gt;'Mathieu'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;OR&lt;/span&gt; &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;societe&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="s1"&gt;'Mozilla'&lt;/span&gt;
&lt;span class="k"&gt;ORDER&lt;/span&gt; &lt;span class="k"&gt;BY&lt;/span&gt; &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;societe&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;nom&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;
&lt;span class="k"&gt;LIMIT&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;

&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;9&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Nicolas&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Mozilla&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;2014&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;02&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;27&lt;/span&gt;          &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;6&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;R&lt;/span&gt;&lt;span class="err"&gt;é&lt;/span&gt;&lt;span class="n"&gt;my&lt;/span&gt;     &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Mozilla&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;2014&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;03&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;          &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;On peut tester notre cas limite en ajoutant&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;10&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Mathieu&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Mozilla&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;2015&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;03&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;22&lt;/span&gt;          &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Et on a bien :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="k"&gt;FROM&lt;/span&gt; &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;salaries&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;
&lt;span class="k"&gt;WHERE&lt;/span&gt; &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;societe&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;'Mozilla'&lt;/span&gt; &lt;span class="k"&gt;AND&lt;/span&gt; &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;nom&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;'Mathieu'&lt;/span&gt; &lt;span class="k"&gt;AND&lt;/span&gt; &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;7&lt;/span&gt;
&lt;span class="k"&gt;OR&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;societe&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;'Mozilla'&lt;/span&gt; &lt;span class="k"&gt;AND&lt;/span&gt; &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;nom&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="s1"&gt;'Mathieu'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;OR&lt;/span&gt; &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;societe&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="s1"&gt;'Mozilla'&lt;/span&gt;
&lt;span class="k"&gt;ORDER&lt;/span&gt; &lt;span class="k"&gt;BY&lt;/span&gt; &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;societe&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;nom&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;
&lt;span class="k"&gt;LIMIT&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;

&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;10&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Mathieu&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Mozilla&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;2015&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;03&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;22&lt;/span&gt;          &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;9&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Nicolas&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Mozilla&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;2014&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;02&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;27&lt;/span&gt;          &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;----+----------+----------+---------------------+&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="generalisation"&gt;
&lt;h2&gt;Généralisation&lt;/h2&gt;
&lt;p&gt;La manière générique que j'ai trouvée pour utiliser un &lt;strong&gt;Continuation
Token&lt;/strong&gt; ou &lt;strong&gt;jeton de continuation&lt;/strong&gt; tout en laissant l'utilisateur
choisir sa requête de tri est de générer le jeton à partir du dernier
élément de la page et des champs de tri.&lt;/p&gt;
&lt;p&gt;En complétant toujours les champs de tri par la clé primaire à la fin.&lt;/p&gt;
&lt;p&gt;Ensuite je génère une fonction récursive qui prend la liste des
champs de tri et la dernière entrée de la page précédente et me
retourne une liste de conditions de tri.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;get_continuation_token_conditions&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;record&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;sorting&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;results&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;None&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="sd"&gt;"""Return the list of conditions for a given record and sorting attributes.&lt;/span&gt;

&lt;span class="sd"&gt;    &amp;gt;&amp;gt;&amp;gt; get_continuation_token_conditions(&lt;/span&gt;
&lt;span class="sd"&gt;    ...     {'id': 7, 'nom': 'Mathieu', 'societe': 'Mozilla'},&lt;/span&gt;
&lt;span class="sd"&gt;    ...     ['societe', 'nom', 'id']&lt;/span&gt;
&lt;span class="sd"&gt;    ... )&lt;/span&gt;
&lt;span class="sd"&gt;    [(('societe', '=', 'Mozilla'), ('nom', '=', 'Mathieu'), ('id', '&amp;gt;', 7)),&lt;/span&gt;
&lt;span class="sd"&gt;     (('societe', '=', 'Mozilla'), ('nom', '&amp;gt;', 'Mathieu')),&lt;/span&gt;
&lt;span class="sd"&gt;     (('societe', '&amp;gt;', 'Mozilla'))]&lt;/span&gt;

&lt;span class="sd"&gt;    &amp;gt;&amp;gt;&amp;gt; get_continuation_token_conditions(&lt;/span&gt;
&lt;span class="sd"&gt;    ...     {'id': 7, 'nom': 'Mathieu', 'societe': 'Mozilla'},&lt;/span&gt;
&lt;span class="sd"&gt;    ...     ['societe', '-nom', 'id']&lt;/span&gt;
&lt;span class="sd"&gt;    ... )&lt;/span&gt;
&lt;span class="sd"&gt;    [(('societe', '=', 'Mozilla'), ('nom', '=', 'Mathieu'), ('id', '&amp;gt;', 7)),&lt;/span&gt;
&lt;span class="sd"&gt;     (('societe', '=', 'Mozilla'), ('nom', '&amp;lt;', 'Mathieu')),&lt;/span&gt;
&lt;span class="sd"&gt;     (('societe', '&amp;gt;', 'Mozilla'))]&lt;/span&gt;

&lt;span class="sd"&gt;    """&lt;/span&gt;

    &lt;span class="n"&gt;result&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[]&lt;/span&gt;
    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;field&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;sorting&lt;/span&gt;&lt;span class="p"&gt;[:&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt;
        &lt;span class="n"&gt;field_name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;field&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;lstrip&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'-'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;append&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="n"&gt;field_name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;'='&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;record&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;field_name&lt;/span&gt;&lt;span class="p"&gt;]))&lt;/span&gt;

    &lt;span class="n"&gt;field&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;sorting&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
    &lt;span class="n"&gt;field_name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;field&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;lstrip&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'-'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;direction&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;'&amp;lt;'&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;field&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s1"&gt;'-'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="s1"&gt;'&amp;gt;'&lt;/span&gt;
    &lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;append&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="n"&gt;field_name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;direction&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;record&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;field_name&lt;/span&gt;&lt;span class="p"&gt;]))&lt;/span&gt;

    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;results&lt;/span&gt; &lt;span class="ow"&gt;is&lt;/span&gt; &lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="bp"&gt;None&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;results&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;append&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;results&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;

    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sorting&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;results&lt;/span&gt;
    &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;get_continuation_token_conditions&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;record&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;sorting&lt;/span&gt;&lt;span class="p"&gt;[:&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;results&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="conclusion"&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;Vous voyez que c'est possible de faire de la pagination à l'aide d'un
&lt;strong&gt;continuation token&lt;/strong&gt; tout en gardant les fonctionnalités de tri.&lt;/p&gt;
&lt;p&gt;L'inconvénient c'est qu'il est impossible de pouvoir sauter à la
dernière page ou à une page donnée, heureusement les utilisateurs sont
maintenant habitués à filtrer les résultats afin d'avoir la réponse
sur la première ou deuxième page et dans le cas où ils souhaitent tous
les résultats, ils regardent les pages dans l'ordre.&lt;/p&gt;
&lt;p&gt;Qui dit conditions de tri dit aussi index et c'est là que bien cadrer
les fonctionnalités de tri autorisées devient intéressant. Est-ce bien
nécessaire de laisser l'utilisateur choisir les champs de tri, ou
peut-on se contenter de ne lui laisser comme choix que le sens du tri
sur des champs prédéfinis ?&lt;/p&gt;
&lt;p&gt;Si votre condition de pagination est fixe, vous allez pouvoir créer
les index nécessaires et optimiser au maximum vos requêtes de pagination.&lt;/p&gt;
&lt;/div&gt;
</summary><category term="mozilla"></category></entry><entry><title>Eco-système et stockage générique</title><link href="http://www.servicedenuages.fr/stockage-generique-ecosysteme" rel="alternate"></link><published>2015-04-30T00:00:00+02:00</published><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2015-04-30:stockage-generique-ecosysteme</id><summary type="html">&lt;p&gt;&lt;strong&gt;tl;dr Nous devons construire un service de suivi de paiements, et nous
hésitons à continuer à nous entêter avec notre propre solution de
stockage/synchronisation.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Comme nous l'écrivions &lt;a class="reference external" href="http://www.servicedenuages.fr/service-de-nuages"&gt;dans l'article précédent&lt;/a&gt;, nous souhaitons construire une
solution de stockage générique. On refait &lt;a class="reference external" href="http://daybed.readthedocs.io"&gt;Daybed&lt;/a&gt;
chez Mozilla !&lt;/p&gt;
&lt;p&gt;Notre objectif est simple: permettre aux développeurs d'application, internes
à Mozilla ou du monde entier, de faire persister et synchroniser facilement des
données associées à un utilisateur.&lt;/p&gt;
&lt;p id="storage-specs"&gt;Les aspects de l'architecture qui nous semblent incontournables:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;La solution doit reposer sur un protocole, et non sur une implémentation ;&lt;/li&gt;
&lt;li&gt;L'auto-hébergement de l'ensemble doit être simplissime ;&lt;/li&gt;
&lt;li&gt;L'authentification doit être &lt;em&gt;pluggable&lt;/em&gt;, voire décentralisée (OAuth2, FxA,
Persona) ;&lt;/li&gt;
&lt;li&gt;Les enregistrements doivent pouvoir être validés par le serveur ;&lt;/li&gt;
&lt;li&gt;Les données doivent pouvoir être stockées dans n'importe quel backend ;&lt;/li&gt;
&lt;li&gt;Un système de permissions doit permettre de protéger des collections, ou de
partager des enregistrements de manière fine ;&lt;/li&gt;
&lt;li&gt;La résolution de conflits doit pouvoir avoir lieu sur le serveur ;&lt;/li&gt;
&lt;li&gt;Le client doit être pensé «&lt;em&gt;offline-first&lt;/em&gt;» ;&lt;/li&gt;
&lt;li&gt;Le client doit pouvoir réconcilier les données simplement ;&lt;/li&gt;
&lt;li&gt;Le client doit pouvoir être utilisé aussi bien dans le navigateur que côté
serveur ;&lt;/li&gt;
&lt;li&gt;Tous les composants se doivent d´être simples et substituables facilement.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;La première question qui nous a été posée fût «&lt;em&gt;Pourquoi vous n'utilisez pas
PouchDB ou Remote Storage ?&lt;/em&gt;»&lt;/p&gt;
&lt;div class="section" id="remote-storage"&gt;
&lt;h2&gt;Remote Storage&lt;/h2&gt;
&lt;p&gt;Remote Storage est un standard ouvert pour du stockage par utilisateur.  &lt;a class="reference external" href="http://tools.ietf.org/html/draft-dejong-remotestorage-04"&gt;La
specification&lt;/a&gt; se
base sur des standards déjà existants et éprouvés:  Webfinger, OAuth 2, CORS et
REST.&lt;/p&gt;
&lt;p&gt;L'API est simple, des &lt;a class="reference external" href="http://blog.cozycloud.cc/news/2014/08/12/when-unhosted-meets-cozy-cloud/"&gt;projets prestigieux l'utilisent&lt;/a&gt;.
Il y a plusieurs &lt;a class="reference external" href="https://github.com/jcoglan/restore"&gt;implémentations&lt;/a&gt; du
serveur, et il existe &lt;a class="reference external" href="https://www.npmjs.com/package/remotestorage-server"&gt;un squelette Node&lt;/a&gt; pour construire un
serveur sur mesure.&lt;/p&gt;
&lt;img alt="Remote Storage widget" class="align-left" src="http://www.servicedenuages.fr/images/remotestorage-widget.png" style="width: 243px; height: auto; max-width: 100%;"/&gt;
&lt;p&gt;Le client &lt;a class="reference external" href="https://github.com/remotestorage/remotestorage.js/"&gt;remoteStorage.js&lt;/a&gt; permet d'intégrer la
solution dans les applications Web.  Il se charge du «store local», du cache,
de la synchronization, et fournit un widget qui permet aux utilisateurs des
applications de choisir le serveur qui recevra les données (via Webfinger).&lt;/p&gt;
&lt;p&gt;&lt;a class="reference external" href="https://github.com/michielbdejong/ludbud"&gt;ludbud&lt;/a&gt;, la version épurée de
&lt;em&gt;remoteStorage.js&lt;/em&gt;, se limite à l'abstraction du stockage distant.  Cela
permettrait à terme, d'avoir une seule bibliothèque pour stocker dans un
serveur &lt;em&gt;remoteStorage&lt;/em&gt;, &lt;em&gt;ownCloud&lt;/em&gt; ou chez les méchants comme &lt;em&gt;Google Drive&lt;/em&gt;
ou &lt;em&gt;Dropbox&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;Au premier abord, la spécification correspond à ce que nous voulons accomplir:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;La philosophie du protocole est saine;&lt;/li&gt;
&lt;li&gt;L'éco-système est bien fichu;&lt;/li&gt;
&lt;li&gt;La vision politique colle: redonner le contrôle des données aux utilisateurs
(voir &lt;a class="reference external" href="http://unhosted.org/"&gt;unhosted&lt;/a&gt;);&lt;/li&gt;
&lt;li&gt;Les choix techniques compatibles avec ce qu'on a commencé (CORS, REST, OAuth 2);&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;En revanche, vis à vis de la manipulation des données, il y a plusieurs
différences avec ce que nous souhaitons faire:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;L'API suit globalement une métaphore «fichiers» (dossier/documents), plutôt
que «données» (collection/enregistrements) ;&lt;/li&gt;
&lt;li&gt;Il n'y a pas de validation des enregistrements selon un schéma (même si
&lt;a class="reference external" href="https://remotestorage.io/doc/code/files/baseclient/types-js.html"&gt;certaines implémentations&lt;/a&gt; du
protocole le font) ;&lt;/li&gt;
&lt;li&gt;Il n'y a pas la possibilité de trier/filtrer les enregistrements selon des attributs ;&lt;/li&gt;
&lt;li&gt;Les permissions &lt;a class="reference external" href="https://groups.google.com/forum/#!topic/unhosted/5_NOGq8BPTo"&gt;se limitent à privé/public&lt;/a&gt; (et
&lt;a class="reference external" href="https://github.com/remotestorage/spec/issues/58#issue-27249452"&gt;l'auteur envisage plutôt un modèle à la Git&lt;/a&gt;) &lt;a class="footnote-reference" href="#id3" id="id1"&gt;[1]&lt;/a&gt; ;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;En résumé, il semblerait que ce que nous souhaitons faire avec le stockage
d'enregistrements validés est complémentaire avec &lt;em&gt;Remote Storage&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;Si des besoins de persistence orientés «fichiers» se présentent, a priori nous aurions tort
de réinventer les solutions apportées par cette spécification. Il y a donc de grandes
chances que nous l´intégrions à terme, et que &lt;em&gt;Remote Storage&lt;/em&gt; devienne une facette
de notre solution.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="pouchdb"&gt;
&lt;h2&gt;PouchDB&lt;/h2&gt;
&lt;p&gt;&lt;a class="reference external" href="http://pouchdb.com/"&gt;PouchDB&lt;/a&gt; est une bibliothèque JavaScript qui permet
de manipuler des enregistrements en local et de les synchroniser vers une base distante.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;db&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nx"&gt;PouchDB&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'dbname'&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

&lt;span class="nx"&gt;db&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;put&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt;
 &lt;span class="nx"&gt;_id&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;'dave@gmail.com'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
 &lt;span class="nx"&gt;name&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;'David'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
 &lt;span class="nx"&gt;age&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;68&lt;/span&gt;
&lt;span class="p"&gt;});&lt;/span&gt;

&lt;span class="nx"&gt;db&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;replicate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;to&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'http://example.com/mydb'&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Le projet a le vent en poupe, bénéficie de nombreux contributeurs,
l'éco-système est très riche et l'adoption par des projets &lt;a class="reference external" href="https://github.com/hoodiehq/wip-hoodie-store-on-pouchdb"&gt;comme Hoodie&lt;/a&gt; ne fait que
confirmer la pertinence de l'outil pour les développeurs frontend.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;PouchDB&lt;/em&gt; gère un « store » local, dont la persistence est abstraite et &lt;a class="reference external" href="http://pouchdb.com/2014/07/25/pouchdb-levels-up.html"&gt;repose
sur&lt;/a&gt; l'API &lt;a class="reference external" href="https://github.com/level/levelup#relationship-to-leveldown"&gt;LevelDown&lt;/a&gt; pour persister
les données dans &lt;a class="reference external" href="https://github.com/Level/levelup/wiki/Modules#storage-back-ends"&gt;n'importe quel backend&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Même si &lt;em&gt;PouchDB&lt;/em&gt; adresse principalement les besoins des applications
«&lt;em&gt;offline-first&lt;/em&gt;», il peut être utilisé aussi bien dans le navigateur que côté
serveur, via Node.&lt;/p&gt;
&lt;div class="section" id="synchronisation"&gt;
&lt;h3&gt;Synchronisation&lt;/h3&gt;
&lt;p&gt;La synchronisation (ou réplication) des données locales s'effectue sur un
&lt;a class="reference external" href="http://couchdb.apache.org/"&gt;CouchDB&lt;/a&gt; distant.&lt;/p&gt;
&lt;p&gt;Le projet &lt;a class="reference external" href="https://github.com/pouchdb/pouchdb-server"&gt;PouchDB Server&lt;/a&gt;
implémente l'API de CouchDB en NodeJS. Comme &lt;em&gt;PouchDB&lt;/em&gt; est utilisé, on obtient
un service qui se comporte comme un &lt;em&gt;CouchDB&lt;/em&gt; mais qui stocke ses données
n'importe où, dans un &lt;em&gt;Redis&lt;/em&gt; ou un &lt;em&gt;PostgreSQL&lt;/em&gt; par exemple.&lt;/p&gt;
&lt;p&gt;La synchronisation est complète. Autrement dit, tous les enregistrements qui
sont sur le serveur se retrouvent synchronisés dans le client. Il est possible
de filtrer les collections synchronisées, mais cela &lt;a class="reference external" href="http://pouchdb.com/2015/04/05/filtered-replication.html"&gt;n'a pas pour objectif de
sécuriser l'accès aux données&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;L'approche recommandée pour cloisonner les données par utilisateur consiste
à créer &lt;a class="reference external" href="https://github.com/nolanlawson/pouchdb-authentication#some-people-can-read-some-docs-some-people-can-write-those-same-docs"&gt;une base de données par utilisateur&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Ce n'est pas forcément un problème, CouchDB &lt;a class="reference external" href="https://mail-archives.apache.org/mod_mbox/couchdb-user/201401.mbox/%3C52CEB873.7080404@ironicdesign.com%3E"&gt;supporte des centaines de milliers
de bases sans sourciller&lt;/a&gt;.
Mais selon les cas d'utilisation, le cloisement n'est pas toujours facile
à déterminer (par rôle, par application, par collection, ...).&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="le-cas-d-utilisation-payments"&gt;
&lt;h2&gt;Le cas d'utilisation « Payments »&lt;/h2&gt;
&lt;img alt="Put Payments Here  -- Before the Internet - CC-NC-SA Katy Silberger https://www.flickr.com/photos/katysilbs/11163812186" src="http://www.servicedenuages.fr/images/put-payments.jpg" style="width: 640px; height: auto; max-width: 100%;"/&gt;
&lt;p&gt;Dans les prochaines semaines, nous devrons mettre sur pied un prototype pour
tracer l'historique des paiements et abonnements d'un utilisateur.&lt;/p&gt;
&lt;p&gt;Le besoin est simple:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;l'application « Payment » enregistre les paiements et abonnements d'un
utilisateur pour une application donnée;&lt;/li&gt;
&lt;li&gt;l'application « Donnée » interroge le service pour vérifier qu'un utilisateur
a payé ou est abonné;&lt;/li&gt;
&lt;li&gt;l'utilisateur interroge le service pour obtenir la liste de tous ses
abonnements.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Seule l'application « Payment » a le droit de créer/modifier/supprimer des
enregistrements, les deux autres ne peuvent que consulter en lecture seule.&lt;/p&gt;
&lt;p&gt;Une application donnée ne peut pas accéder aux paiements des autres
applications, et un utilisateur ne peut pas accéder aux paiements des autres
utilisateurs.&lt;/p&gt;
&lt;div class="section" id="avec-remotestorage"&gt;
&lt;h3&gt;Avec RemoteStorage&lt;/h3&gt;
&lt;img alt="Remote Love - CC-BY-NC Julie https://www.flickr.com/photos/mamajulie2008/2609549461" class="align-center" src="http://www.servicedenuages.fr/images/remote-love.jpg" style="width: 640px; height: auto; max-width: 100%;"/&gt;
&lt;p&gt;Clairement, l'idée de &lt;em&gt;RemoteStorage&lt;/em&gt; est de dissocier l'application executée,
et les données créées par l'utilisateur avec celle-ci.&lt;/p&gt;
&lt;p&gt;Dans notre cas, c'est l'application « Payment » qui manipule des données
concernant un utilisateur. Mais celles-ci ne lui appartiennent pas directement:
certes un utilisateur doit pouvoir les supprimer, surtout pas en créer ou les
modifier!&lt;/p&gt;
&lt;p&gt;La notion de permissions limitée à privé/publique ne suffit pas dans ce cas
précis.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="avec-pouchdb"&gt;
&lt;h3&gt;Avec PouchDB&lt;/h3&gt;
&lt;p&gt;Il va falloir créer une &lt;em&gt;base de données&lt;/em&gt; par utilisateur, afin d'isoler les
enregistrements de façon sécurisée.  Seule l'application « Payment » aura tous
les droits sur les databases.&lt;/p&gt;
&lt;p&gt;Mais cela ne suffit pas.&lt;/p&gt;
&lt;p&gt;Il ne faut pas qu'une application puisse voir les paiements des autres
applications, donc il va aussi falloir recloisonner, et créer une &lt;em&gt;base de
données&lt;/em&gt; par application.&lt;/p&gt;
&lt;p&gt;Quand un utilisateur voudra accéder à l'ensemble de ses paiements, il faudra
agréger les &lt;em&gt;databases&lt;/em&gt; de toutes les applications. Quand l'équipe marketing
voudra faire des statistiques sur l'ensemble des applications, il faudra
agrégér des centaines de milliers de &lt;em&gt;databases&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;Ce qui est fort dommage, puisqu'il est probable que les paiements ou
abonnements d'un utilisateur pour une application se comptent sur les doigts
d'une main. Des centaines de milliers de bases contenant moins de
5 enregistrements ?&lt;/p&gt;
&lt;p&gt;De plus, dans le cas de l'application « Payment », le serveur est implémenté en
Python. Utiliser un wrapper JavaScript comme le fait &lt;a class="reference external" href="https://pythonhosted.org/Python-PouchDB/"&gt;python-pouchdb&lt;/a&gt; cela ne nous fait pas trop rêver.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="un-nouvel-eco-systeme"&gt;
&lt;h2&gt;Un nouvel éco-système ?&lt;/h2&gt;
&lt;img alt="Wagon wheel - CC-BY-NC-SA arbyreed https://www.flickr.com/photos/19779889@N00/16161808220" src="http://www.servicedenuages.fr/images/wagon-wheel.jpg" style="width: 640px; height: auto; max-width: 100%;"/&gt;
&lt;p&gt;Évidemment, quand on voit la richesse des projets &lt;em&gt;PouchDB&lt;/em&gt; et &lt;em&gt;Remote Storage&lt;/em&gt;
et la dynamique de ces communautés, il est légitime d'hésiter avant de
développer une solution alternative.&lt;/p&gt;
&lt;p&gt;Quand nous avons créé le serveur &lt;em&gt;Reading List&lt;/em&gt;, nous l'avons construit avec
&lt;a class="reference external" href="http://cliquet.readthedocs.io/"&gt;Cliquet&lt;/a&gt;, ce fût l'occasion de mettre au
point &lt;a class="reference external" href="http://cliquet.readthedocs.io/en/latest/api/"&gt;un protocole très simple&lt;/a&gt;, fortement inspiré de
&lt;a class="reference external" href="http://en.wikipedia.org/wiki/Firefox_Sync"&gt;Firefox Sync&lt;/a&gt;, pour faire de la
synchronisation d'enregistrements.&lt;/p&gt;
&lt;p&gt;Et si les clients &lt;em&gt;Reading List&lt;/em&gt; ont pu être implémentés en quelques semaines,
que ce soit en JavaScript, Java (Android) et ASM (Add-on Firefox), c'est que le
principe «&lt;em&gt;offline first&lt;/em&gt;» du service est trivial.&lt;/p&gt;
&lt;div class="section" id="les-compromis"&gt;
&lt;h3&gt;Les compromis&lt;/h3&gt;
&lt;p&gt;Évidemment, nous n'avons pas la prétention de concurrencer &lt;em&gt;CouchDB&lt;/em&gt;. Nous faisons plusieurs
concessions:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;De base, les collections d'enregistrements sont cloisonnées par utilisateur;&lt;/li&gt;
&lt;li&gt;Pas d'historique des révisions;&lt;/li&gt;
&lt;li&gt;Pas de diff sur les enregistrements entre révisions;&lt;/li&gt;
&lt;li&gt;De base, pas de résolution de conflit automatique;&lt;/li&gt;
&lt;li&gt;Pas de synchronisation par flux (&lt;em&gt;streams&lt;/em&gt;);&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Jusqu'à preuve du contraire, ces compromis excluent la possibilité
d'implémenter un &lt;a class="reference external" href="https://github.com/pouchdb/pouchdb/blob/master/lib/adapters/http/http.js#L721-L946"&gt;adapter PouchDB&lt;/a&gt;
pour la synchronisation avec le protocole HTTP de &lt;em&gt;Cliquet&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;Dommage puisque capitaliser sur l'expérience client de &lt;em&gt;PouchDB&lt;/em&gt; au niveau
synchro client semble être une très bonne idée.&lt;/p&gt;
&lt;p&gt;En revanche, nous avons plusieurs fonctionnalités intéressantes:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Pas de map-reduce;&lt;/li&gt;
&lt;li&gt;Synchronisation partielle et/ou ordonnée et/ou paginée    ;&lt;/li&gt;
&lt;li&gt;Le client choisit, via des headers, d'écraser la donnée ou de respecter la version du serveur ;&lt;/li&gt;
&lt;li&gt;Un seul serveur à déployer pour N applications ;&lt;/li&gt;
&lt;li&gt;Auto-hébergement simplissime ;&lt;/li&gt;
&lt;li&gt;Le client peut choisir de ne pas utiliser de « store local » du tout ;&lt;/li&gt;
&lt;li&gt;Dans le client JS, la gestion du « store local » sera externalisée (on pense
à &lt;a class="reference external" href="https://github.com/mozilla/localForage"&gt;LocalForage&lt;/a&gt; ou &lt;a class="reference external" href="https://github.com/dfahlander/Dexie.js"&gt;Dexie.js&lt;/a&gt;) ;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Et, on répond au reste des &lt;a class="reference external" href="#storage-specs"&gt;specifications mentionnées au début de l'article&lt;/a&gt; !&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="les-arguments-philosophiques"&gt;
&lt;h3&gt;Les arguments philosophiques&lt;/h3&gt;
&lt;p&gt;Il est &lt;a class="reference external" href="http://en.wikipedia.org/wiki/Law_of_the_instrument"&gt;illusoire de penser qu'on peut tout faire avec un seul outil&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Nous avons d'autres cas d'utilisations dans les cartons qui semblent correspondre au scope de &lt;em&gt;PouchDB&lt;/em&gt;
(&lt;em&gt;pas de notion de permissions ou de partage, environnement JavaScript, ...&lt;/em&gt;). Nous saurons en tirer
profit quand cela s'avèrera pertinent !&lt;/p&gt;
&lt;p&gt;L'éco-système que nous voulons construire tentera de couvrir les cas d'utilisation
qui sont mal adressés par &lt;em&gt;PouchDB&lt;/em&gt;. Il se voudra:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Basé sur notre protocole très simple ;&lt;/li&gt;
&lt;li&gt;Minimaliste et multi-usages (&lt;em&gt;comme la fameuse 2CV&lt;/em&gt;) ;&lt;/li&gt;
&lt;li&gt;Naïf (&lt;em&gt;pas de rocket science&lt;/em&gt;) ;&lt;/li&gt;
&lt;li&gt;Sans magie (&lt;em&gt;explicite et facile à réimplémenter from scratch&lt;/em&gt;) ;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a class="reference external" href="http://cliquet.readthedocs.io/en/latest/rationale.html"&gt;La philosophie et les fonctionnalités du toolkit python Cliquet&lt;/a&gt; seront bien entendu
à l'honneur :)&lt;/p&gt;
&lt;p&gt;Quant à &lt;em&gt;Remote Storage&lt;/em&gt;, dès que le besoin se présentera, nous serons très fier
de rejoindre l'initiative, mais pour l'instant cela nous paraît risqué de démarrer
en tordant la solution.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="les-arguments-pratiques"&gt;
&lt;h3&gt;Les arguments pratiques&lt;/h3&gt;
&lt;p&gt;Avant d'accepter de déployer une solution à base de &lt;em&gt;CouchDB&lt;/em&gt;, les &lt;em&gt;ops&lt;/em&gt; de Mozilla
vont nous demander de leur prouver par A+B que ce n'est pas faisable avec
les stacks qui sont déjà rodées en interne (i.e. MySQL, Redis, PostgreSQL).&lt;/p&gt;
&lt;p&gt;De plus, on doit s'engager sur une pérennité d'au moins 5 ans pour les données.
Avec &lt;em&gt;Cliquet&lt;/em&gt;, en utilisant le backend PostgreSQL, les données sont persistées
à plat dans un &lt;a class="reference external" href="https://github.com/mozilla-services/cliquet/blob/40aa33/cliquet/storage/postgresql/schema.sql#L14-L28"&gt;schéma PostgreSQL tout bête&lt;/a&gt;.
Ce qui ne sera pas le cas d'un adapteur LevelDown qui va manipuler des notions
de révisions éclatées dans un schéma clé-valeur.&lt;/p&gt;
&lt;p&gt;Si nous basons le service sur &lt;em&gt;Cliquet&lt;/em&gt;, comme c'est le cas avec &lt;a class="reference external" href="http://kinto.readthedocs.io"&gt;Kinto&lt;/a&gt;,
tout le travail d'automatisation de la mise en production (&lt;em&gt;monitoring,
builds RPM, Puppet...&lt;/em&gt;) que nous avons fait pour &lt;em&gt;Reading List&lt;/em&gt; est
complètement réutilisable.&lt;/p&gt;
&lt;p&gt;De même, si on repart avec une stack complètement différente, nous allons
devoir recommencer tout le travail de rodage, de profiling et d'optimisation
effectué au premier trimestre.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="les-prochaines-etapes"&gt;
&lt;h2&gt;Les prochaines étapes&lt;/h2&gt;
&lt;p&gt;Et il est encore temps de changer de stratégie :) Nous aimerions avoir un
maximum de retours !  C'est toujours une décision difficile à prendre...
&lt;tt class="docutils literal"&gt;&amp;lt;/appel à troll&amp;gt;&lt;/tt&gt;&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Tordre un éco-système existant vs. constuire sur mesure ;&lt;/li&gt;
&lt;li&gt;Maîtriser l'ensemble vs. s'intégrer ;&lt;/li&gt;
&lt;li&gt;Contribuer vs. refaire ;&lt;/li&gt;
&lt;li&gt;Guider vs. suivre.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Nous avons vraiment l'intention de rejoindre l'initiative &lt;a class="reference external" href="https://nobackend.org/"&gt;no-backend&lt;/a&gt;, et ce premier pas n'exclue pas que nous convergions
à terme ! Peut-être que nous allons finir par rendre notre service compatible
avec &lt;em&gt;Remote Storage&lt;/em&gt;, et peut-être que &lt;em&gt;PouchDB&lt;/em&gt; deviendra plus agnostique
quand au protocole de synchronisation...&lt;/p&gt;
&lt;img alt="XKCD — Standards https://xkcd.com/927/" src="http://www.servicedenuages.fr/images/standards.png" style="width: 500px; height: auto; max-width: 100%;"/&gt;
&lt;p&gt;Utiliser ce nouvel écosystème pour le projet « Payments » va nous permettre de
mettre au point un système de permissions (&lt;em&gt;probablement basé sur les scopes OAuth&lt;/em&gt;) qui
correspond au besoin exprimé. Et nous avons bien l'intention de puiser dans
&lt;a class="reference external" href="http://blog.daybed.io/daybed-revival.html"&gt;notre expérience avec Daybed sur le sujet&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Nous extrairons aussi le code des clients implémentés pour &lt;em&gt;Reading List&lt;/em&gt; afin
de faire un client JavaScript minimaliste.&lt;/p&gt;
&lt;p&gt;En partant dans notre coin, nous prenons plusieurs risques:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;réinventer une roue dont nous n'avons pas connaissance ;&lt;/li&gt;
&lt;li&gt;échouer à faire de l'éco-système &lt;em&gt;Cliquet&lt;/em&gt; un projet communautaire ;&lt;/li&gt;
&lt;li&gt;échouer à positionner &lt;em&gt;Cliquet&lt;/em&gt; dans la niche des cas non couverts par PouchDB :)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Comme &lt;a class="reference external" href="http://pouchdb.com/2015/04/05/filtered-replication.html"&gt;le dit Giovanni Ornaghi&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
Rolling out your set of webservices, push notifications, or background services
might give you more control, but at the same time it will force you to engineer,
write, test, and maintain a whole new ecosystem.&lt;/blockquote&gt;
&lt;p&gt;C'est justement l'éco-système dont est responsable l'équipe &lt;em&gt;Mozilla Cloud Services&lt;/em&gt;!&lt;/p&gt;
&lt;table class="docutils footnote" frame="void" id="id3" rules="none"&gt;
&lt;colgroup&gt;&lt;col class="label"&gt;&lt;/col&gt;&lt;col&gt;&lt;/col&gt;&lt;/colgroup&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td class="label"&gt;&lt;a class="fn-backref" href="#id1"&gt;[1]&lt;/a&gt;&lt;/td&gt;&lt;td&gt;Il existe le &lt;a class="reference external" href="https://sharesome.5apps.com/"&gt;projet Sharesome&lt;/a&gt; qui
permet de partager publiquement des ressources de son &lt;em&gt;remote Storage&lt;/em&gt;.&lt;/td&gt;&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
</summary><category term="mozilla"></category></entry><entry><title>Service de nuages !</title><link href="http://www.servicedenuages.fr/service-de-nuages" rel="alternate"></link><published>2015-04-16T00:00:00+02:00</published><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2015-04-16:service-de-nuages</id><summary type="html">&lt;p&gt;Pas mal de changements depuis le début de l'année pour l'équipe
«cloud-services» francophone!&lt;/p&gt;
&lt;p&gt;Tout d'abord, nouvelle importante, l'équipe s'étoffe avec des profils assez
complémentaires: &lt;a class="reference external" href="https://nicolas.perriault.net/"&gt;n1k0&lt;/a&gt; et &lt;a class="reference external" href="http://mathieu-leplatre.info"&gt;Mathieu&lt;/a&gt; sont venus prêter main forte à &lt;a class="reference external" href="http://ziade.org/"&gt;Tarek&lt;/a&gt;, &lt;a class="reference external" href="http://natim.ionyse.com"&gt;Rémy&lt;/a&gt; et &lt;a class="reference external" href="http://notmyidea.org"&gt;Alexis&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Le début de l'année a vu le lancement de &lt;a class="reference external" href="https://www.mozilla.org/en-US/firefox/hello/"&gt;Firefox Hello&lt;/a&gt; ce qui nous a permis de passer
à l'échelle &lt;a class="reference external" href="https://github.com/mozilla-services/loop-server"&gt;le serveur&lt;/a&gt;,
écrit en Node.js®, pour l'occasion.&lt;/p&gt;
&lt;div class="section" id="un-serveur-de-listes-de-lecture"&gt;
&lt;h2&gt;Un serveur de listes de lecture&lt;/h2&gt;
&lt;p&gt;En parallèle, un projet de &lt;a class="reference external" href="https://readinglist.readthedocs.io"&gt;synchronisation de liste de lecture&lt;/a&gt; (&lt;em&gt;Reading List&lt;/em&gt;) a vu le jour.  L'idée
étant de pouvoir marquer des pages "à lire pour plus tard" et de continuer la
lecture sur n'importe quel périphérique synchronisé (Firefox pour Android ou
Firefox Desktop). Un équivalent libre à &lt;a class="reference external" href="http://getpocket.com"&gt;Pocket&lt;/a&gt; en quelque sorte, qu'il est
possible d'héberger soit-même.&lt;/p&gt;
&lt;img alt="Capture d'écran de Firefox nightly avec readinglist." src="http://www.servicedenuages.fr/images/readinglist-screenshot.png" style="width: 953px; height: auto; max-width: 100%;"/&gt;
&lt;p&gt;Pour le construire, nous aurions pu réutiliser &lt;a class="reference external" href="https://github.com/mozilla-services/server-syncstorage"&gt;Firefox Sync&lt;/a&gt;, après tout
c'est un service de synchronisation de données très robuste, construit avec &lt;a class="reference external" href="http://cornice.readthedocs.io/"&gt;Cornice&lt;/a&gt;.
Mais seulement, &lt;em&gt;Sync&lt;/em&gt; n'a pas été pensé pour garantir la pérennité des données,
et la marche était trop haute pour changer ça en profondeur.&lt;/p&gt;
&lt;p&gt;Nous aurions pu aussi nous contenter de faire une énième application qui expose
une API et persiste des données dans une base de données.&lt;/p&gt;
&lt;p&gt;Mais cette nouvelle petite équipe n'est pas là par hasard :)&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="la-daybed-team"&gt;
&lt;h2&gt;La «Daybed Team»&lt;/h2&gt;
&lt;p&gt;On partage une vision: un service générique de stockage de données ! Peut-être
que ça vous rappelle &lt;a class="reference external" href="https://daybed.io"&gt;un certain projet nommé Daybed&lt;/a&gt; ?
Pour les applications clientes, JavaScript, mobiles ou autres, l'utilisation de
ce service doit être un jeu d'enfant ! L'application gère ses données
localement (aka offline-first), et synchronise à la demande.&lt;/p&gt;
&lt;p&gt;Ici, le cœur du serveur &lt;em&gt;Reading List&lt;/em&gt; est justement une API "CRUD" (Create,
Retrieve, Update, Delete), qui gère de la synchronisation et de
l'authentification. Nous avons donc pris le parti de faire une API "simple",
avec le moins de spécificités possible, qui poserait les bases d'un service
générique. Notamment parce qu'il y a d'autres projets dans la même trempe qui vont suivre.&lt;/p&gt;
&lt;p&gt;Pas mal d'expérience ayant été accumulée au sein de l'équipe, avec d'une part la
création de &lt;em&gt;Firefox Sync&lt;/em&gt;, et d'autre part avec &lt;em&gt;Daybed&lt;/em&gt;, notre side-project, nous
tentons de ne pas reproduire les mêmes erreurs, tout en gardant les concepts
qui ont fait leurs preuves.&lt;/p&gt;
&lt;p&gt;Par exemple, nous avons conservé le mécanisme de collections d'enregistrements
et de &lt;em&gt;timestamp&lt;/em&gt; de &lt;em&gt;Sync&lt;/em&gt;. Comme ces problématiques sont récurrentes, voire
incontournables, nous avons décidé de reprendre le protocole de synchronisation,
de l'étendre légèrement et surtout de le dissocier du projet de listes de lecture.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="le-mecanisme-qui-force-a-aller-de-l-avant"&gt;
&lt;h2&gt;Le mécanisme qui force à aller de l'avant&lt;/h2&gt;
&lt;p&gt;Comme première pierre à l'édifice, nous avons donné naissance au projet
&lt;a class="reference external" href="https://cliquet.readthedocs.io"&gt;Cliquet&lt;/a&gt;, dont l'idée principale est de
fournir une implémentation de ce protocole en python, tout en factorisant
l'ensemble de nos bonnes pratiques (pour la prod notamment).&lt;/p&gt;
&lt;img alt="Logo du projet Cliquet" class="align-right" src="http://www.servicedenuages.fr/images/cliquet-logo.png" style="width: 300px; height: auto; max-width: 100%;"/&gt;
&lt;p&gt;L'avantage d'avoir un protocole plutôt qu'un monolithe, c'est que si vous
préférez Asyncio, io.js ou Go, on vous encouragera à publier votre
implémentation alternative !&lt;/p&gt;
&lt;p&gt;Avec &lt;em&gt;Cliquet&lt;/em&gt;, le code du serveur liste de lecture consiste principalement
à définir un schéma pour les enregistrements, puis à forcer des valeurs de
champs sur certains appels. Cela réduit ce projet à quelques dizaines de lignes
de code.&lt;/p&gt;
&lt;p&gt;Quant au futur service de stockage générique, &lt;a class="reference external" href="http://kinto.readthedocs.io"&gt;le projet&lt;/a&gt; en est encore à ses balbutiements mais c'est
bel et bien en route ! Il permet déjà d'être branché comme backend de stockage
dans une application &lt;em&gt;Cliquet&lt;/em&gt;, et ça &lt;a class="reference external" href="https://github.com/mozilla-services/kinto/blob/0.2.1/kinto/views/collection.py"&gt;implémenté en 20 lignes de code&lt;/a&gt;!&lt;/p&gt;
&lt;p&gt;Ah, et cette fois, nous ne construirons les fonctionnalités qu'à partir des
besoins concrets qui surviennent. Ça paraît tout bête, mais sur &lt;em&gt;Daybed&lt;/em&gt; on
l'a pas vu venir :)&lt;/p&gt;
&lt;p&gt;Dans les prochains articles, nous avons prévu de décrire les bonnes pratiques
rassemblées dans le protocole (ou &lt;em&gt;Cliquet&lt;/em&gt;), certains points techniques précis
et de vous présenter notre vision via des exemples et tutoriaux.&lt;/p&gt;
&lt;p&gt;À bientôt, donc !&lt;/p&gt;
&lt;/div&gt;
</summary><category term="mozilla"></category></entry><entry><title>Le printemps</title><link href="http://www.servicedenuages.fr/printemps" rel="alternate"></link><published>2015-04-15T00:00:00+02:00</published><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2015-04-15:printemps</id><summary type="html">&lt;p&gt;C'est le printemps et n'en déplaise à certains, il est temps de faire
un peu de ménage.&lt;/p&gt;
&lt;p&gt;Voilà quelques temps que nous accumulons les expériences et que nous
ne les partagions plus tellement par écrit.&lt;/p&gt;
&lt;p&gt;Il y a bien eu une conférence francophone sur Hawk l'an passé et
quelques articles en anglais sur le blog de Mozilla, mais
parfois la barrière de la langue ne permet pas une entière
satisfaction sur ces retours d'expérience.&lt;/p&gt;
&lt;p&gt;C'est ainsi qu'en ce début de printemps 2015 nous dépoussiérons nos
esprits et que nous vous proposons un ensemble d'articles en français
sur ce que nous faisons dans notre petite équipe du Service de Nuages
de Mozilla.&lt;/p&gt;
&lt;img alt="Logo du service des nuages" src="http://www.servicedenuages.fr/images/service_de_nuages.png" style="width: 2268px; height: auto; max-width: 100%;"/&gt;
</summary><category term="mozilla"></category></entry></feed>